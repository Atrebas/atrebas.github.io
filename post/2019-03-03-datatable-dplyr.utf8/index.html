<!DOCTYPE html>
<html lang="en-us">
    <head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>A data.table and dplyr tour &middot; Home</title>

		
  		<link rel="stylesheet" href="/css/style.css">
		<link rel="stylesheet" href="/css/fonts.css">
		
		<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

		
		<link href="" rel="alternate" type="application/rss+xml" title="Home" />

                
                <link rel="stylesheet" href="/css/github-gist.css" rel="stylesheet" id="theme-stylesheet">
                <script src="/js/highlight.pack.js"></script>
                <script>hljs.initHighlightingOnLoad();</script>
	</head>

    <body>
        		<nav class="nav">
			<div class="nav-container">
				<a href="/">
					<h2 class="nav-title">Home</h2>
				</a>
				<ul>
    
    
    <li><a href="/about">About</a></li>
    <li><a href="/">Posts</a></li>
</ul>
			</div>
		</nav>

        

<main>
	<div class="post">
		<div class="post-info">
    <span>Written by</span>
        Atrebas
        <br>
        <span>on&nbsp;</span><time datetime="2019-03-03 00:00:00 &#43;0000 UTC">March 3, 2019</time>
</div>
		<h1 class="post-title">A data.table and dplyr tour</h1>
<div class="post-line"></div>

		

		<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="introduction">Introduction</h1>
<h3 id="about">About</h3>
<ul>
<li>This document has been been inspired by <a href="http://stackoverflow.com/questions/21435339/data-table-vs-dplyr-can-one-do-something-well-the-other-cant-or-does-poorly/27840349#27840349">this stackoverflow question</a> and by the data.table cheat sheet published by Karlijn Willems. It has been written for my own self-teaching and may contain errors or imprecisions. Corrections and suggestions are welcome.</li>
<li>Resources for data.table can be found on the data.table
<a href="https://github.com/Rdatatable/data.table/wiki">wiki</a>, in the data.table
<a href="https://cran.r-project.org/web/packages/data.table/index.html">vignettes</a>,
and in the package documentation.</li>
<li>Reference documents for dplyr include the dplyr
<a href="https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf">cheat sheet</a>,
the dplyr <a href="https://cran.r-project.org/web/packages/dplyr/index.html">vignettes</a>,
and the package documentation.</li>
<li>For the sake of readability, the console outputs are hidden by default.
Click on the button below to show or hide the outputs. Also, the R code used in
this document is independently <a href="https://github.com/Atrebas/atrebas.github.io/blob/master/post/2019-03-03-datatable-dplyr.R">available</a> and can be easily reproduced.</li>
</ul>
<!-- raw HTML omitted -->
<h3 id="update">Update</h3>
<ul>
<li><em>2020-07-26</em>: Update with data.table_1.13.0 (<code>fcase()</code>, functions in <code>.SDcols</code>) and dplyr_1.0.0 (<code>across()</code>, <code>relocate()</code>, &hellip;). &lsquo;Superseded&rsquo; dplyr code has been commented and will probably be removed in the future.</li>
<li><em>2019-06-22</em>: Coding style improved (thanks to @tylerburleigh for pointing that out). Some data.table expressions with <code>by</code> reordered and indented to better highlight the similarity with dplyr. Minor comments and improvements.</li>
</ul>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="datatable-and-dplyr">data.table and dplyr</h3>
<p>data.table and dplyr are two R packages that both aim at an easier and more efficient manipulation of data frames.
But while they share a lot of functionalities, their philosophies are quite different.
Below is a quick overview of the main differences (from my basic user's perspective).</p>
<p><strong>Syntax:</strong></p>
<ul>
<li>The general data.table syntax is as follows: <code>DT[i, j, by, ...]</code> which means:
&ldquo;Take DT, subset rows using <code>i</code>, then calculate <code>j</code>, grouped by <code>by</code>&rdquo; with possible extra options <code>...</code>.
It allows to combine several operations in a very concise and consistent expression.</li>
<li>The syntax of dplyr is based on key verbs corresponding to the most common operations:
<code>filter()</code>, <code>arrange()</code>, <code>select()</code>, <code>mutate()</code>, <code>summarise()</code>, &hellip;
These functions can be combine with <code>group_by()</code> to aggregate data &lsquo;by group&rsquo; and with a bunch of helper functions.
It is a &lsquo;do one thing at a time&rsquo; approach, chaining together functions dedicated to a specific task.</li>
</ul>
<p><strong>Ecosystem:</strong>   <br>
The data.table package has no dependency whereas dplyr is part of the tidyverse. So, for example, while data.table includes functions to read, write, or reshape data, dplyr delegates these tasks to companion packages like readr or tidyr.<br>
On the other hand, data.table is focused on the processing of local in-memory data, but dplyr offers a database backend.</p>
<p><strong>Memory management and performance:</strong> <br>
In data.table, objects can be manipulated &lsquo;by reference&rsquo; (using the <code>set*()</code> functions or with the <code>:=</code> symbol). It means that the data will be modified but not copied, minimizing the RAM requirements. The behaviour of dplyr is similar to the one of base R.<br>
Memory management, parallelism, and shrewd optimization give data.table the advantage in terms of performance.</p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="create-example-data">Create example data</h3>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(data.table)
<span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">1L</span>)

<span style="color:#75715e">## Create a data table</span>
DT <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.table</span>(V1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1L</span>, <span style="color:#ae81ff">2L</span>), <span style="color:#ae81ff">5</span>)[<span style="color:#ae81ff">-10</span>],
                V2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>,
                V3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">1.5</span>),
                V4 <span style="color:#f92672">=</span> <span style="color:#a6e22e">rep</span>(<span style="color:#66d9ef">LETTERS</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], <span style="color:#ae81ff">3</span>))

<span style="color:#a6e22e">class</span>(DT)
DT
</code></pre></div><pre><code>## [1] &quot;data.table&quot; &quot;data.frame&quot;
##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  2  2 1.0  B
## 3:  1  3 1.5  C
## 4:  2  4 0.5  A
## 5:  1  5 1.0  B
## 6:  2  6 1.5  C
## 7:  1  7 0.5  A
## 8:  2  8 1.0  B
## 9:  1  9 1.5  C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(dplyr)
<span style="color:#a6e22e">set.seed</span>(<span style="color:#ae81ff">1L</span>)

<span style="color:#75715e">## Create a data frame (tibble)</span>
DF <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">tibble</span>(V1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1L</span>, <span style="color:#ae81ff">2L</span>), <span style="color:#ae81ff">5</span>)[<span style="color:#ae81ff">-10</span>],
             V2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>,
             V3 <span style="color:#f92672">=</span> <span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">1.5</span>), <span style="color:#ae81ff">3</span>),
             V4 <span style="color:#f92672">=</span> <span style="color:#a6e22e">rep</span>(<span style="color:#66d9ef">LETTERS</span>[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>], <span style="color:#ae81ff">3</span>))

<span style="color:#a6e22e">class</span>(DF)
DF
</code></pre></div><pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;
## # A tibble: 9 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     1   0.5 A    
## 2     2     2   1   B    
## 3     1     3   1.5 C    
## 4     2     4   0.5 A    
## 5     1     5   1   B    
## 6     2     6   1.5 C    
## 7     1     7   0.5 A    
## 8     2     8   1   B    
## 9     1     9   1.5 C
</code></pre><!-- raw HTML omitted -->
<p>Below, the data.table code uses <code>DT</code> and the dplyr code uses <code>DF</code>.
Also, the dplyr code uses the <code>%&gt;%</code> operator: a basic knowledge of the <a href="https://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html">magrittr</a> syntax is assumed.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="basic-operations">Basic operations</h1>
<h3 id="filter-rows">Filter rows</h3>
<h4 id="filter-rows-using-indices">Filter rows using indices</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[3<span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>,]
DT[3<span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>] <span style="color:#75715e"># same</span>
</code></pre></div><pre><code>##    V1 V2  V3 V4
## 1:  1  3 1.5  C
## 2:  2  4 0.5  A
##    V1 V2  V3 V4
## 1:  1  3 1.5  C
## 2:  2  4 0.5  A
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF[3<span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>,]
<span style="color:#a6e22e">slice</span>(DF, <span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>) <span style="color:#75715e"># same</span>
</code></pre></div><pre><code>## # A tibble: 2 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     3   1.5 C    
## 2     2     4   0.5 A    
## # A tibble: 2 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     3   1.5 C    
## 2     2     4   0.5 A
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[<span style="color:#f92672">!</span><span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">7</span>,]
DT[<span style="color:#f92672">-</span>(<span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">7</span>)] <span style="color:#75715e"># same</span>
</code></pre></div><pre><code>##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  2  2 1.0  B
## 3:  2  8 1.0  B
## 4:  1  9 1.5  C
##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  2  2 1.0  B
## 3:  2  8 1.0  B
## 4:  1  9 1.5  C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF[<span style="color:#f92672">-</span>(<span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">7</span>),]
<span style="color:#a6e22e">slice</span>(DF, <span style="color:#f92672">-</span>(<span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">7</span>)) <span style="color:#75715e"># same</span>
</code></pre></div><pre><code>## # A tibble: 4 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     1   0.5 A    
## 2     2     2   1   B    
## 3     2     8   1   B    
## 4     1     9   1.5 C    
## # A tibble: 4 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     1   0.5 A    
## 2     2     2   1   B    
## 3     2     8   1   B    
## 4     1     9   1.5 C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[V2 <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">5</span>]
DT[V4 <span style="color:#f92672">%chin%</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>)] <span style="color:#75715e"># fast %in% for character</span>
</code></pre></div><pre><code>##    V1 V2  V3 V4
## 1:  2  6 1.5  C
## 2:  1  7 0.5  A
## 3:  2  8 1.0  B
## 4:  1  9 1.5  C
##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  1  3 1.5  C
## 3:  2  4 0.5  A
## 4:  2  6 1.5  C
## 5:  1  7 0.5  A
## 6:  1  9 1.5  C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">filter</span>(DF, V2 <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">5</span>)
<span style="color:#a6e22e">filter</span>(DF, V4 <span style="color:#f92672">%in%</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>))
</code></pre></div><pre><code>## # A tibble: 4 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     2     6   1.5 C    
## 2     1     7   0.5 A    
## 3     2     8   1   B    
## 4     1     9   1.5 C    
## # A tibble: 6 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     1   0.5 A    
## 2     1     3   1.5 C    
## 3     2     4   0.5 A    
## 4     2     6   1.5 C    
## 5     1     7   0.5 A    
## 6     1     9   1.5 C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[V1 <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;</span> V4 <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>]
<span style="color:#75715e"># any logical criteria can be used</span>
</code></pre></div><pre><code>##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  1  7 0.5  A
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">filter</span>(DF, V1 <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>, V4 <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>)
<span style="color:#75715e"># any logical criteria can be used</span>
</code></pre></div><pre><code>## # A tibble: 2 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     1   0.5 A    
## 2     1     7   0.5 A
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">unique</span>(DT)
<span style="color:#a6e22e">unique</span>(DT, by <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>)) <span style="color:#75715e"># returns all cols</span>
</code></pre></div><pre><code>##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  2  2 1.0  B
## 3:  1  3 1.5  C
## 4:  2  4 0.5  A
## 5:  1  5 1.0  B
## 6:  2  6 1.5  C
## 7:  1  7 0.5  A
## 8:  2  8 1.0  B
## 9:  1  9 1.5  C
##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  2  2 1.0  B
## 3:  1  3 1.5  C
## 4:  2  4 0.5  A
## 5:  1  5 1.0  B
## 6:  2  6 1.5  C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">distinct</span>(DF) <span style="color:#75715e"># distinct_all(DF)</span>
<span style="color:#a6e22e">distinct</span>(DF, <span style="color:#a6e22e">across</span>(<span style="color:#a6e22e">c</span>(V1, V4))) <span style="color:#75715e"># returns selected cols</span>
<span style="color:#75715e"># distinct_at(DF, vars(V1, V4))</span>
</code></pre></div><pre><code>## # A tibble: 9 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     1   0.5 A    
## 2     2     2   1   B    
## 3     1     3   1.5 C    
## 4     2     4   0.5 A    
## 5     1     5   1   B    
## 6     2     6   1.5 C    
## 7     1     7   0.5 A    
## 8     2     8   1   B    
## 9     1     9   1.5 C    
## # A tibble: 6 x 2
##      V1 V4   
##   &lt;int&gt; &lt;chr&gt;
## 1     1 A    
## 2     2 B    
## 3     1 C    
## 4     2 A    
## 5     1 B    
## 6     2 C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">na.omit</span>(DT, cols <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>)  <span style="color:#75715e"># fast S3 method with cols argument</span>
</code></pre></div><pre><code>##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  2  2 1.0  B
## 3:  1  3 1.5  C
## 4:  2  4 0.5  A
## 5:  1  5 1.0  B
## 6:  2  6 1.5  C
## 7:  1  7 0.5  A
## 8:  2  8 1.0  B
## 9:  1  9 1.5  C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">tidyr<span style="color:#f92672">::</span><span style="color:#a6e22e">drop_na</span>(DF, <span style="color:#a6e22e">names</span>(DF))
</code></pre></div><pre><code>## # A tibble: 9 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     1   0.5 A    
## 2     2     2   1   B    
## 3     1     3   1.5 C    
## 4     2     4   0.5 A    
## 5     1     5   1   B    
## 6     2     6   1.5 C    
## 7     1     7   0.5 A    
## 8     2     8   1   B    
## 9     1     9   1.5 C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT<span style="color:#a6e22e">[sample</span>(.N, <span style="color:#ae81ff">3</span>)] <span style="color:#75715e"># .N = nb of rows in DT</span>
DT<span style="color:#a6e22e">[sample</span>(.N, .N <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>)]
DT<span style="color:#a6e22e">[frankv</span>(<span style="color:#f92672">-</span>V1, ties.method <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">dense&#34;</span>) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>]
</code></pre></div><pre><code>##    V1 V2  V3 V4
## 1:  1  9 1.5  C
## 2:  2  4 0.5  A
## 3:  1  7 0.5  A
##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  2  2 1.0  B
## 3:  1  5 1.0  B
## 4:  1  3 1.5  C
##    V1 V2  V3 V4
## 1:  2  2 1.0  B
## 2:  2  4 0.5  A
## 3:  2  6 1.5  C
## 4:  2  8 1.0  B
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">slice_sample</span>(DF, n <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)      <span style="color:#75715e"># n random rows</span>
<span style="color:#75715e"># sample_n(DF, 3)</span>
<span style="color:#a6e22e">slice_sample</span>(DF, prop <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>) <span style="color:#75715e"># fraction of rows</span>
<span style="color:#75715e"># sample_frac(DF, 0.5)</span>
DF <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">slice_max</span>(V1, n <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
<span style="color:#75715e"># top_n(DF, 1, V1)</span>
</code></pre></div><pre><code>## # A tibble: 3 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     2     2   1   B    
## 2     1     3   1.5 C    
## 3     2     8   1   B    
## # A tibble: 4 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     1   0.5 A    
## 2     1     5   1   B    
## 3     2     8   1   B    
## 4     2     2   1   B    
## # A tibble: 4 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     2     2   1   B    
## 2     2     4   0.5 A    
## 3     2     6   1.5 C    
## 4     2     8   1   B
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[V4 <span style="color:#f92672">%like%</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">^B&#34;</span>]
DT[V2 <span style="color:#f92672">%between%</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>)]
DT[data.table<span style="color:#f92672">::</span><span style="color:#a6e22e">between</span>(V2, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>, incbounds <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)]
DT[V2 <span style="color:#f92672">%inrange%</span> <span style="color:#a6e22e">list</span>(<span style="color:#ae81ff">-1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>)] <span style="color:#75715e"># see also ?inrange</span>
</code></pre></div><pre><code>##    V1 V2 V3 V4
## 1:  2  2  1  B
## 2:  1  5  1  B
## 3:  2  8  1  B
##    V1 V2  V3 V4
## 1:  1  3 1.5  C
## 2:  2  4 0.5  A
## 3:  1  5 1.0  B
##    V1 V2  V3 V4
## 1:  2  4 0.5  A
##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  2  2 1.0  B
## 3:  1  3 1.5  C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">filter</span>(DF, <span style="color:#a6e22e">grepl</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">^B&#34;</span>, V4))
<span style="color:#a6e22e">filter</span>(DF, dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">between</span>(V2, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>))
<span style="color:#a6e22e">filter</span>(DF, V2 <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">&amp;</span> V2 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">5</span>)
<span style="color:#a6e22e">filter</span>(DF, V2 <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">-1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;</span> V2 <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>)
</code></pre></div><pre><code>## # A tibble: 3 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     2     2     1 B    
## 2     1     5     1 B    
## 3     2     8     1 B    
## # A tibble: 3 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     3   1.5 C    
## 2     2     4   0.5 A    
## 3     1     5   1   B    
## # A tibble: 1 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     2     4   0.5 A    
## # A tibble: 3 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     1   0.5 A    
## 2     2     2   1   B    
## 3     1     3   1.5 C
</code></pre><!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="sort-rows">Sort rows</h3>
<h4 id="sort-rows-by-column">Sort rows by column</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT<span style="color:#a6e22e">[order</span>(V3)]  <span style="color:#75715e"># see also setorder</span>
</code></pre></div><pre><code>##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  2  4 0.5  A
## 3:  1  7 0.5  A
## 4:  2  2 1.0  B
## 5:  1  5 1.0  B
## 6:  2  8 1.0  B
## 7:  1  3 1.5  C
## 8:  2  6 1.5  C
## 9:  1  9 1.5  C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">arrange</span>(DF, V3)
</code></pre></div><pre><code>## # A tibble: 9 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     1   0.5 A    
## 2     2     4   0.5 A    
## 3     1     7   0.5 A    
## 4     2     2   1   B    
## 5     1     5   1   B    
## 6     2     8   1   B    
## 7     1     3   1.5 C    
## 8     2     6   1.5 C    
## 9     1     9   1.5 C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT<span style="color:#a6e22e">[order</span>(<span style="color:#f92672">-</span>V3)]
</code></pre></div><pre><code>##    V1 V2  V3 V4
## 1:  1  3 1.5  C
## 2:  2  6 1.5  C
## 3:  1  9 1.5  C
## 4:  2  2 1.0  B
## 5:  1  5 1.0  B
## 6:  2  8 1.0  B
## 7:  1  1 0.5  A
## 8:  2  4 0.5  A
## 9:  1  7 0.5  A
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">arrange</span>(DF, <span style="color:#a6e22e">desc</span>(V3))
</code></pre></div><pre><code>## # A tibble: 9 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     3   1.5 C    
## 2     2     6   1.5 C    
## 3     1     9   1.5 C    
## 4     2     2   1   B    
## 5     1     5   1   B    
## 6     2     8   1   B    
## 7     1     1   0.5 A    
## 8     2     4   0.5 A    
## 9     1     7   0.5 A
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT<span style="color:#a6e22e">[order</span>(V1, <span style="color:#f92672">-</span>V2)]
</code></pre></div><pre><code>##    V1 V2  V3 V4
## 1:  1  9 1.5  C
## 2:  1  7 0.5  A
## 3:  1  5 1.0  B
## 4:  1  3 1.5  C
## 5:  1  1 0.5  A
## 6:  2  8 1.0  B
## 7:  2  6 1.5  C
## 8:  2  4 0.5  A
## 9:  2  2 1.0  B
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">arrange</span>(DF, V1, <span style="color:#a6e22e">desc</span>(V2))
</code></pre></div><pre><code>## # A tibble: 9 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     9   1.5 C    
## 2     1     7   0.5 A    
## 3     1     5   1   B    
## 4     1     3   1.5 C    
## 5     1     1   0.5 A    
## 6     2     8   1   B    
## 7     2     6   1.5 C    
## 8     2     4   0.5 A    
## 9     2     2   1   B
</code></pre><!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="select-columns">Select columns</h3>
<h4 id="select-one-column-using-an-index-not-recommended">Select one column using an index (not recommended)</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[[3]] <span style="color:#75715e"># returns a vector</span>
DT[, <span style="color:#ae81ff">3</span>]  <span style="color:#75715e"># returns a data.table</span>
</code></pre></div><pre><code>## [1] 0.5 1.0 1.5 0.5 1.0 1.5 0.5 1.0 1.5
##     V3
## 1: 0.5
## 2: 1.0
## 3: 1.5
## 4: 0.5
## 5: 1.0
## 6: 1.5
## 7: 0.5
## 8: 1.0
## 9: 1.5
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF[[3]] <span style="color:#75715e"># returns a vector</span>
DF[3]   <span style="color:#75715e"># returns a tibble</span>
</code></pre></div><pre><code>## [1] 0.5 1.0 1.5 0.5 1.0 1.5 0.5 1.0 1.5
## # A tibble: 9 x 1
##      V3
##   &lt;dbl&gt;
## 1   0.5
## 2   1  
## 3   1.5
## 4   0.5
## 5   1  
## 6   1.5
## 7   0.5
## 8   1  
## 9   1.5
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, <span style="color:#a6e22e">list</span>(V2)] <span style="color:#75715e"># returns a data.table</span>
DT[, .(V2)]    <span style="color:#75715e"># returns a data.table</span>
<span style="color:#75715e"># . is an alias for list</span>
DT[, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>]     <span style="color:#75715e"># returns a data.table</span>
DT[, V2]       <span style="color:#75715e"># returns a vector</span>
DT[[<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>]]     <span style="color:#75715e"># returns a vector</span>
</code></pre></div><pre><code>##    V2
## 1:  1
## 2:  2
## 3:  3
## 4:  4
## 5:  5
## 6:  6
## 7:  7
## 8:  8
## 9:  9
##    V2
## 1:  1
## 2:  2
## 3:  3
## 4:  4
## 5:  5
## 6:  6
## 7:  7
## 8:  8
## 9:  9
##    V2
## 1:  1
## 2:  2
## 3:  3
## 4:  4
## 5:  5
## 6:  6
## 7:  7
## 8:  8
## 9:  9
## [1] 1 2 3 4 5 6 7 8 9
## [1] 1 2 3 4 5 6 7 8 9
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">select</span>(DF, V2) <span style="color:#75715e"># returns a tibble</span>
<span style="color:#a6e22e">pull</span>(DF, V2, name <span style="color:#f92672">=</span> V4)   <span style="color:#75715e"># returns a (named) vector</span>
DF[, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>]        <span style="color:#75715e"># returns a tibble</span>
DF[[<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>]]        <span style="color:#75715e"># returns a vector</span>
</code></pre></div><pre><code>## # A tibble: 9 x 1
##      V2
##   &lt;int&gt;
## 1     1
## 2     2
## 3     3
## 4     4
## 5     5
## 6     6
## 7     7
## 8     8
## 9     9
## A B C A B C A B C 
## 1 2 3 4 5 6 7 8 9 
## # A tibble: 9 x 1
##      V2
##   &lt;int&gt;
## 1     1
## 2     2
## 3     3
## 4     4
## 5     5
## 6     6
## 7     7
## 8     8
## 9     9
## [1] 1 2 3 4 5 6 7 8 9
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, .(V2, V3, V4)]
DT[, <span style="color:#a6e22e">list</span>(V2, V3, V4)]
DT[, V2<span style="color:#f92672">:</span>V4] <span style="color:#75715e"># select columns between V2 and V4</span>
</code></pre></div><pre><code>##    V2  V3 V4
## 1:  1 0.5  A
## 2:  2 1.0  B
## 3:  3 1.5  C
## 4:  4 0.5  A
## 5:  5 1.0  B
## 6:  6 1.5  C
## 7:  7 0.5  A
## 8:  8 1.0  B
## 9:  9 1.5  C
##    V2  V3 V4
## 1:  1 0.5  A
## 2:  2 1.0  B
## 3:  3 1.5  C
## 4:  4 0.5  A
## 5:  5 1.0  B
## 6:  6 1.5  C
## 7:  7 0.5  A
## 8:  8 1.0  B
## 9:  9 1.5  C
##    V2  V3 V4
## 1:  1 0.5  A
## 2:  2 1.0  B
## 3:  3 1.5  C
## 4:  4 0.5  A
## 5:  5 1.0  B
## 6:  6 1.5  C
## 7:  7 0.5  A
## 8:  8 1.0  B
## 9:  9 1.5  C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">select</span>(DF, V2, V3, V4)
<span style="color:#a6e22e">select</span>(DF, V2<span style="color:#f92672">:</span>V4) <span style="color:#75715e"># select columns between V2 and V4</span>
</code></pre></div><pre><code>## # A tibble: 9 x 3
##      V2    V3 V4   
##   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1   0.5 A    
## 2     2   1   B    
## 3     3   1.5 C    
## 4     4   0.5 A    
## 5     5   1   B    
## 6     6   1.5 C    
## 7     7   0.5 A    
## 8     8   1   B    
## 9     9   1.5 C    
## # A tibble: 9 x 3
##      V2    V3 V4   
##   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1   0.5 A    
## 2     2   1   B    
## 3     3   1.5 C    
## 4     4   0.5 A    
## 5     5   1   B    
## 6     6   1.5 C    
## 7     7   0.5 A    
## 8     8   1   B    
## 9     9   1.5 C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, <span style="color:#f92672">!</span><span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V3&#34;</span>)]
</code></pre></div><pre><code>##    V1 V4
## 1:  1  A
## 2:  2  B
## 3:  1  C
## 4:  2  A
## 5:  1  B
## 6:  2  C
## 7:  1  A
## 8:  2  B
## 9:  1  C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">select</span>(DF, <span style="color:#f92672">-</span>V2, <span style="color:#f92672">-</span>V3)
</code></pre></div><pre><code>## # A tibble: 9 x 2
##      V1 V4   
##   &lt;int&gt; &lt;chr&gt;
## 1     1 A    
## 2     2 B    
## 3     1 C    
## 4     2 A    
## 5     1 B    
## 6     2 C    
## 7     1 A    
## 8     2 B    
## 9     1 C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">cols <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V3&#34;</span>)
DT[, ..cols] <span style="color:#75715e"># .. prefix means &#39;one-level up&#39;</span>
DT[, <span style="color:#f92672">!</span>..cols] <span style="color:#75715e"># or DT[, -..cols]</span>
</code></pre></div><pre><code>##    V2  V3
## 1:  1 0.5
## 2:  2 1.0
## 3:  3 1.5
## 4:  4 0.5
## 5:  5 1.0
## 6:  6 1.5
## 7:  7 0.5
## 8:  8 1.0
## 9:  9 1.5
##    V1 V4
## 1:  1  A
## 2:  2  B
## 3:  1  C
## 4:  2  A
## 5:  1  B
## 6:  2  C
## 7:  1  A
## 8:  2  B
## 9:  1  C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">cols <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V3&#34;</span>)
<span style="color:#a6e22e">select</span>(DF, <span style="color:#f92672">!</span><span style="color:#f92672">!</span>cols) <span style="color:#75715e"># unquoting</span>
<span style="color:#a6e22e">select</span>(DF, <span style="color:#f92672">-</span><span style="color:#f92672">!</span><span style="color:#f92672">!</span>cols)
</code></pre></div><pre><code>## # A tibble: 9 x 2
##      V2    V3
##   &lt;int&gt; &lt;dbl&gt;
## 1     1   0.5
## 2     2   1  
## 3     3   1.5
## 4     4   0.5
## 5     5   1  
## 6     6   1.5
## 7     7   0.5
## 8     8   1  
## 9     9   1.5
## # A tibble: 9 x 2
##      V1 V4   
##   &lt;int&gt; &lt;chr&gt;
## 1     1 A    
## 2     2 B    
## 3     1 C    
## 4     2 A    
## 5     1 B    
## 6     2 C    
## 7     1 A    
## 8     2 B    
## 9     1 C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">cols <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>)
cols <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">union</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>, <span style="color:#a6e22e">names</span>(DT))
cols <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">grep</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V&#34;</span>,   <span style="color:#a6e22e">names</span>(DT))
cols <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">grep</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">3$&#34;</span>,  <span style="color:#a6e22e">names</span>(DT))
cols <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">grep</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">.2&#34;</span>,  <span style="color:#a6e22e">names</span>(DT))
cols <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">grep</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">^V1|X$&#34;</span>,  <span style="color:#a6e22e">names</span>(DT))
cols <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">grep</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">^(?!V2)&#34;</span>, <span style="color:#a6e22e">names</span>(DT), perl <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
DT[, ..cols]
</code></pre></div><pre><code>##    V1  V3 V4
## 1:  1 0.5  A
## 2:  2 1.0  B
## 3:  1 1.5  C
## 4:  2 0.5  A
## 5:  1 1.0  B
## 6:  2 1.5  C
## 7:  1 0.5  A
## 8:  2 1.0  B
## 9:  1 1.5  C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">select</span>(DF, <span style="color:#a6e22e">num_range</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V&#34;</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>))
<span style="color:#a6e22e">select</span>(DF, V4, <span style="color:#a6e22e">everything</span>()) <span style="color:#75715e"># reorder columns</span>
<span style="color:#a6e22e">select</span>(DF, <span style="color:#a6e22e">contains</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V&#34;</span>))
<span style="color:#a6e22e">select</span>(DF, <span style="color:#a6e22e">ends_with</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">3&#34;</span>))
<span style="color:#a6e22e">select</span>(DF, <span style="color:#a6e22e">matches</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">.2&#34;</span>))
<span style="color:#a6e22e">select</span>(DF, <span style="color:#a6e22e">one_of</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">X&#34;</span>)))
</code></pre></div><pre><code>## Warning: Unknown columns: `X`
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">select</span>(DF, <span style="color:#f92672">-</span><span style="color:#a6e22e">starts_with</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>))
<span style="color:#75715e"># remove variables using &#34;-&#34; prior to function</span>
</code></pre></div><pre><code>## # A tibble: 9 x 2
##      V1    V2
##   &lt;int&gt; &lt;int&gt;
## 1     1     1
## 2     2     2
## 3     1     3
## 4     2     4
## 5     1     5
## 6     2     6
## 7     1     7
## 8     2     8
## 9     1     9
## # A tibble: 9 x 4
##   V4       V1    V2    V3
##   &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
## 1 A         1     1   0.5
## 2 B         2     2   1  
## 3 C         1     3   1.5
## 4 A         2     4   0.5
## 5 B         1     5   1  
## 6 C         2     6   1.5
## 7 A         1     7   0.5
## 8 B         2     8   1  
## 9 C         1     9   1.5
## # A tibble: 9 x 4
##      V1    V2    V3 V4   
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     1   0.5 A    
## 2     2     2   1   B    
## 3     1     3   1.5 C    
## 4     2     4   0.5 A    
## 5     1     5   1   B    
## 6     2     6   1.5 C    
## 7     1     7   0.5 A    
## 8     2     8   1   B    
## 9     1     9   1.5 C    
## # A tibble: 9 x 1
##      V3
##   &lt;dbl&gt;
## 1   0.5
## 2   1  
## 3   1.5
## 4   0.5
## 5   1  
## 6   1.5
## 7   0.5
## 8   1  
## 9   1.5
## # A tibble: 9 x 1
##      V2
##   &lt;int&gt;
## 1     1
## 2     2
## 3     3
## 4     4
## 5     5
## 6     6
## 7     7
## 8     8
## 9     9
## # A tibble: 9 x 1
##      V1
##   &lt;int&gt;
## 1     1
## 2     2
## 3     1
## 4     2
## 5     1
## 6     2
## 7     1
## 8     2
## 9     1
## # A tibble: 9 x 3
##      V1    V3 V4   
##   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1   0.5 A    
## 2     2   1   B    
## 3     1   1.5 C    
## 4     2   0.5 A    
## 5     1   1   B    
## 6     2   1.5 C    
## 7     1   0.5 A    
## 8     2   1   B    
## 9     1   1.5 C
</code></pre><!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="summarise-data">Summarise data</h3>
<h4 id="summarise-one-column">Summarise one column</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, <span style="color:#a6e22e">sum</span>(V1)]    <span style="color:#75715e"># returns a vector</span>
DT[, <span style="color:#a6e22e">.(sum</span>(V1))] <span style="color:#75715e"># returns a data.table</span>
DT[, .(sumV1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V1))] <span style="color:#75715e"># returns a data.table</span>
</code></pre></div><pre><code>## [1] 13
##    V1
## 1: 13
##    sumV1
## 1:    13
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">summarise</span>(DF, <span style="color:#a6e22e">sum</span>(V1)) <span style="color:#75715e"># returns a tibble</span>
<span style="color:#a6e22e">summarise</span>(DF, sumV1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V1)) <span style="color:#75715e"># returns a tibble</span>
</code></pre></div><pre><code>## # A tibble: 1 x 1
##   `sum(V1)`
##       &lt;int&gt;
## 1        13
## # A tibble: 1 x 1
##   sumV1
##   &lt;int&gt;
## 1    13
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, <span style="color:#a6e22e">.(sum</span>(V1), <span style="color:#a6e22e">sd</span>(V3))]
</code></pre></div><pre><code>##    V1        V2
## 1: 13 0.4330127
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">summarise</span>(DF, <span style="color:#a6e22e">sum</span>(V1), <span style="color:#a6e22e">sd</span>(V3))
</code></pre></div><pre><code>## # A tibble: 1 x 2
##   `sum(V1)` `sd(V3)`
##       &lt;int&gt;    &lt;dbl&gt;
## 1        13    0.433
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, .(sumv1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V1),
       sdv3  <span style="color:#f92672">=</span> <span style="color:#a6e22e">sd</span>(V3))]
</code></pre></div><pre><code>##    sumv1      sdv3
## 1:    13 0.4330127
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(sumv1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V1),
            sdv3  <span style="color:#f92672">=</span> <span style="color:#a6e22e">sd</span>(V3))
</code></pre></div><pre><code>## # A tibble: 1 x 2
##   sumv1  sdv3
##   &lt;int&gt; &lt;dbl&gt;
## 1    13 0.433
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[1<span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>, <span style="color:#a6e22e">sum</span>(V1)]
</code></pre></div><pre><code>## [1] 6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">4</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(<span style="color:#a6e22e">sum</span>(V1))
</code></pre></div><pre><code>## # A tibble: 1 x 1
##   `sum(V1)`
##       &lt;int&gt;
## 1         6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, data.table<span style="color:#f92672">::</span><span style="color:#a6e22e">first</span>(V3)]
DT[, data.table<span style="color:#f92672">::</span><span style="color:#a6e22e">last</span>(V3)]
DT[5, V3]
DT[, <span style="color:#a6e22e">uniqueN</span>(V4)]
<span style="color:#a6e22e">uniqueN</span>(DT)
</code></pre></div><pre><code>## [1] 0.5
## [1] 1.5
## [1] 1
## [1] 3
## [1] 9
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">summarise</span>(DF, dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">first</span>(V3))
<span style="color:#a6e22e">summarise</span>(DF, dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">last</span>(V3))
<span style="color:#a6e22e">summarise</span>(DF, <span style="color:#a6e22e">nth</span>(V3, <span style="color:#ae81ff">5</span>))
<span style="color:#a6e22e">summarise</span>(DF, <span style="color:#a6e22e">n_distinct</span>(V4))
<span style="color:#a6e22e">n_distinct</span>(DF)
</code></pre></div><pre><code>## # A tibble: 1 x 1
##   `dplyr::first(V3)`
##                &lt;dbl&gt;
## 1                0.5
## # A tibble: 1 x 1
##   `dplyr::last(V3)`
##               &lt;dbl&gt;
## 1               1.5
## # A tibble: 1 x 1
##   `nth(V3, 5)`
##          &lt;dbl&gt;
## 1            1
## # A tibble: 1 x 1
##   `n_distinct(V4)`
##              &lt;int&gt;
## 1                3
## [1] 9
</code></pre><!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="addupdatedelete-columns">Add/update/delete columns</h3>
<p>In the following commands, with data.table, columns are modified by reference using the column assignment symbol <code>:=</code> (no copy performed) and the results are returned invisibly. With dplyr, we have to assign the results.</p>
<h4 id="modify-a-column">Modify a column</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, V1 <span style="color:#f92672">:</span><span style="color:#f92672">=</span> V1^2]
DT
</code></pre></div><pre><code>##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  4  2 1.0  B
## 3:  1  3 1.5  C
## 4:  4  4 0.5  A
## 5:  1  5 1.0  B
## 6:  4  6 1.5  C
## 7:  1  7 0.5  A
## 8:  4  8 1.0  B
## 9:  1  9 1.5  C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">&lt;-</span> DF <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">mutate</span>(V1 <span style="color:#f92672">=</span> V1^2)
DF
</code></pre></div><pre><code>## # A tibble: 9 x 4
##      V1    V2    V3 V4   
##   &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
## 1     1     1   0.5 A    
## 2     4     2   1   B    
## 3     1     3   1.5 C    
## 4     4     4   0.5 A    
## 5     1     5   1   B    
## 6     4     6   1.5 C    
## 7     1     7   0.5 A    
## 8     4     8   1   B    
## 9     1     9   1.5 C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, v5 <span style="color:#f92672">:</span><span style="color:#f92672">=</span> <span style="color:#a6e22e">log</span>(V1)][] <span style="color:#75715e"># adding [] prints the result</span>
</code></pre></div><pre><code>##    V1 V2  V3 V4       v5
## 1:  1  1 0.5  A 0.000000
## 2:  4  2 1.0  B 1.386294
## 3:  1  3 1.5  C 0.000000
## 4:  4  4 0.5  A 1.386294
## 5:  1  5 1.0  B 0.000000
## 6:  4  6 1.5  C 1.386294
## 7:  1  7 0.5  A 0.000000
## 8:  4  8 1.0  B 1.386294
## 9:  1  9 1.5  C 0.000000
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">mutate</span>(DF, v5 <span style="color:#f92672">=</span> <span style="color:#a6e22e">log</span>(V1))
<span style="color:#75715e"># see ?mutate for options (.keep, .before, ...)</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">v6&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">v7&#34;</span>) <span style="color:#f92672">:</span><span style="color:#f92672">=</span> <span style="color:#a6e22e">.(sqrt</span>(V1), <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">X&#34;</span>)]

DT[, <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">:=&#39;</span>(v6 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sqrt</span>(V1),
          v7 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">X&#34;</span>)]     <span style="color:#75715e"># same, functional form</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">mutate</span>(DF, v6 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sqrt</span>(V1), v7 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">X&#34;</span>)
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, .(v8 <span style="color:#f92672">=</span> V3 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)]
</code></pre></div><pre><code>##     v8
## 1: 1.5
## 2: 2.0
## 3: 2.5
## 4: 1.5
## 5: 2.0
## 6: 2.5
## 7: 1.5
## 8: 2.0
## 9: 2.5
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">transmute</span>(DF, v8 <span style="color:#f92672">=</span> V3 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)
</code></pre></div><pre><code>## # A tibble: 9 x 1
##      v8
##   &lt;dbl&gt;
## 1   1.5
## 2   2  
## 3   2.5
## 4   1.5
## 5   2  
## 6   2.5
## 7   1.5
## 8   2  
## 9   2.5
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, v5 <span style="color:#f92672">:</span><span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>]
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">select</span>(DF, <span style="color:#f92672">-</span>v5)
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">v6&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">v7&#34;</span>) <span style="color:#f92672">:</span><span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>]
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">select</span>(DF, <span style="color:#f92672">-</span>v6, <span style="color:#f92672">-</span>v7)
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">cols <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V3&#34;</span>)
DT[, (cols) <span style="color:#f92672">:</span><span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>] <span style="color:#75715e"># ! not DT[, cols := NULL]</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">cols <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V3&#34;</span>)
DF <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">select</span>(DF, <span style="color:#f92672">-</span><span style="color:#a6e22e">one_of</span>(cols))
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[V2 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span>, V2 <span style="color:#f92672">:</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0L</span>]
DT
</code></pre></div><pre><code>##    V1 V2 V4
## 1:  1  0  A
## 2:  4  0  B
## 3:  1  0  C
## 4:  4  4  A
## 5:  1  5  B
## 6:  4  6  C
## 7:  1  7  A
## 8:  4  8  B
## 9:  1  9  C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">mutate</span>(DF, V2 <span style="color:#f92672">=</span> base<span style="color:#f92672">::</span><span style="color:#a6e22e">replace</span>(V2, V2 <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">0L</span>))
DF
</code></pre></div><pre><code>## # A tibble: 9 x 3
##      V1    V2 V4   
##   &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;
## 1     1     0 A    
## 2     4     0 B    
## 3     1     0 C    
## 4     4     4 A    
## 5     1     5 B    
## 6     4     6 C    
## 7     1     7 A    
## 8     4     8 B    
## 9     1     9 C
</code></pre><!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="by">by</h3>
<p>The <code>dplyr::group_by()</code> function and the corresponding <code>by</code> and <code>keyby</code> statements in data.table
allow to run manipulate each group of observations and combine the results.
The sole difference between  <code>by</code> and <code>keyby</code> is that <code>keyby</code> orders the results and
creates a <code>key</code> that will allow faster subsetting (cf. the <a href="#indexing-and-keys">indexing and keys</a> section).
Below, we arbitrary use one or the other. <br>
<code>group_by()</code> takes an existing tibble and converts it into a grouped
tibble where operations will always be performed &ldquo;by group&rdquo;.
Using <code>ungroup()</code> removes grouping. With data.table, <code>by</code> is always used on the fly. <br>
Note that it is possible to reorder the arguments in data.table: <code>DT[i, j, by]</code> &lt;=&gt; <code>DT[i, by, j]</code>.
This is done below to better highlight the similarity with dplyr.</p>
<h4 id="by-group">By group</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># one-liner:</span>
DT[, .(sumV2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V2)), by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>]
<span style="color:#75715e"># reordered and indented:</span>
DT[, by <span style="color:#f92672">=</span> V4,
     .(sumV2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V2))]
<span style="color:#75715e"># </span>
</code></pre></div><pre><code>##    V4 sumV2
## 1:  A    11
## 2:  B    13
## 3:  C    15
##    V4 sumV2
## 1:  A    11
## 2:  B    13
## 3:  C    15
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(sumV2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V2))
</code></pre></div><pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># ungrouped output</span>
</code></pre></div><pre><code>## # A tibble: 3 x 2
##   V4    sumV2
##   &lt;chr&gt; &lt;int&gt;
## 1 A        11
## 2 B        13
## 3 C        15
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, keyby <span style="color:#f92672">=</span> .(V4, V1),
     .(sumV2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V2))]
</code></pre></div><pre><code>##    V4 V1 sumV2
## 1:  A  1     7
## 2:  A  4     4
## 3:  B  1     5
## 4:  B  4     8
## 5:  C  1     9
## 6:  C  4     6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4, V1) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(sumV2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V2))
</code></pre></div><pre><code>## `summarise()` regrouping output by 'V4' (override with `.groups` argument)
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># output grouped by V4</span>
</code></pre></div><pre><code>## # A tibble: 6 x 3
## # Groups:   V4 [3]
##   V4       V1 sumV2
##   &lt;chr&gt; &lt;dbl&gt; &lt;int&gt;
## 1 A         1     7
## 2 A         4     4
## 3 B         1     5
## 4 B         4     8
## 5 C         1     9
## 6 C         4     6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, by <span style="color:#f92672">=</span> <span style="color:#a6e22e">tolower</span>(V4),
     .(sumV1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V1))]
</code></pre></div><pre><code>##    tolower sumV1
## 1:       a     6
## 2:       b     9
## 3:       c     6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(<span style="color:#a6e22e">tolower</span>(V4)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(sumV1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V1))
</code></pre></div><pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre><pre><code>## # A tibble: 3 x 2
##   `tolower(V4)` sumV1
##   &lt;chr&gt;         &lt;dbl&gt;
## 1 a                 6
## 2 b                 9
## 3 c                 6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, keyby <span style="color:#f92672">=</span> .(abc <span style="color:#f92672">=</span> <span style="color:#a6e22e">tolower</span>(V4)),
     .(sumV1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V1))]
</code></pre></div><pre><code>##    abc sumV1
## 1:   a     6
## 2:   b     9
## 3:   c     6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(abc <span style="color:#f92672">=</span> <span style="color:#a6e22e">tolower</span>(V4)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(sumV1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V1))
</code></pre></div><pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre><pre><code>## # A tibble: 3 x 2
##   abc   sumV1
##   &lt;chr&gt; &lt;dbl&gt;
## 1 a         6
## 2 b         9
## 3 c         6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, keyby <span style="color:#f92672">=</span> V4 <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>,
     <span style="color:#a6e22e">sum</span>(V1)]
</code></pre></div><pre><code>##       V4 V1
## 1: FALSE 15
## 2:  TRUE  6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4 <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(<span style="color:#a6e22e">sum</span>(V1))
</code></pre></div><pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre><pre><code>## # A tibble: 2 x 2
##   `V4 == &quot;A&quot;` `sum(V1)`
##   &lt;lgl&gt;           &lt;dbl&gt;
## 1 FALSE              15
## 2 TRUE                6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[1<span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>,                <span style="color:#75715e"># i</span>
   .(sumV1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V1)), <span style="color:#75715e"># j</span>
   by <span style="color:#f92672">=</span> V4]            <span style="color:#75715e"># by</span>
<span style="color:#75715e">## complete DT[i, j, by] expression!</span>
</code></pre></div><pre><code>##    V4 sumV1
## 1:  A     5
## 2:  B     5
## 3:  C     1
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(sumV1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V1))
</code></pre></div><pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre><pre><code>## # A tibble: 3 x 2
##   V4    sumV1
##   &lt;chr&gt; &lt;dbl&gt;
## 1 A         5
## 2 B         5
## 3 C         1
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, .N, by <span style="color:#f92672">=</span> V4]
</code></pre></div><pre><code>##    V4 N
## 1:  A 3
## 2:  B 3
## 3:  C 3
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">count</span>(DF, V4)
DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">tally</span>()
DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(<span style="color:#a6e22e">n</span>())
</code></pre></div><pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_size</span>() <span style="color:#75715e"># returns a vector</span>
</code></pre></div><pre><code>## # A tibble: 3 x 2
##   V4        n
##   &lt;chr&gt; &lt;int&gt;
## 1 A         3
## 2 B         3
## 3 C         3
## # A tibble: 3 x 2
##   V4        n
##   &lt;chr&gt; &lt;int&gt;
## 1 A         3
## 2 B         3
## 3 C         3
## # A tibble: 3 x 2
##   V4    `n()`
##   &lt;chr&gt; &lt;int&gt;
## 1 A         3
## 2 B         3
## 3 C         3
## [1] 3 3 3
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, n <span style="color:#f92672">:</span><span style="color:#f92672">=</span> .N, by <span style="color:#f92672">=</span> V1][]
DT[, n <span style="color:#f92672">:</span><span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>] <span style="color:#75715e"># rm column for consistency</span>
</code></pre></div><pre><code>##    V1 V2 V4 n
## 1:  1  0  A 5
## 2:  4  0  B 4
## 3:  1  0  C 5
## 4:  4  4  A 4
## 5:  1  5  B 5
## 6:  4  6  C 4
## 7:  1  7  A 5
## 8:  4  8  B 4
## 9:  1  9  C 5
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">add_count</span>(DF, V1)
DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V1) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">add_tally</span>()
</code></pre></div><pre><code>## # A tibble: 9 x 4
##      V1    V2 V4        n
##   &lt;dbl&gt; &lt;int&gt; &lt;chr&gt; &lt;int&gt;
## 1     1     0 A         5
## 2     4     0 B         4
## 3     1     0 C         5
## 4     4     4 A         4
## 5     1     5 B         5
## 6     4     6 C         4
## 7     1     7 A         5
## 8     4     8 B         4
## 9     1     9 C         5
## # A tibble: 9 x 4
## # Groups:   V1 [2]
##      V1    V2 V4        n
##   &lt;dbl&gt; &lt;int&gt; &lt;chr&gt; &lt;int&gt;
## 1     1     0 A         5
## 2     4     0 B         4
## 3     1     0 C         5
## 4     4     4 A         4
## 5     1     5 B         5
## 6     4     6 C         4
## 7     1     7 A         5
## 8     4     8 B         4
## 9     1     9 C         5
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, data.table<span style="color:#f92672">::</span><span style="color:#a6e22e">first</span>(V2), by <span style="color:#f92672">=</span> V4]
DT[, data.table<span style="color:#f92672">::</span><span style="color:#a6e22e">last</span>(V2), by <span style="color:#f92672">=</span> V4]
DT[, V2[2], by <span style="color:#f92672">=</span> V4]
</code></pre></div><pre><code>##    V4 V1
## 1:  A  0
## 2:  B  0
## 3:  C  0
##    V4 V1
## 1:  A  7
## 2:  B  8
## 3:  C  9
##    V4 V1
## 1:  A  4
## 2:  B  5
## 3:  C  6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">first</span>(V2))
</code></pre></div><pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">last</span>(V2))
</code></pre></div><pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">nth</span>(V2, <span style="color:#ae81ff">2</span>))
</code></pre></div><pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre><pre><code>## # A tibble: 3 x 2
##   V4    `dplyr::first(V2)`
##   &lt;chr&gt;              &lt;int&gt;
## 1 A                      0
## 2 B                      0
## 3 C                      0
## # A tibble: 3 x 2
##   V4    `dplyr::last(V2)`
##   &lt;chr&gt;             &lt;int&gt;
## 1 A                     7
## 2 B                     8
## 3 C                     9
## # A tibble: 3 x 2
##   V4    `dplyr::nth(V2, 2)`
##   &lt;chr&gt;               &lt;int&gt;
## 1 A                       4
## 2 B                       5
## 3 C                       6
</code></pre><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="going-further">Going further</h1>
<h3 id="advanced-columns-manipulation">Advanced columns manipulation</h3>
<p>To manipulate multiple columns, dplyr_1.0.0 has introduced the <code>across()</code> function,
superseding the <code>_all</code>, <code>_at</code>, and <code>_if</code> versions of <code>summarise()</code>, <code>mutate()</code>, and <code>transmute()</code>. <br>
With data.table, we use <code>.SD</code>, which is a <code>data.table</code> containing the Subset of Data for each group,
excluding the column(s) used in <code>by</code>. So, <code>DT[, .SD]</code> is <code>DT</code> itself and in the expression <code>DT[, .SD, by = V4]</code>,
<code>.SD</code> contains all the DT columns (except V4) for each values in V4 (see <code>DT[, print(.SD), by = V4]</code>).
<code>.SDcols</code> allows to select the columns included in <code>.SD</code>.</p>
<h4 id="summarise-all-the-columns">Summarise all the columns</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, <span style="color:#a6e22e">lapply</span>(.SD, max)]
</code></pre></div><pre><code>##    V1 V2 V4
## 1:  4  9  C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">summarise</span>(<span style="color:#a6e22e">across</span>(<span style="color:#a6e22e">everything</span>(), max))
<span style="color:#75715e"># summarise_all(DF, max)</span>
</code></pre></div><pre><code>## # A tibble: 1 x 3
##      V1    V2 V4   
##   &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;
## 1     4     9 C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, <span style="color:#a6e22e">lapply</span>(.SD, mean),
     .SDcols <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>)]
</code></pre></div><pre><code>##          V1       V2
## 1: 2.333333 4.333333
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">summarise</span>(<span style="color:#a6e22e">across</span>(<span style="color:#a6e22e">c</span>(V1, V2), mean))
<span style="color:#75715e"># summarise_at(DF, c(&#34;V1&#34;, &#34;V2&#34;), mean)</span>
</code></pre></div><pre><code>## # A tibble: 1 x 2
##      V1    V2
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  2.33  4.33
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, by <span style="color:#f92672">=</span> V4,
     <span style="color:#a6e22e">lapply</span>(.SD, mean),
     .SDcols <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>)]
<span style="color:#75715e">## using patterns (regex)</span>
DT[, by <span style="color:#f92672">=</span> V4,
     <span style="color:#a6e22e">lapply</span>(.SD, mean),
     .SDcols <span style="color:#f92672">=</span> <span style="color:#a6e22e">patterns</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1|V2|Z0&#34;</span>)]
</code></pre></div><pre><code>##    V4 V1       V2
## 1:  A  2 3.666667
## 2:  B  3 4.333333
## 3:  C  2 5.000000
##    V4 V1       V2
## 1:  A  2 3.666667
## 2:  B  3 4.333333
## 3:  C  2 5.000000
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(<span style="color:#a6e22e">across</span>(<span style="color:#a6e22e">c</span>(V1, V2), mean))
</code></pre></div><pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># DF %&gt;%</span>
<span style="color:#75715e">#   group_by(V4) %&gt;%</span>
<span style="color:#75715e">#   summarise_at(c(&#34;V1&#34;, &#34;V2&#34;), mean)</span>
DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(<span style="color:#a6e22e">across</span>(<span style="color:#a6e22e">any_of</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Z0&#34;</span>)), mean))
</code></pre></div><pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre><pre><code>## # A tibble: 3 x 3
##   V4       V1    V2
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 A         2  3.67
## 2 B         3  4.33
## 3 C         2  5   
## # A tibble: 3 x 3
##   V4       V1    V2
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 A         2  3.67
## 2 B         3  4.33
## 3 C         2  5
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, by <span style="color:#f92672">=</span> V4,
     <span style="color:#a6e22e">c</span>(<span style="color:#a6e22e">lapply</span>(.SD, sum),
       <span style="color:#a6e22e">lapply</span>(.SD, mean))]
</code></pre></div><pre><code>##    V4 V1 V2 V1       V2
## 1:  A  6 11  2 3.666667
## 2:  B  9 13  3 4.333333
## 3:  C  6 15  2 5.000000
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(<span style="color:#a6e22e">across</span>(<span style="color:#a6e22e">everything</span>(),
                   <span style="color:#a6e22e">list</span>(sum <span style="color:#f92672">=</span> sum, mean <span style="color:#f92672">=</span> mean)))
</code></pre></div><pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># columns named automatically</span>
<span style="color:#75715e"># DF %&gt;%</span>
<span style="color:#75715e">#   group_by(V4) %&gt;%</span>
<span style="color:#75715e">#   summarise_all(list(sum, mean))</span>
</code></pre></div><pre><code>## # A tibble: 3 x 5
##   V4    V1_sum V1_mean V2_sum V2_mean
##   &lt;chr&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;int&gt;   &lt;dbl&gt;
## 1 A          6       2     11    3.67
## 2 B          9       3     13    4.33
## 3 C          6       2     15    5
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, <span style="color:#a6e22e">lapply</span>(.SD, mean),
     .SDcols <span style="color:#f92672">=</span> is.numeric]
foo <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) {<span style="color:#a6e22e">is.numeric</span>(x) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">mean</span>(x) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">3</span>}
DT[, <span style="color:#a6e22e">lapply</span>(.SD, mean),
   .SDcols <span style="color:#f92672">=</span> foo]
</code></pre></div><pre><code>##          V1       V2
## 1: 2.333333 4.333333
##          V2
## 1: 4.333333
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(<span style="color:#a6e22e">across</span>(<span style="color:#a6e22e">where</span>(is.numeric),
                   mean))
<span style="color:#75715e"># summarise_if(DF, is.numeric, mean)</span>
DF <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">summarise</span>(<span style="color:#a6e22e">across</span>(<span style="color:#a6e22e">where</span>(<span style="color:#f92672">~</span> <span style="color:#a6e22e">is.numeric</span>(.x) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">mean</span>(.x) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">3</span>), 
                        mean))
</code></pre></div><pre><code>## # A tibble: 1 x 2
##      V1    V2
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  2.33  4.33
## # A tibble: 1 x 1
##      V2
##   &lt;dbl&gt;
## 1  4.33
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, <span style="color:#a6e22e">lapply</span>(.SD, rev)]
</code></pre></div><pre><code>##    V1 V2 V4
## 1:  1  9  C
## 2:  4  8  B
## 3:  1  7  A
## 4:  4  6  C
## 5:  1  5  B
## 6:  4  4  A
## 7:  1  0  C
## 8:  4  0  B
## 9:  1  0  A
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(<span style="color:#a6e22e">across</span>(<span style="color:#a6e22e">everything</span>(),
                rev))
<span style="color:#75715e"># mutate_all(DF, rev)</span>
<span style="color:#75715e"># transmute_all(DF, rev)</span>
</code></pre></div><pre><code>## # A tibble: 9 x 3
##      V1    V2 V4   
##   &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;
## 1     1     9 C    
## 2     4     8 B    
## 3     1     7 A    
## 4     4     6 C    
## 5     1     5 B    
## 6     4     4 A    
## 7     1     0 C    
## 8     4     0 B    
## 9     1     0 A
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, <span style="color:#a6e22e">lapply</span>(.SD, sqrt),
     .SDcols <span style="color:#f92672">=</span> V1<span style="color:#f92672">:</span>V2]
DT[, <span style="color:#a6e22e">lapply</span>(.SD, exp),
     .SDcols <span style="color:#f92672">=</span> <span style="color:#f92672">!</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>]
</code></pre></div><pre><code>##    V1       V2
## 1:  1 0.000000
## 2:  2 0.000000
## 3:  1 0.000000
## 4:  2 2.000000
## 5:  1 2.236068
## 6:  2 2.449490
## 7:  1 2.645751
## 8:  2 2.828427
## 9:  1 3.000000
##           V1         V2
## 1:  2.718282    1.00000
## 2: 54.598150    1.00000
## 3:  2.718282    1.00000
## 4: 54.598150   54.59815
## 5:  2.718282  148.41316
## 6: 54.598150  403.42879
## 7:  2.718282 1096.63316
## 8: 54.598150 2980.95799
## 9:  2.718282 8103.08393
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">transmute</span>(<span style="color:#a6e22e">across</span>(<span style="color:#a6e22e">c</span>(V1, V2),
                 sqrt))
<span style="color:#75715e"># transmute_at(DF, c(&#34;V1&#34;, &#34;V2&#34;), sqrt)</span>
DF <span style="color:#f92672">%&gt;%</span> <span style="color:#a6e22e">transmute</span>(<span style="color:#a6e22e">across</span>(<span style="color:#f92672">-</span><span style="color:#a6e22e">any_of</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>),
                 exp))
<span style="color:#75715e"># transmute_at(DF, vars(-V4), exp)</span>
</code></pre></div><pre><code>## # A tibble: 9 x 2
##      V1    V2
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     1  0   
## 2     2  0   
## 3     1  0   
## 4     2  2   
## 5     1  2.24
## 6     2  2.45
## 7     1  2.65
## 8     2  2.83
## 9     1  3   
## # A tibble: 9 x 2
##      V1     V2
##   &lt;dbl&gt;  &lt;dbl&gt;
## 1  2.72    1  
## 2 54.6     1  
## 3  2.72    1  
## 4 54.6    54.6
## 5  2.72  148. 
## 6 54.6   403. 
## 7  2.72 1097. 
## 8 54.6  2981. 
## 9  2.72 8103.
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>) <span style="color:#f92672">:</span><span style="color:#f92672">=</span> <span style="color:#a6e22e">lapply</span>(.SD, sqrt),
     .SDcols <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>)]

cols <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">setdiff</span>(<span style="color:#a6e22e">names</span>(DT), <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>)
DT[, (cols) <span style="color:#f92672">:</span><span style="color:#f92672">=</span> <span style="color:#a6e22e">lapply</span>(.SD, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">^&#34;</span>, <span style="color:#ae81ff">2L</span>),
     .SDcols <span style="color:#f92672">=</span> cols]
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">&lt;-</span> DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(<span style="color:#a6e22e">across</span>(<span style="color:#a6e22e">all_of</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>)), sqrt))
<span style="color:#75715e"># DF &lt;- mutate_at(DF, c(&#34;V1&#34;, &#34;V2&#34;), sqrt)</span>
DF <span style="color:#f92672">&lt;-</span> DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(<span style="color:#a6e22e">across</span>(<span style="color:#f92672">-</span><span style="color:#a6e22e">any_of</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>),
                 <span style="color:#f92672">~</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">^&#34;</span>(.x, <span style="color:#ae81ff">2L</span>)))
<span style="color:#75715e"># DF &lt;- mutate_at(DF, vars(-V4), &#34;^&#34;, 2L)</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, .SD <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>,
     .SDcols <span style="color:#f92672">=</span> is.numeric]
</code></pre></div><pre><code>##    V1 V2
## 1:  0 -1
## 2:  3 -1
## 3:  0 -1
## 4:  3  3
## 5:  0  4
## 6:  3  5
## 7:  0  6
## 8:  3  7
## 9:  0  8
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">transmute</span>(<span style="color:#a6e22e">across</span>(<span style="color:#a6e22e">where</span>(is.numeric),
                   <span style="color:#f92672">~</span> <span style="color:#e6db74">&#39;</span><span style="color:#e6db74">-&#39;</span>(., <span style="color:#ae81ff">1L</span>)))
<span style="color:#75715e"># transmute_if(DF, is.numeric, list(~ &#39;-&#39;(., 1L)))</span>
</code></pre></div><pre><code>## # A tibble: 9 x 2
##      V1    V2
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     0 -1   
## 2     3 -1   
## 3     0 -1   
## 4     3  3   
## 5     0  4.  
## 6     3  5.00
## 7     0  6.  
## 8     3  7.  
## 9     0  8
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, (cols) <span style="color:#f92672">:</span><span style="color:#f92672">=</span> <span style="color:#a6e22e">lapply</span>(.SD, as.integer),
     .SDcols <span style="color:#f92672">=</span> is.numeric]
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">&lt;-</span> DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(<span style="color:#a6e22e">across</span>(<span style="color:#a6e22e">where</span>(is.numeric),
         as.integer))
<span style="color:#75715e"># DF &lt;- mutate_if(DF, is.numeric, as.integer)</span>
</code></pre></div><!-- raw HTML omitted -->
<p>The use of <code>DT[,j]</code> is very flexible, allowing to pass complex expressions in a straightforward way,
or combine expressions with multiple outputs.</p>
<h4 id="use-a-complex-expression">Use a complex expression</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, by <span style="color:#f92672">=</span> V4,
     .(V1[1<span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>], <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">X&#34;</span>)]
</code></pre></div><pre><code>##    V4 V1 V2
## 1:  A  1  X
## 2:  A  4  X
## 3:  B  4  X
## 4:  B  1  X
## 5:  C  1  X
## 6:  C  4  X
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">transmute</span>(V1 <span style="color:#f92672">=</span> V1,
            V2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">X&#34;</span>)
</code></pre></div><pre><code>## # A tibble: 6 x 3
## # Groups:   V4 [3]
##   V4       V1 V2   
##   &lt;chr&gt; &lt;int&gt; &lt;chr&gt;
## 1 A         1 X    
## 2 A         4 X    
## 3 B         4 X    
## 4 B         1 X    
## 5 C         1 X    
## 6 C         4 X
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, {<span style="color:#a6e22e">print</span>(V1) <span style="color:#75715e">#  comments here!</span>
      <span style="color:#a6e22e">print</span>(<span style="color:#a6e22e">summary</span>(V1))
      x <span style="color:#f92672">&lt;-</span> V1 <span style="color:#f92672">+</span> <span style="color:#a6e22e">sum</span>(V2)
     .(A <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span>.N, B <span style="color:#f92672">=</span> x) <span style="color:#75715e"># last list returned as a data.table</span>
     }]
</code></pre></div><pre><code>## [1] 1 4 1 4 1 4 1 4 1
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   1.000   1.000   1.000   2.333   4.000   4.000 
##    A  B
## 1: 1 39
## 2: 2 42
## 3: 3 39
## 4: 4 42
## 5: 5 39
## 6: 6 42
## 7: 7 39
## 8: 8 42
## 9: 9 39
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#</span>
</code></pre></div><!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="chain-expressions">Chain expressions</h3>
<p>The dplyr workflow relies on the magrittr pipe operator (<code>%&gt;%</code>).
The magrittr package can also be used with <code>data.table</code> objects,
but data.table comes with its own chaining system: <code>DT[ ... ][ ... ][ ... ]</code>.</p>
<h4 id="expression-chaining-using-dt-recommended">Expression chaining using <code>DT[][]</code> (recommended)</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, by <span style="color:#f92672">=</span> V4, 
     .(V1sum <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V1)) ][
     V1sum <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">5</span>]
</code></pre></div><pre><code>##    V4 V1sum
## 1:  A     6
## 2:  B     9
## 3:  C     6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(V1sum <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V1)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">filter</span>(V1sum <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">5</span>)
</code></pre></div><pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre><pre><code>## # A tibble: 3 x 2
##   V4    V1sum
##   &lt;chr&gt; &lt;int&gt;
## 1 A         6
## 2 B         9
## 3 C         6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, by <span style="color:#f92672">=</span> V4, 
     .(V1sum <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V1))] <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">.[order</span>(<span style="color:#f92672">-</span>V1sum)]
</code></pre></div><pre><code>##    V4 V1sum
## 1:  B     9
## 2:  A     6
## 3:  C     6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(V1sum <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V1)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">arrange</span>(<span style="color:#a6e22e">desc</span>(V1sum))
</code></pre></div><pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre><pre><code>## # A tibble: 3 x 2
##   V4    V1sum
##   &lt;chr&gt; &lt;int&gt;
## 1 B         9
## 2 A         6
## 3 C         6
</code></pre><!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="indexing-and-keys">Indexing and Keys</h3>
<p>Row subsetting in dplyr relies on the <code>filter()</code> and <code>slice()</code> functions, as shown in the first section.
With data.table, in addition to the above-mentioned approach, two systems are available
to make row filtering and join operations more convenient and blazingly fast (~170x speed-up):
<em>keys</em> (primary ordered index) and <em>indices</em> (automatic secondary indexing).</p>
<p>The main differences between keys and indices are:</p>
<ul>
<li>When using keys, data are physically reordered in memory. When using indices, the order is stored as an attribute.</li>
<li>Only one key is possible but several indices can coexist.</li>
<li>Keys are defined explicitly. Indices can be created manually but are also created on-the-fly (and stored when using <code>==</code> or <code>%in%</code>).</li>
<li>Indices are used with the <code>on</code> argument. It is optional when using keys, but recommended (and used below) for better readability.   <br>
Note: in the following code, we set both a key and an index to demonstrate their usage, but internally, indices are not used when a key already exists for the same columns(s).</li>
</ul>
<h4 id="set-the-keyindex">Set the key/index</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">setkey</span>(DT, V4)
<span style="color:#a6e22e">setindex</span>(DT, V4)
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">arrange</span>(DF, V4) <span style="color:#75715e"># ordered just for consistency</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>, on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>]
DT<span style="color:#a6e22e">[c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>), on <span style="color:#f92672">=</span> .(V4)] <span style="color:#75715e"># same as on = &#34;V4&#34;</span>
</code></pre></div><pre><code>##    V1 V2 V4
## 1:  1  0  A
## 2:  4  4  A
## 3:  1  7  A
##    V1 V2 V4
## 1:  1  0  A
## 2:  4  4  A
## 3:  1  7  A
## 4:  1  0  C
## 5:  4  5  C
## 6:  1  9  C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">filter</span>(DF, V4 <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>)
<span style="color:#a6e22e">filter</span>(DF, V4 <span style="color:#f92672">%in%</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>))
</code></pre></div><pre><code>## # A tibble: 3 x 3
##      V1    V2 V4   
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;
## 1     1     0 A    
## 2     4     4 A    
## 3     1     7 A    
## # A tibble: 6 x 3
##      V1    V2 V4   
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;
## 1     1     0 A    
## 2     4     4 A    
## 3     1     7 A    
## 4     1     0 C    
## 5     4     5 C    
## 6     1     9 C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">B&#34;</span>, on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>, mult <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">first&#34;</span>]
DT<span style="color:#a6e22e">[c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">B&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>), on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>, mult <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">first&#34;</span>]
</code></pre></div><pre><code>##    V1 V2 V4
## 1:  4  0  B
##    V1 V2 V4
## 1:  4  0  B
## 2:  1  0  C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">filter</span>(V4 <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">B&#34;</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">1</span>)
<span style="color:#75715e"># ?</span>
</code></pre></div><pre><code>## # A tibble: 1 x 3
##      V1    V2 V4   
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;
## 1     4     0 B
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>, on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>, mult <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">last&#34;</span>]
</code></pre></div><pre><code>##    V1 V2 V4
## 1:  1  7  A
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">filter</span>(V4 <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">slice</span>(<span style="color:#a6e22e">n</span>())
</code></pre></div><pre><code>## # A tibble: 1 x 3
##      V1    V2 V4   
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;
## 1     1     7 A
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># (default) returns a row with &#34;D&#34; even if not found</span>
DT<span style="color:#a6e22e">[c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">D&#34;</span>), on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>, nomatch <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>]
<span style="color:#75715e"># no rows for unmatched values</span>
DT<span style="color:#a6e22e">[c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">D&#34;</span>), on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>, nomatch <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>]
</code></pre></div><pre><code>##    V1 V2 V4
## 1:  1  0  A
## 2:  4  4  A
## 3:  1  7  A
## 4: NA NA  D
##    V1 V2 V4
## 1:  1  0  A
## 2:  4  4  A
## 3:  1  7  A
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#</span>
<span style="color:#a6e22e">filter</span>(DF, V4 <span style="color:#f92672">%in%</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">D&#34;</span>))
</code></pre></div><pre><code>## # A tibble: 3 x 3
##      V1    V2 V4   
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;
## 1     1     0 A    
## 2     4     4 A    
## 3     1     7 A
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT<span style="color:#a6e22e">[c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>), <span style="color:#a6e22e">sum</span>(V1), on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>]
</code></pre></div><pre><code>## [1] 12
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">filter</span>(V4 <span style="color:#f92672">%in%</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(<span style="color:#a6e22e">sum</span>(V1))
</code></pre></div><pre><code>## # A tibble: 1 x 1
##   `sum(V1)`
##       &lt;int&gt;
## 1        12
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>, V1 <span style="color:#f92672">:</span><span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>]
DT
</code></pre></div><pre><code>##    V1 V2 V4
## 1:  0  0  A
## 2:  0  4  A
## 3:  0  7  A
## 4:  4  0  B
## 5:  1  5  B
## 6:  4  8  B
## 7:  1  0  C
## 8:  4  5  C
## 9:  1  9  C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">&lt;-</span> DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(V1 <span style="color:#f92672">=</span> base<span style="color:#f92672">::</span><span style="color:#a6e22e">replace</span>(V1, V4 <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>, <span style="color:#ae81ff">0L</span>)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">arrange</span>(V4)
DF
</code></pre></div><pre><code>## # A tibble: 9 x 3
##      V1    V2 V4   
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;
## 1     0     0 A    
## 2     0     4 A    
## 3     0     7 A    
## 4     4     0 B    
## 5     1     5 B    
## 6     4     8 B    
## 7     1     0 C    
## 8     4     5 C    
## 9     1     9 C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[<span style="color:#f92672">!</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">B&#34;</span>, <span style="color:#a6e22e">sum</span>(V1), on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>, by <span style="color:#f92672">=</span> .EACHI]
DT[V4 <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">B&#34;</span>,
   by <span style="color:#f92672">=</span> V4,
   <span style="color:#a6e22e">sum</span>(V1)]   <span style="color:#75715e"># same</span>
</code></pre></div><pre><code>##    V4 V1
## 1:  A  0
## 2:  C  6
##    V4 V1
## 1:  A  0
## 2:  C  6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">filter</span>(V4 <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">B&#34;</span>) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(<span style="color:#a6e22e">sum</span>(V1))
</code></pre></div><pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre><pre><code>## # A tibble: 2 x 2
##   V4    `sum(V1)`
##   &lt;chr&gt;     &lt;int&gt;
## 1 A             0
## 2 C             6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">setkey</span>(DT, V4, V1) <span style="color:#75715e"># or setkeyv(DT, c(&#34;V4&#34;, &#34;V1&#34;))</span>
<span style="color:#a6e22e">setindex</span>(DT, V4, V1) <span style="color:#75715e"># setindexv(DT, c(&#34;V4&#34;, &#34;V1&#34;))</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">arrange</span>(DF, V4, V1) <span style="color:#75715e"># ordered just for consistency</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT<span style="color:#a6e22e">[.</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>, <span style="color:#ae81ff">1</span>), on <span style="color:#f92672">=</span> .(V4, V1)]
DT<span style="color:#a6e22e">[.</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">B&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>), <span style="color:#ae81ff">1</span>), on <span style="color:#f92672">=</span> .(V4, V1)]
<span style="color:#75715e"># using which = TRUE only returns the matching rows indices</span>
DT<span style="color:#a6e22e">[.</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">B&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>), <span style="color:#ae81ff">1</span>), on <span style="color:#f92672">=</span> .(V4, V1), which <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>]
</code></pre></div><pre><code>##    V1 V2 V4
## 1:  1  0  C
## 2:  1  9  C
##    V1 V2 V4
## 1:  1  5  B
## 2:  1  0  C
## 3:  1  9  C
## [1] 4 7 8
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">filter</span>(DF, V1 <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>, V4 <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>)
<span style="color:#a6e22e">filter</span>(DF, V1 <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>, V4 <span style="color:#f92672">%in%</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">B&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>))
<span style="color:#75715e"># ?</span>
</code></pre></div><pre><code>## # A tibble: 2 x 3
##      V1    V2 V4   
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;
## 1     1     0 C    
## 2     1     9 C    
## # A tibble: 3 x 3
##      V1    V2 V4   
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;
## 1     1     5 B    
## 2     1     0 C    
## 3     1     9 C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">setkey</span>(DT, <span style="color:#66d9ef">NULL</span>)
<span style="color:#a6e22e">setindex</span>(DT, <span style="color:#66d9ef">NULL</span>)
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># </span>
</code></pre></div><!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="set-modifications"><code>set*()</code> modifications</h3>
<p>In data.table, <code>set*()</code> functions modify objects by reference, making these operations fast and memory-efficient.
In case this is not a desired behaviour, users can use <code>copy()</code>.
The corresponding expressions in dplyr will be less memory-efficient.</p>
<h4 id="replace-values">Replace values</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">set</span>(DT, i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1L</span>, j <span style="color:#f92672">=</span> <span style="color:#ae81ff">2L</span>, value <span style="color:#f92672">=</span> <span style="color:#ae81ff">3L</span>)
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF[1, <span style="color:#ae81ff">2</span>] <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">3L</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">setorder</span>(DT, V4, <span style="color:#f92672">-</span>V1)
<span style="color:#a6e22e">setorderv</span>(DT, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>), <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">-1</span>))
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">arrange</span>(DF, V4, <span style="color:#a6e22e">desc</span>(V1))
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">setnames</span>(DT, old <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>, new <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">v2&#34;</span>)
<span style="color:#a6e22e">setnames</span>(DT, old <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>)), new <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>)
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rename</span>(DF, v2 <span style="color:#f92672">=</span> V2)
DF <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rename</span>(DF, V2 <span style="color:#f92672">=</span> v2) <span style="color:#75715e"># reset upper</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">setcolorder</span>(DT, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>))
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">select</span>(DF, V4, V1, V2)
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># coming soon (#4358)</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">relocate</span>(V4, .after <span style="color:#f92672">=</span> V2)
</code></pre></div><pre><code>## # A tibble: 9 x 3
##      V1    V2 V4   
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;
## 1     0     3 A    
## 2     0     4 A    
## 3     0     7 A    
## 4     4     0 B    
## 5     4     8 B    
## 6     1     5 B    
## 7     4     5 C    
## 8     1     0 C    
## 9     1     9 C
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># ?setDT # data.frame or list to data.table</span>
<span style="color:#75715e"># ?setDF # data.table to data.frame</span>
<span style="color:#75715e"># ?setattr # modify attributes</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># </span>
</code></pre></div><!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="advanced-use-of-by">Advanced use of by</h3>
<p>Context dependent expressions (<code>cur_*()</code>) have been introduced in dplyr 1.0.0, reflecting data.table aliases <code>.I</code>, <code>.GRP</code>, &hellip;</p>
<h4 id="select-firstlast-row-by-group">Select first/last/&hellip; row by group</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, .SD[1], by <span style="color:#f92672">=</span> V4]
DT[, .SD<span style="color:#a6e22e">[c</span>(<span style="color:#ae81ff">1</span>, .N)], by <span style="color:#f92672">=</span> V4]
DT[, <span style="color:#a6e22e">tail</span>(.SD, <span style="color:#ae81ff">2</span>), by <span style="color:#f92672">=</span> V4]
</code></pre></div><pre><code>##    V4 V1 V2
## 1:  A  0  3
## 2:  B  4  0
## 3:  C  4  5
##    V4 V1 V2
## 1:  A  0  3
## 2:  A  0  7
## 3:  B  4  0
## 4:  B  1  5
## 5:  C  4  5
## 6:  C  1  9
##    V4 V1 V2
## 1:  A  0  4
## 2:  A  0  7
## 3:  B  4  8
## 4:  B  1  5
## 5:  C  1  0
## 6:  C  1  9
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">1</span>)
DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">n</span>())
DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_map</span>(<span style="color:#f92672">~</span> <span style="color:#a6e22e">tail</span>(.x, <span style="color:#ae81ff">2</span>))
</code></pre></div><pre><code>## # A tibble: 3 x 3
## # Groups:   V4 [3]
##   V4       V1    V2
##   &lt;chr&gt; &lt;int&gt; &lt;int&gt;
## 1 A         0     3
## 2 B         4     0
## 3 C         4     5
## # A tibble: 6 x 3
## # Groups:   V4 [3]
##   V4       V1    V2
##   &lt;chr&gt; &lt;int&gt; &lt;int&gt;
## 1 A         0     3
## 2 A         0     7
## 3 B         4     0
## 4 B         1     5
## 5 C         4     5
## 6 C         1     9
## [[1]]
## # A tibble: 2 x 2
##      V1    V2
##   &lt;int&gt; &lt;int&gt;
## 1     0     4
## 2     0     7
## 
## [[2]]
## # A tibble: 2 x 2
##      V1    V2
##   &lt;int&gt; &lt;int&gt;
## 1     4     8
## 2     1     5
## 
## [[3]]
## # A tibble: 2 x 2
##      V1    V2
##   &lt;int&gt; &lt;int&gt;
## 1     1     0
## 2     1     9
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, .SD<span style="color:#a6e22e">[which.min</span>(V2)], by <span style="color:#f92672">=</span> V4]
</code></pre></div><pre><code>##    V4 V1 V2
## 1:  A  0  3
## 2:  B  4  0
## 3:  C  1  0
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">arrange</span>(V2) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">slice</span>(<span style="color:#ae81ff">1</span>)
</code></pre></div><pre><code>## # A tibble: 3 x 3
## # Groups:   V4 [3]
##   V4       V1    V2
##   &lt;chr&gt; &lt;int&gt; &lt;int&gt;
## 1 A         0     3
## 2 B         4     0
## 3 C         1     0
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, Grp <span style="color:#f92672">:</span><span style="color:#f92672">=</span> .GRP, by <span style="color:#f92672">=</span> .(V4, V1)][]
DT[, Grp <span style="color:#f92672">:</span><span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>] <span style="color:#75715e"># delete for consistency</span>
</code></pre></div><pre><code>##    V4 V1 V2 Grp
## 1:  A  0  3   1
## 2:  A  0  4   1
## 3:  A  0  7   1
## 4:  B  4  0   2
## 5:  B  4  8   2
## 6:  B  1  5   3
## 7:  C  4  5   4
## 8:  C  1  0   5
## 9:  C  1  9   5
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4, V1) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(Grp <span style="color:#f92672">=</span> <span style="color:#a6e22e">cur_group_id</span>())
<span style="color:#75715e"># DF %&gt;% mutate(Grp = group_indices(., V4, V1))</span>
</code></pre></div><pre><code>## # A tibble: 9 x 4
## # Groups:   V4, V1 [5]
##   V4       V1    V2   Grp
##   &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1 A         0     3     1
## 2 A         0     4     1
## 3 A         0     7     1
## 4 B         4     0     3
## 5 B         4     8     3
## 6 B         1     5     2
## 7 C         4     5     5
## 8 C         1     0     4
## 9 C         1     9     4
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, .I, by <span style="color:#f92672">=</span> V4] <span style="color:#75715e"># returns a data.table</span>
DT[, .I[1], by <span style="color:#f92672">=</span> V4]
DT[, .I<span style="color:#a6e22e">[c</span>(<span style="color:#ae81ff">1</span>, .N)], by <span style="color:#f92672">=</span> V4]
</code></pre></div><pre><code>##    V4 I
## 1:  A 1
## 2:  A 2
## 3:  A 3
## 4:  B 4
## 5:  B 5
## 6:  B 6
## 7:  C 7
## 8:  C 8
## 9:  C 9
##    V4 V1
## 1:  A  1
## 2:  B  4
## 3:  C  7
##    V4 V1
## 1:  A  1
## 2:  A  3
## 3:  B  4
## 4:  B  6
## 5:  C  7
## 6:  C  9
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(<span style="color:#a6e22e">cur_group_rows</span>())
<span style="color:#75715e">#DF %&gt;%</span>
<span style="color:#75715e">#  group_by(V4) %&gt;%</span>
<span style="color:#75715e">#  group_data() %&gt;%</span>
<span style="color:#75715e">#  tidyr::unnest(.rows)</span>
DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarize</span>(<span style="color:#a6e22e">cur_group_rows</span>()[1])
</code></pre></div><pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarize</span>(<span style="color:#a6e22e">cur_group_rows</span>()<span style="color:#a6e22e">[c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">n</span>())])
</code></pre></div><pre><code>## `summarise()` regrouping output by 'V4' (override with `.groups` argument)
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># DF %&gt;% group_by(V4) %&gt;% group_rows() # returns a list</span>
</code></pre></div><pre><code>## # A tibble: 9 x 4
## # Groups:   V4 [3]
##   V4       V1    V2 `cur_group_rows()`
##   &lt;chr&gt; &lt;int&gt; &lt;int&gt;              &lt;int&gt;
## 1 A         0     3                  1
## 2 A         0     4                  2
## 3 A         0     7                  3
## 4 B         4     0                  4
## 5 B         4     8                  5
## 6 B         1     5                  6
## 7 C         4     5                  7
## 8 C         1     0                  8
## 9 C         1     9                  9
## # A tibble: 3 x 2
##   V4    `cur_group_rows()[1]`
##   &lt;chr&gt;                 &lt;int&gt;
## 1 A                         1
## 2 B                         4
## 3 C                         7
## # A tibble: 6 x 2
## # Groups:   V4 [3]
##   V4    `cur_group_rows()[c(1, n())]`
##   &lt;chr&gt;                         &lt;int&gt;
## 1 A                                 1
## 2 A                                 3
## 3 B                                 4
## 4 B                                 6
## 5 C                                 7
## 6 C                                 9
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DT[, <span style="color:#a6e22e">.(.</span>(V1)),  by <span style="color:#f92672">=</span> V4]  <span style="color:#75715e"># return V1 as a list</span>
DT[, <span style="color:#a6e22e">.(.</span>(.SD)), by <span style="color:#f92672">=</span> V4] <span style="color:#75715e"># subsets of the data</span>
</code></pre></div><pre><code>##    V4    V1
## 1:  A 0,0,0
## 2:  B 4,4,1
## 3:  C 4,1,1
##    V4                V1
## 1:  A &lt;data.table[3x2]&gt;
## 2:  B &lt;data.table[3x2]&gt;
## 3:  C &lt;data.table[3x2]&gt;
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">summarise</span>(<span style="color:#a6e22e">list</span>(V1))
</code></pre></div><pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">DF <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(V4) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_nest</span>()
</code></pre></div><pre><code>## # A tibble: 3 x 2
##   V4    `list(V1)`
##   &lt;chr&gt; &lt;list&gt;    
## 1 A     &lt;int [3]&gt; 
## 2 B     &lt;int [3]&gt; 
## 3 C     &lt;int [3]&gt; 
## # A tibble: 3 x 2
##   V4                  data
##   &lt;chr&gt; &lt;list&lt;tbl_df[,2]&gt;&gt;
## 1 A                [3 × 2]
## 2 B                [3 × 2]
## 3 C                [3 × 2]
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">rollup</span>(DT,
       .(SumV2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V2)),
       by <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>))

<span style="color:#a6e22e">rollup</span>(DT,
       .(SumV2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V2), .N),
       by <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>),
       id <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)

<span style="color:#a6e22e">cube</span>(DT,
     .(SumV2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V2), .N),
     by <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>),
     id <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)

<span style="color:#a6e22e">groupingsets</span>(DT,
             .(SumV2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(V2), .N),
             by   <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>),
             sets <span style="color:#f92672">=</span> <span style="color:#a6e22e">list</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>)),
             id   <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><pre><code>##    V1   V4 SumV2
## 1:  0    A    14
## 2:  4    B     8
## 3:  1    B     5
## 4:  4    C     5
## 5:  1    C     9
## 6:  0 &lt;NA&gt;    14
## 7:  4 &lt;NA&gt;    13
## 8:  1 &lt;NA&gt;    14
## 9: NA &lt;NA&gt;    41
##    grouping V1   V4 SumV2 N
## 1:        0  0    A    14 3
## 2:        0  4    B     8 2
## 3:        0  1    B     5 1
## 4:        0  4    C     5 1
## 5:        0  1    C     9 2
## 6:        1  0 &lt;NA&gt;    14 3
## 7:        1  4 &lt;NA&gt;    13 3
## 8:        1  1 &lt;NA&gt;    14 3
## 9:        3 NA &lt;NA&gt;    41 9
##     grouping V1   V4 SumV2 N
##  1:        0  0    A    14 3
##  2:        0  4    B     8 2
##  3:        0  1    B     5 1
##  4:        0  4    C     5 1
##  5:        0  1    C     9 2
##  6:        1  0 &lt;NA&gt;    14 3
##  7:        1  4 &lt;NA&gt;    13 3
##  8:        1  1 &lt;NA&gt;    14 3
##  9:        2 NA    A    14 3
## 10:        2 NA    B    13 3
## 11:        2 NA    C    14 3
## 12:        3 NA &lt;NA&gt;    41 9
##    grouping V1   V4 SumV2 N
## 1:        1  0 &lt;NA&gt;    14 3
## 2:        1  4 &lt;NA&gt;    13 3
## 3:        1  1 &lt;NA&gt;    14 3
## 4:        0  0    A    14 3
## 5:        0  4    B     8 2
## 6:        0  1    B     5 1
## 7:        0  4    C     5 1
## 8:        0  1    C     9 2
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#</span>
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="miscellaneous">Miscellaneous</h1>
<h3 id="read--write-data">Read / Write data</h3>
<p><code>fread()</code> and <code>fwrite()</code> are among the most powerful functions of data.table.
They are not only incredibly fast (see <a href="https://www.h2o.ai/blog/fast-csv-writing-for-r/">benchmarks</a>),
they are also extremely robust.
The few commands below only scratch the surface and there are a lot of awesome features.
For example, <code>fread()</code> accepts <code>http</code> and <code>https</code> URLs directly as well as operating system commands such as <code>sed</code> and <code>awk</code> output.
Make sure to check the <a href="https://rdrr.io/cran/data.table/man/fread.html">docs</a>.  <br>
Here again, <code>fread()</code> and <code>fwrite()</code> are very versatile and allow to handle different file formats while dplyr delegates file reading and writing to the readr package with several specific functions (csv, tsv, delim, &hellip;).</p>
<h4 id="write-data-to-a-csv-file">Write data to a csv file</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">fwrite</span>(DT, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">DT.csv&#34;</span>)
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">readr<span style="color:#f92672">::</span><span style="color:#a6e22e">write_csv</span>(DF, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">DF.csv&#34;</span>)
<span style="color:#75715e"># see also vroom</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">fwrite</span>(DT, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">DT.txt&#34;</span>, sep <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">\t&#34;</span>)
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">readr<span style="color:#f92672">::</span><span style="color:#a6e22e">write_delim</span>(DF, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">DF.txt&#34;</span>, delim <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">\t&#34;</span>)
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">fwrite</span>(<span style="color:#a6e22e">setDT</span>(<span style="color:#a6e22e">list</span>(<span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">list</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">5</span>))), <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">DT2.csv&#34;</span>)
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">fread</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">DT.csv&#34;</span>)
<span style="color:#75715e"># fread(&#34;DT.csv&#34;, verbose = TRUE) # full details</span>
<span style="color:#a6e22e">fread</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">DT.txt&#34;</span>, sep <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">\t&#34;</span>)
</code></pre></div><pre><code>##    V4 V1 V2
## 1:  A  0  3
## 2:  A  0  4
## 3:  A  0  7
## 4:  B  4  0
## 5:  B  4  8
## 6:  B  1  5
## 7:  C  4  5
## 8:  C  1  0
## 9:  C  1  9
##    V4 V1 V2
## 1:  A  0  3
## 2:  A  0  4
## 3:  A  0  7
## 4:  B  4  0
## 5:  B  4  8
## 6:  B  1  5
## 7:  C  4  5
## 8:  C  1  0
## 9:  C  1  9
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">readr<span style="color:#f92672">::</span><span style="color:#a6e22e">read_csv</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">DF.csv&#34;</span>)
</code></pre></div><pre><code>## Parsed with column specification:
## cols(
##   V4 = col_character(),
##   V1 = col_double(),
##   V2 = col_double()
## )
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">readr<span style="color:#f92672">::</span><span style="color:#a6e22e">read_delim</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">DF.txt&#34;</span>, delim <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">\t&#34;</span>)
</code></pre></div><pre><code>## Parsed with column specification:
## cols(
##   V4 = col_character(),
##   V1 = col_double(),
##   V2 = col_double()
## )
</code></pre><pre><code>## # A tibble: 9 x 3
##   V4       V1    V2
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 A         0     3
## 2 A         0     4
## 3 A         0     7
## 4 B         4     0
## 5 B         4     8
## 6 B         1     5
## 7 C         4     5
## 8 C         1     0
## 9 C         1     9
## # A tibble: 9 x 3
##   V4       V1    V2
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 A         0     3
## 2 A         0     4
## 3 A         0     7
## 4 B         4     0
## 5 B         4     8
## 6 B         1     5
## 7 C         4     5
## 8 C         1     0
## 9 C         1     9
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">fread</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">DT.csv&#34;</span>, select <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>))
<span style="color:#a6e22e">fread</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">DT.csv&#34;</span>, drop <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>)
</code></pre></div><pre><code>##    V1 V4
## 1:  0  A
## 2:  0  A
## 3:  0  A
## 4:  4  B
## 5:  4  B
## 6:  1  B
## 7:  4  C
## 8:  1  C
## 9:  1  C
##    V1 V2
## 1:  0  3
## 2:  0  4
## 3:  0  7
## 4:  4  0
## 5:  4  8
## 6:  1  5
## 7:  4  5
## 8:  1  0
## 9:  1  9
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># NA</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">rbindlist</span>(<span style="color:#a6e22e">lapply</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">DT.csv&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">DT.csv&#34;</span>), fread))
<span style="color:#75715e"># c(&#34;DT.csv&#34;, &#34;DT.csv&#34;) %&gt;% lapply(fread) %&gt;% rbindlist</span>
</code></pre></div><pre><code>##     V4 V1 V2
##  1:  A  0  3
##  2:  A  0  4
##  3:  A  0  7
##  4:  B  4  0
##  5:  B  4  8
##  6:  B  1  5
##  7:  C  4  5
##  8:  C  1  0
##  9:  C  1  9
## 10:  A  0  3
## 11:  A  0  4
## 12:  A  0  7
## 13:  B  4  0
## 14:  B  4  8
## 15:  B  1  5
## 16:  C  4  5
## 17:  C  1  0
## 18:  C  1  9
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">DF.csv&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">DF.csv&#34;</span>) <span style="color:#f92672">%&gt;%</span>
  purrr<span style="color:#f92672">::</span><span style="color:#a6e22e">map_dfr</span>(readr<span style="color:#f92672">::</span>read_csv)
</code></pre></div><pre><code>## Parsed with column specification:
## cols(
##   V4 = col_character(),
##   V1 = col_double(),
##   V2 = col_double()
## )
## Parsed with column specification:
## cols(
##   V4 = col_character(),
##   V1 = col_double(),
##   V2 = col_double()
## )
</code></pre><pre><code>## # A tibble: 18 x 3
##    V4       V1    V2
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 A         0     3
##  2 A         0     4
##  3 A         0     7
##  4 B         4     0
##  5 B         4     8
##  6 B         1     5
##  7 C         4     5
##  8 C         1     0
##  9 C         1     9
## 10 A         0     3
## 11 A         0     4
## 12 A         0     7
## 13 B         4     0
## 14 B         4     8
## 15 B         1     5
## 16 C         4     5
## 17 C         1     0
## 18 C         1     9
</code></pre><!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="reshape-data">Reshape data</h3>
<p>This part is still a bit clunky. I need to find better examples. See <a href="https://cran.r-project.org/web/packages/data.table/vignettes/datatable-reshape.html">here</a> and <a href="https://tidyr.tidyverse.org/">here</a> for more details.</p>
<h4 id="melt-data-from-wide-to-long">Melt data (from wide to long)</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">melt</span>(DT, id.vars <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>)
mDT <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">melt</span>(DT,
            id.vars       <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>,
            measure.vars  <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>),
            variable.name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Variable&#34;</span>,
            value.name    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Value&#34;</span>)
</code></pre></div><pre><code>##     V4 variable value
##  1:  A       V1     0
##  2:  A       V1     0
##  3:  A       V1     0
##  4:  B       V1     4
##  5:  B       V1     4
##  6:  B       V1     1
##  7:  C       V1     4
##  8:  C       V1     1
##  9:  C       V1     1
## 10:  A       V2     3
## 11:  A       V2     4
## 12:  A       V2     7
## 13:  B       V2     0
## 14:  B       V2     8
## 15:  B       V2     5
## 16:  C       V2     5
## 17:  C       V2     0
## 18:  C       V2     9
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">tidyr<span style="color:#f92672">::</span><span style="color:#a6e22e">gather</span>(DF, variable, value, <span style="color:#f92672">-</span>V4)
mDF <span style="color:#f92672">&lt;-</span> tidyr<span style="color:#f92672">::</span><span style="color:#a6e22e">gather</span>(DF,
                     key <span style="color:#f92672">=</span> Variable,
                     value <span style="color:#f92672">=</span> Value,
                     <span style="color:#f92672">-</span>V4)
<span style="color:#75715e"># pivot_longer todo</span>
</code></pre></div><pre><code>## # A tibble: 18 x 3
##    V4    variable value
##    &lt;chr&gt; &lt;chr&gt;    &lt;int&gt;
##  1 A     V1           0
##  2 A     V1           0
##  3 A     V1           0
##  4 B     V1           4
##  5 B     V1           4
##  6 B     V1           1
##  7 C     V1           4
##  8 C     V1           1
##  9 C     V1           1
## 10 A     V2           3
## 11 A     V2           4
## 12 A     V2           7
## 13 B     V2           0
## 14 B     V2           8
## 15 B     V2           5
## 16 C     V2           5
## 17 C     V2           0
## 18 C     V2           9
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">dcast</span>(mDT, V4 <span style="color:#f92672">~</span> Variable) <span style="color:#75715e"># aggregate by count</span>
</code></pre></div><pre><code>## Using 'Value' as value column. Use 'value.var' to override
</code></pre><pre><code>## Aggregate function missing, defaulting to 'length'
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">dcast</span>(mDT, V4 <span style="color:#f92672">~</span> Variable, fun.aggregate <span style="color:#f92672">=</span> sum)
</code></pre></div><pre><code>## Using 'Value' as value column. Use 'value.var' to override
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">dcast</span>(mDT, V4 <span style="color:#f92672">~</span> Value <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">5</span>)
</code></pre></div><pre><code>## Using 'Value' as value column. Use 'value.var' to override
## Aggregate function missing, defaulting to 'length'
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># see ?dcast: multiple values / fun.aggregate</span>
</code></pre></div><pre><code>##    V4 V1 V2
## 1:  A  3  3
## 2:  B  3  3
## 3:  C  3  3
##    V4 V1 V2
## 1:  A  0 14
## 2:  B  9 13
## 3:  C  6 14
##    V4 FALSE TRUE
## 1:  A     5    1
## 2:  B     5    1
## 3:  C     5    1
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">tidyr<span style="color:#f92672">::</span><span style="color:#a6e22e">spread</span>(data  <span style="color:#f92672">=</span> <span style="color:#a6e22e">count</span>(mDF, V4, Variable),
              key   <span style="color:#f92672">=</span> Variable,
              value <span style="color:#f92672">=</span> n,
              fill  <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)
<span style="color:#75715e"># pivot_wider todo</span>
</code></pre></div><pre><code>## # A tibble: 3 x 3
##   V4       V1    V2
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 A         3     3
## 2 B         3     3
## 3 C         3     3
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">split</span>(DT, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V4&#34;</span>) <span style="color:#75715e"># S3 method</span>
</code></pre></div><pre><code>## $A
##    V4 V1 V2
## 1:  A  0  3
## 2:  A  0  4
## 3:  A  0  7
## 
## $B
##    V4 V1 V2
## 1:  B  4  0
## 2:  B  4  8
## 3:  B  1  5
## 
## $C
##    V4 V1 V2
## 1:  C  4  5
## 2:  C  1  0
## 3:  C  1  9
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">group_split</span>(DF, V4)
</code></pre></div><pre><code>## &lt;list_of&lt;
##   tbl_df&lt;
##     V4: character
##     V1: integer
##     V2: integer
##   &gt;
## &gt;[3]&gt;
## [[1]]
## # A tibble: 3 x 3
##   V4       V1    V2
##   &lt;chr&gt; &lt;int&gt; &lt;int&gt;
## 1 A         0     3
## 2 A         0     4
## 3 A         0     7
## 
## [[2]]
## # A tibble: 3 x 3
##   V4       V1    V2
##   &lt;chr&gt; &lt;int&gt; &lt;int&gt;
## 1 B         4     0
## 2 B         4     8
## 3 B         1     5
## 
## [[3]]
## # A tibble: 3 x 3
##   V4       V1    V2
##   &lt;chr&gt; &lt;int&gt; &lt;int&gt;
## 1 C         4     5
## 2 C         1     0
## 3 C         1     9
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">vec <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A:a&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">B:b&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C:c&#34;</span>)
<span style="color:#a6e22e">tstrsplit</span>(vec, split <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">:&#34;</span>, keep <span style="color:#f92672">=</span> <span style="color:#ae81ff">2L</span>) <span style="color:#75715e"># works on vector</span>
<span style="color:#a6e22e">setDT</span>(<span style="color:#a6e22e">tstrsplit</span>(vec, split <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">:&#34;</span>))[]
</code></pre></div><pre><code>## [[1]]
## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;
## 
##    V1 V2
## 1:  A  a
## 2:  B  b
## 3:  C  c
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">vec <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A:a&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">B:b&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C:c&#34;</span>)
<span style="color:#75715e"># vector not handled</span>
tidyr<span style="color:#f92672">::</span><span style="color:#a6e22e">separate</span>(<span style="color:#a6e22e">tibble</span>(vec), vec, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V1&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">V2&#34;</span>))
</code></pre></div><pre><code>## # A tibble: 3 x 2
##   V1    V2   
##   &lt;chr&gt; &lt;chr&gt;
## 1 A     a    
## 2 B     b    
## 3 C     c
</code></pre><!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="other">Other</h3>
<h4 id="check-package-installation">Check package installation</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># test.data.table()</span>
<span style="color:#75715e"># There&#39;s more lines of test code in data.table than there is code!</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">tables</span>()
</code></pre></div><pre><code>##    NAME NROW NCOL MB              COLS KEY
## 1:   DT    9    3  0          V4,V1,V2    
## 2:  mDT   18    3  0 V4,Variable,Value    
## Total: 0MB
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">getDTthreads</span>() <span style="color:#75715e"># setDTthreads()</span>
</code></pre></div><pre><code>## [1] 2
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">shift</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, n <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,   fill <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">lag&#34;</span>)
<span style="color:#a6e22e">shift</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, n <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>, fill <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">lag&#34;</span>) <span style="color:#75715e"># multiple</span>
<span style="color:#a6e22e">shift</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, n <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,   fill <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>, type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">lead&#34;</span>)
</code></pre></div><pre><code>##  [1] NA  1  2  3  4  5  6  7  8  9
## [[1]]
##  [1] NA  1  2  3  4  5  6  7  8  9
## 
## [[2]]
##  [1] NA NA  1  2  3  4  5  6  7  8
## 
##  [1]  2  3  4  5  6  7  8  9 10 NA
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">lag</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, n <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, default <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>)
purrr<span style="color:#f92672">::</span><span style="color:#a6e22e">map</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">~</span><span style="color:#a6e22e">lag</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, n <span style="color:#f92672">=</span> .x))
<span style="color:#a6e22e">lead</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>, n <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, default <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>)
</code></pre></div><pre><code>##  [1] NA  1  2  3  4  5  6  7  8  9
## [[1]]
##  [1] NA  1  2  3  4  5  6  7  8  9
## 
## [[2]]
##  [1] NA NA  1  2  3  4  5  6  7  8
## 
##  [1]  2  3  4  5  6  7  8  9 10 NA
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">rleid</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">a&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">b&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">a&#34;</span>), each <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)) <span style="color:#75715e"># see also ?rleidv</span>
<span style="color:#a6e22e">rleid</span>(<span style="color:#a6e22e">rep</span>(<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">a&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">b&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">a&#34;</span>), each <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>), prefix <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">G&#34;</span>)
</code></pre></div><pre><code>## [1] 1 1 1 2 2 2 3 3 3
## [1] &quot;G1&quot; &quot;G1&quot; &quot;G1&quot; &quot;G2&quot; &quot;G2&quot; &quot;G2&quot; &quot;G3&quot; &quot;G3&quot; &quot;G3&quot;
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>, <span style="color:#66d9ef">NA</span>)
<span style="color:#a6e22e">fifelse</span>(test <span style="color:#f92672">=</span> x <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>,
        yes  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">neg&#34;</span>,
        no   <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">pos&#34;</span>,
        na   <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">NA&#34;</span>)
</code></pre></div><pre><code>## [1] &quot;neg&quot; &quot;neg&quot; &quot;neg&quot; &quot;pos&quot; &quot;pos&quot; &quot;pos&quot; &quot;pos&quot; &quot;NA&quot;
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>, <span style="color:#66d9ef">NA</span>)
<span style="color:#a6e22e">if_else</span>(condition <span style="color:#f92672">=</span> x <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>,
        true      <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">neg&#34;</span>,
        false     <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">pos&#34;</span>,
        missing   <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">NA&#34;</span>)
</code></pre></div><pre><code>## [1] &quot;neg&quot; &quot;neg&quot; &quot;neg&quot; &quot;pos&quot; &quot;pos&quot; &quot;pos&quot; &quot;pos&quot; &quot;NA&quot;
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>
<span style="color:#a6e22e">fcase</span>(
  x <span style="color:#f92672">%%</span> <span style="color:#ae81ff">6</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">fizz buzz&#34;</span>,
  x <span style="color:#f92672">%%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">fizz&#34;</span>,
  x <span style="color:#f92672">%%</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">buzz&#34;</span>,
  default <span style="color:#f92672">=</span> <span style="color:#75715e">#NA_character_</span>
)
</code></pre></div><pre><code>##  [1] NA          &quot;fizz&quot;      &quot;buzz&quot;      &quot;fizz&quot;      NA          &quot;fizz buzz&quot;
##  [7] NA          &quot;fizz&quot;      &quot;buzz&quot;      &quot;fizz&quot;
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">10</span>
<span style="color:#a6e22e">case_when</span>(
  x <span style="color:#f92672">%%</span> <span style="color:#ae81ff">6</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">~</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">fizz buzz&#34;</span>,
  x <span style="color:#f92672">%%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">~</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">fizz&#34;</span>,
  x <span style="color:#f92672">%%</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">~</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">buzz&#34;</span>,
  <span style="color:#66d9ef">TRUE</span> <span style="color:#f92672">~</span> <span style="color:#a6e22e">as.character</span>(x)
)
</code></pre></div><pre><code>##  [1] &quot;1&quot;         &quot;fizz&quot;      &quot;buzz&quot;      &quot;fizz&quot;      &quot;5&quot;         &quot;fizz buzz&quot;
##  [7] &quot;7&quot;         &quot;fizz&quot;      &quot;buzz&quot;      &quot;fizz&quot;
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># todo</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#</span>
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="joinbind-data-sets">Join/Bind data sets</h1>
<h3 id="join">Join</h3>
<p>Joining data in data.table works like the fast subsetting approach described above. It can be performed using keys, using the <em>ad hoc</em> <code>on</code> argument, or using the <code>merge.data.table</code> method. For the sake of completeness, the three methods are presented below. As previously mentioned, the <code>on</code> and <code>by</code> (in <code>merge</code>) arguments are optional with keyed data.tables, but recommended to make the code more explicit. <br>
In the examples below, the <code>x</code>, <code>y</code>, and <code>z</code> data.tables are also used with dplyr.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.table</span>(Id  <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">B&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>),
                X1  <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1L</span>, <span style="color:#ae81ff">3L</span>, <span style="color:#ae81ff">5L</span>, <span style="color:#ae81ff">7L</span>),
                XY  <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">x2&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">x4&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">x6&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">x8&#34;</span>),
                key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>)

y <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.table</span>(Id  <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">A&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">B&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">B&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">D&#34;</span>),
                Y1  <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1L</span>, <span style="color:#ae81ff">3L</span>, <span style="color:#ae81ff">5L</span>, <span style="color:#ae81ff">7L</span>),
                XY  <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">y1&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">y3&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">y5&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">y7&#34;</span>),
                key <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>)
</code></pre></div><h4 id="join-matching-rows-from-y-to-x">Join matching rows from y to x</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">y[x, on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>]
<span style="color:#a6e22e">merge</span>(x, y, all.x <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>)
y[x] <span style="color:#75715e"># requires keys</span>
</code></pre></div><pre><code>##    Id Y1   XY X1 i.XY
## 1:  A  1   y1  1   x2
## 2:  B  3   y3  3   x4
## 3:  B  5   y5  3   x4
## 4:  C NA &lt;NA&gt;  5   x6
## 5:  C NA &lt;NA&gt;  7   x8
##    Id X1 XY.x Y1 XY.y
## 1:  A  1   x2  1   y1
## 2:  B  3   x4  3   y3
## 3:  B  3   x4  5   y5
## 4:  C  5   x6 NA &lt;NA&gt;
## 5:  C  7   x8 NA &lt;NA&gt;
##    Id Y1   XY X1 i.XY
## 1:  A  1   y1  1   x2
## 2:  B  3   y3  3   x4
## 3:  B  5   y5  3   x4
## 4:  C NA &lt;NA&gt;  5   x6
## 5:  C NA &lt;NA&gt;  7   x8
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">left_join</span>(x, y, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>)
</code></pre></div><pre><code>##    Id X1 XY.x Y1 XY.y
## 1:  A  1   x2  1   y1
## 2:  B  3   x4  3   y3
## 3:  B  3   x4  5   y5
## 4:  C  5   x6 NA &lt;NA&gt;
## 5:  C  7   x8 NA &lt;NA&gt;
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x[y, on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>]
<span style="color:#a6e22e">merge</span>(x, y, all.y <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>)
x[y] <span style="color:#75715e"># requires keys</span>
</code></pre></div><pre><code>##    Id X1   XY Y1 i.XY
## 1:  A  1   x2  1   y1
## 2:  B  3   x4  3   y3
## 3:  B  3   x4  5   y5
## 4:  D NA &lt;NA&gt;  7   y7
##    Id X1 XY.x Y1 XY.y
## 1:  A  1   x2  1   y1
## 2:  B  3   x4  3   y3
## 3:  B  3   x4  5   y5
## 4:  D NA &lt;NA&gt;  7   y7
##    Id X1   XY Y1 i.XY
## 1:  A  1   x2  1   y1
## 2:  B  3   x4  3   y3
## 3:  B  3   x4  5   y5
## 4:  D NA &lt;NA&gt;  7   y7
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">right_join</span>(x, y, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>)
</code></pre></div><pre><code>##    Id X1 XY.x Y1 XY.y
## 1:  A  1   x2  1   y1
## 2:  B  3   x4  3   y3
## 3:  B  3   x4  5   y5
## 4:  D NA &lt;NA&gt;  7   y7
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x[y, on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>, nomatch <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>]
<span style="color:#a6e22e">merge</span>(x, y)
x[y, nomatch <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>] <span style="color:#75715e"># requires keys</span>
</code></pre></div><pre><code>##    Id X1 XY Y1 i.XY
## 1:  A  1 x2  1   y1
## 2:  B  3 x4  3   y3
## 3:  B  3 x4  5   y5
##    Id X1 XY.x Y1 XY.y
## 1:  A  1   x2  1   y1
## 2:  B  3   x4  3   y3
## 3:  B  3   x4  5   y5
##    Id X1 XY Y1 i.XY
## 1:  A  1 x2  1   y1
## 2:  B  3 x4  3   y3
## 3:  B  3 x4  5   y5
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">inner_join</span>(x, y, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>)
</code></pre></div><pre><code>##    Id X1 XY.x Y1 XY.y
## 1:  A  1   x2  1   y1
## 2:  B  3   x4  3   y3
## 3:  B  3   x4  5   y5
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">merge</span>(x, y, all <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>)
</code></pre></div><pre><code>##    Id X1 XY.x Y1 XY.y
## 1:  A  1   x2  1   y1
## 2:  B  3   x4  3   y3
## 3:  B  3   x4  5   y5
## 4:  C  5   x6 NA &lt;NA&gt;
## 5:  C  7   x8 NA &lt;NA&gt;
## 6:  D NA &lt;NA&gt;  7   y7
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">full_join</span>(x, y, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>)
</code></pre></div><pre><code>##    Id X1 XY.x Y1 XY.y
## 1:  A  1   x2  1   y1
## 2:  B  3   x4  3   y3
## 3:  B  3   x4  5   y5
## 4:  C  5   x6 NA &lt;NA&gt;
## 5:  C  7   x8 NA &lt;NA&gt;
## 6:  D NA &lt;NA&gt;  7   y7
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">unique</span>(x[y<span style="color:#f92672">$</span>Id, on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>, nomatch <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>])
<span style="color:#a6e22e">unique</span>(x[y<span style="color:#f92672">$</span>Id, nomatch <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>]) <span style="color:#75715e"># requires keys</span>
</code></pre></div><pre><code>##    Id X1 XY
## 1:  A  1 x2
## 2:  B  3 x4
##    Id X1 XY
## 1:  A  1 x2
## 2:  B  3 x4
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">semi_join</span>(x, y, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>)
</code></pre></div><pre><code>##    Id X1 XY
## 1:  A  1 x2
## 2:  B  3 x4
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x[<span style="color:#f92672">!</span>y, on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>]
x[<span style="color:#f92672">!</span>y] <span style="color:#75715e"># requires keys</span>
</code></pre></div><pre><code>##    Id X1 XY
## 1:  C  5 x6
## 2:  C  7 x8
##    Id X1 XY
## 1:  C  5 x6
## 2:  C  7 x8
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">anti_join</span>(x, y, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>)
</code></pre></div><pre><code>##    Id X1 XY
## 1:  C  5 x6
## 2:  C  7 x8
</code></pre><!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="more-joins">More joins</h3>
<p>data.table excels at joining data, and offers additional functions and features.</p>
<h4 id="select-columns-while-joining">Select columns while joining</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x[y, .(Id, X1, i.XY)]   <span style="color:#75715e"># i. prefix refers to cols in y</span>
x[y, .(Id, x.XY, i.XY)] <span style="color:#75715e"># x. prefix refers to cols in x</span>
</code></pre></div><pre><code>##    Id X1 i.XY
## 1:  A  1   y1
## 2:  B  3   y3
## 3:  B  3   y5
## 4:  D NA   y7
##    Id x.XY i.XY
## 1:  A   x2   y1
## 2:  B   x4   y3
## 3:  B   x4   y5
## 4:  D &lt;NA&gt;   y7
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">right_join</span>(<span style="color:#a6e22e">select</span>(x, Id, X1),
           <span style="color:#a6e22e">select</span>(y, Id, XY),
           by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>)
<span style="color:#a6e22e">right_join</span>(<span style="color:#a6e22e">select</span>(x, Id, XY),
           <span style="color:#a6e22e">select</span>(y, Id, XY),
           by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>)
</code></pre></div><pre><code>##    Id X1 XY
## 1:  A  1 y1
## 2:  B  3 y3
## 3:  B  3 y5
## 4:  D NA y7
##    Id XY.x XY.y
## 1:  A   x2   y1
## 2:  B   x4   y3
## 3:  B   x4   y5
## 4:  D &lt;NA&gt;   y7
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">y[x, .(X1Y1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(Y1) <span style="color:#f92672">*</span> X1), by <span style="color:#f92672">=</span> .EACHI]
</code></pre></div><pre><code>##    Id X1Y1
## 1:  A    1
## 2:  B   24
## 3:  C   NA
## 4:  C   NA
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">y <span style="color:#f92672">%&gt;%</span>
 <span style="color:#a6e22e">group_by</span>(Id) <span style="color:#f92672">%&gt;%</span>
 <span style="color:#a6e22e">summarise</span>(SumY1 <span style="color:#f92672">=</span> <span style="color:#a6e22e">sum</span>(Y1)) <span style="color:#f92672">%&gt;%</span>
 <span style="color:#a6e22e">right_join</span>(x) <span style="color:#f92672">%&gt;%</span>
 <span style="color:#a6e22e">mutate</span>(X1Y1 <span style="color:#f92672">=</span> SumY1 <span style="color:#f92672">*</span> X1) <span style="color:#f92672">%&gt;%</span>
 <span style="color:#a6e22e">select</span>(Id, X1Y1)
</code></pre></div><pre><code>## `summarise()` ungrouping output (override with `.groups` argument)
</code></pre><pre><code>## Joining, by = &quot;Id&quot;
</code></pre><pre><code>## # A tibble: 4 x 2
##   Id     X1Y1
##   &lt;chr&gt; &lt;int&gt;
## 1 A         1
## 2 B        24
## 3 C        NA
## 4 C        NA
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">y[x, SqX1 <span style="color:#f92672">:</span><span style="color:#f92672">=</span> i.X1^2]
y[, SqX1 <span style="color:#f92672">:</span><span style="color:#f92672">=</span> x[.BY, X1^2, on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>], by <span style="color:#f92672">=</span> Id] <span style="color:#75715e"># more memory-efficient</span>
y[, SqX1 <span style="color:#f92672">:</span><span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>] <span style="color:#75715e"># rm column for consistency</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">%&gt;%</span>
 <span style="color:#a6e22e">select</span>(Id, X1) <span style="color:#f92672">%&gt;%</span>
 <span style="color:#a6e22e">mutate</span>(SqX1 <span style="color:#f92672">=</span> X1^2) <span style="color:#f92672">%&gt;%</span>
 <span style="color:#a6e22e">right_join</span>(y, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>) <span style="color:#f92672">%&gt;%</span>
 <span style="color:#a6e22e">select</span>(<span style="color:#a6e22e">names</span>(y), SqX1)
</code></pre></div><pre><code>##    Id Y1 XY SqX1
## 1:  A  1 y1    1
## 2:  B  3 y3    9
## 3:  B  5 y5    9
## 4:  D  7 y7   NA
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x[, y <span style="color:#f92672">:</span><span style="color:#f92672">=</span> <span style="color:#a6e22e">.(.</span>(y[.BY, on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>])), by <span style="color:#f92672">=</span> Id]
x[, y <span style="color:#f92672">:</span><span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>] <span style="color:#75715e"># rm column for consistency</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">nest_join</span>(x, y, by <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span>)
</code></pre></div><pre><code>##    Id X1 XY             y
## 1:  A  1 x2 &lt;tbl_df[1x2]&gt;
## 2:  B  3 x4 &lt;tbl_df[2x2]&gt;
## 3:  C  5 x6 &lt;tbl_df[0x2]&gt;
## 4:  C  7 x8 &lt;tbl_df[0x2]&gt;
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">cols  <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">NewXY&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">NewX1&#34;</span>)
icols <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">i.&#34;</span>, <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">XY&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">X1&#34;</span>))

y[x, (cols) <span style="color:#f92672">:</span><span style="color:#f92672">=</span> <span style="color:#a6e22e">mget</span>(icols)]

y[, (cols) <span style="color:#f92672">:</span><span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>] <span style="color:#75715e"># rm columns for consistency</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># ?</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">z <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.table</span>(ID <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>, Z1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>, Z2 <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">z&#34;</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>))
x[, X2 <span style="color:#f92672">:</span><span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">x&#34;</span>, X1)] <span style="color:#75715e"># used to track the results</span>
z; x
</code></pre></div><pre><code>##    ID Z1 Z2
## 1:  C  5 z5
## 2:  C  6 z6
## 3:  C  7 z7
## 4:  C  8 z8
## 5:  C  9 z9
##    Id X1 XY X2
## 1:  A  1 x2 x1
## 2:  B  3 x4 x3
## 3:  C  5 x6 x5
## 4:  C  7 x8 x7
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x[z, on <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">X1 == Z1&#34;</span>]
x[z, on <span style="color:#f92672">=</span> .(X1 <span style="color:#f92672">==</span> Z1)] <span style="color:#75715e"># same</span>
x[z, on <span style="color:#f92672">=</span> .(Id <span style="color:#f92672">==</span> ID, X1 <span style="color:#f92672">==</span> Z1)] <span style="color:#75715e"># using two columns</span>
</code></pre></div><pre><code>##      Id X1   XY   X2 ID Z2
## 1:    C  5   x6   x5  C z5
## 2: &lt;NA&gt;  6 &lt;NA&gt; &lt;NA&gt;  C z6
## 3:    C  7   x8   x7  C z7
## 4: &lt;NA&gt;  8 &lt;NA&gt; &lt;NA&gt;  C z8
## 5: &lt;NA&gt;  9 &lt;NA&gt; &lt;NA&gt;  C z9
##      Id X1   XY   X2 ID Z2
## 1:    C  5   x6   x5  C z5
## 2: &lt;NA&gt;  6 &lt;NA&gt; &lt;NA&gt;  C z6
## 3:    C  7   x8   x7  C z7
## 4: &lt;NA&gt;  8 &lt;NA&gt; &lt;NA&gt;  C z8
## 5: &lt;NA&gt;  9 &lt;NA&gt; &lt;NA&gt;  C z9
##    Id X1   XY   X2 Z2
## 1:  C  5   x6   x5 z5
## 2:  C  6 &lt;NA&gt; &lt;NA&gt; z6
## 3:  C  7   x8   x7 z7
## 4:  C  8 &lt;NA&gt; &lt;NA&gt; z8
## 5:  C  9 &lt;NA&gt; &lt;NA&gt; z9
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">right_join</span>(x, z, by <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">X1&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Z1&#34;</span>))
<span style="color:#a6e22e">right_join</span>(x, z, by <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Id&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">ID&#34;</span>, <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">X1&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Z1&#34;</span>))
</code></pre></div><pre><code>##      Id X1   XY   X2 ID Z2
## 1:    C  5   x6   x5  C z5
## 2:    C  7   x8   x7  C z7
## 3: &lt;NA&gt;  6 &lt;NA&gt; &lt;NA&gt;  C z6
## 4: &lt;NA&gt;  8 &lt;NA&gt; &lt;NA&gt;  C z8
## 5: &lt;NA&gt;  9 &lt;NA&gt; &lt;NA&gt;  C z9
##    Id X1   XY   X2 Z2
## 1:  C  5   x6   x5 z5
## 2:  C  7   x8   x7 z7
## 3:  C  6 &lt;NA&gt; &lt;NA&gt; z6
## 4:  C  8 &lt;NA&gt; &lt;NA&gt; z8
## 5:  C  9 &lt;NA&gt; &lt;NA&gt; z9
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x[z, on <span style="color:#f92672">=</span> .(Id <span style="color:#f92672">==</span> ID, X1 <span style="color:#f92672">&lt;=</span> Z1)]
x[z, on <span style="color:#f92672">=</span> .(Id <span style="color:#f92672">==</span> ID, X1 <span style="color:#f92672">&gt;</span> Z1)]
x[z, on <span style="color:#f92672">=</span> .(X1 <span style="color:#f92672">&lt;</span> Z1), allow.cartesian <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>] <span style="color:#75715e"># allows &#39;numerous&#39; matching values</span>
</code></pre></div><pre><code>##    Id X1 XY X2 Z2
## 1:  C  5 x6 x5 z5
## 2:  C  6 x6 x5 z6
## 3:  C  7 x6 x5 z7
## 4:  C  7 x8 x7 z7
## 5:  C  8 x6 x5 z8
## 6:  C  8 x8 x7 z8
## 7:  C  9 x6 x5 z9
## 8:  C  9 x8 x7 z9
##    Id X1   XY   X2 Z2
## 1:  C  5   x8   x7 z5
## 2:  C  6   x8   x7 z6
## 3:  C  7 &lt;NA&gt; &lt;NA&gt; z7
## 4:  C  8 &lt;NA&gt; &lt;NA&gt; z8
## 5:  C  9 &lt;NA&gt; &lt;NA&gt; z9
##     Id X1 XY X2 ID Z2
##  1:  A  5 x2 x1  C z5
##  2:  B  5 x4 x3  C z5
##  3:  A  6 x2 x1  C z6
##  4:  B  6 x4 x3  C z6
##  5:  C  6 x6 x5  C z6
##  6:  A  7 x2 x1  C z7
##  7:  B  7 x4 x3  C z7
##  8:  C  7 x6 x5  C z7
##  9:  A  8 x2 x1  C z8
## 10:  B  8 x4 x3  C z8
## 11:  C  8 x6 x5  C z8
## 12:  C  8 x8 x7  C z8
## 13:  A  9 x2 x1  C z9
## 14:  B  9 x4 x3  C z9
## 15:  C  9 x6 x5  C z9
## 16:  C  9 x8 x7  C z9
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Nearest</span>
x[z, on <span style="color:#f92672">=</span> .(Id <span style="color:#f92672">==</span> ID, X1 <span style="color:#f92672">==</span> Z1), roll <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">nearest&#34;</span>]
<span style="color:#75715e">## below, simplified examples with ad hoc subsets on a keyed data.table</span>
<span style="color:#a6e22e">setkey</span>(x, Id, X1)
x<span style="color:#a6e22e">[.</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>), roll <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">nearest&#34;</span>]
</code></pre></div><pre><code>##    Id X1 XY X2 Z2
## 1:  C  5 x6 x5 z5
## 2:  C  6 x6 x5 z6
## 3:  C  7 x8 x7 z7
## 4:  C  8 x8 x7 z8
## 5:  C  9 x8 x7 z9
##    Id X1 XY X2
## 1:  C  5 x6 x5
## 2:  C  6 x6 x5
## 3:  C  7 x8 x7
## 4:  C  8 x8 x7
## 5:  C  9 x8 x7
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Last Observation Carried Forward</span>
x<span style="color:#a6e22e">[.</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>), roll <span style="color:#f92672">=</span> <span style="color:#66d9ef">Inf</span>]
x<span style="color:#a6e22e">[.</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>), roll <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>]  <span style="color:#75715e"># bounded</span>
x<span style="color:#a6e22e">[.</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>), roll <span style="color:#f92672">=</span> <span style="color:#66d9ef">Inf</span>, rollends <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#66d9ef">FALSE</span>, <span style="color:#66d9ef">TRUE</span>)]  <span style="color:#75715e"># default</span>
x<span style="color:#a6e22e">[.</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>), roll <span style="color:#f92672">=</span> <span style="color:#66d9ef">Inf</span>, rollends <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#66d9ef">FALSE</span>, <span style="color:#66d9ef">FALSE</span>)] <span style="color:#75715e"># ends not rolled</span>
</code></pre></div><pre><code>##    Id X1 XY X2
## 1:  C  5 x6 x5
## 2:  C  6 x6 x5
## 3:  C  7 x8 x7
## 4:  C  8 x8 x7
## 5:  C  9 x8 x7
##    Id X1   XY   X2
## 1:  C  5   x6   x5
## 2:  C  6 &lt;NA&gt; &lt;NA&gt;
## 3:  C  7   x8   x7
## 4:  C  8 &lt;NA&gt; &lt;NA&gt;
## 5:  C  9 &lt;NA&gt; &lt;NA&gt;
##    Id X1 XY X2
## 1:  C  5 x6 x5
## 2:  C  6 x6 x5
## 3:  C  7 x8 x7
## 4:  C  8 x8 x7
## 5:  C  9 x8 x7
##    Id X1   XY   X2
## 1:  C  5   x6   x5
## 2:  C  6   x6   x5
## 3:  C  7   x8   x7
## 4:  C  8 &lt;NA&gt; &lt;NA&gt;
## 5:  C  9 &lt;NA&gt; &lt;NA&gt;
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Next Observation Carried Backward</span>
x<span style="color:#a6e22e">[.</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>), roll <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#66d9ef">Inf</span>]
x<span style="color:#a6e22e">[.</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>), roll <span style="color:#f92672">=</span> <span style="color:#ae81ff">-0.5</span>] <span style="color:#75715e"># bounded</span>
x<span style="color:#a6e22e">[.</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>), roll <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#66d9ef">Inf</span>, rollends <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#66d9ef">TRUE</span>, <span style="color:#66d9ef">FALSE</span>)]
x<span style="color:#a6e22e">[.</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">C&#34;</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>), roll <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#66d9ef">Inf</span>, rollends <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#66d9ef">TRUE</span>, <span style="color:#66d9ef">TRUE</span>)]  <span style="color:#75715e"># roll both ends</span>
</code></pre></div><pre><code>##    Id X1   XY   X2
## 1:  C  5   x6   x5
## 2:  C  6   x8   x7
## 3:  C  7   x8   x7
## 4:  C  8 &lt;NA&gt; &lt;NA&gt;
## 5:  C  9 &lt;NA&gt; &lt;NA&gt;
##    Id X1   XY   X2
## 1:  C  5   x6   x5
## 2:  C  6 &lt;NA&gt; &lt;NA&gt;
## 3:  C  7   x8   x7
## 4:  C  8 &lt;NA&gt; &lt;NA&gt;
## 5:  C  9 &lt;NA&gt; &lt;NA&gt;
##    Id X1   XY   X2
## 1:  C  5   x6   x5
## 2:  C  6   x8   x7
## 3:  C  7   x8   x7
## 4:  C  8 &lt;NA&gt; &lt;NA&gt;
## 5:  C  9 &lt;NA&gt; &lt;NA&gt;
##    Id X1 XY X2
## 1:  C  5 x6 x5
## 2:  C  6 x8 x7
## 3:  C  7 x8 x7
## 4:  C  8 x8 x7
## 5:  C  9 x8 x7
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e">#</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">CJ</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>), <span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>)
<span style="color:#a6e22e">CJ</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>), <span style="color:#ae81ff">3</span><span style="color:#f92672">:</span><span style="color:#ae81ff">2</span>, sorted <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>, unique <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><pre><code>##    V1 V2
## 1:  1  2
## 2:  1  2
## 3:  1  3
## 4:  1  3
## 5:  2  2
## 6:  2  3
##    V1 V2
## 1:  2  3
## 2:  2  2
## 3:  1  3
## 4:  1  2
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># base::expand.grid(c(2, 1, 1), 3:2)</span>
<span style="color:#75715e">#</span>
</code></pre></div><!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="bind">Bind</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.table</span>(<span style="color:#ae81ff">1</span><span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>)
y <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.table</span>(<span style="color:#ae81ff">4</span><span style="color:#f92672">:</span><span style="color:#ae81ff">6</span>)
z <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.table</span>(<span style="color:#ae81ff">7</span><span style="color:#f92672">:</span><span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">0L</span>)
</code></pre></div><h4 id="bind-rows">Bind rows</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">rbind</span>(x, y)
<span style="color:#a6e22e">rbind</span>(x, z, fill <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><pre><code>##    V1
## 1:  1
## 2:  2
## 3:  3
## 4:  4
## 5:  5
## 6:  6
##    V1 V2
## 1:  1 NA
## 2:  2 NA
## 3:  3 NA
## 4:  7  0
## 5:  8  0
## 6:  9  0
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">bind_rows</span>(x, y)
<span style="color:#a6e22e">bind_rows</span>(x, z) <span style="color:#75715e"># always fills</span>
</code></pre></div><pre><code>##    V1
## 1:  1
## 2:  2
## 3:  3
## 4:  4
## 5:  5
## 6:  6
##    V1 V2
## 1:  1 NA
## 2:  2 NA
## 3:  3 NA
## 4:  7  0
## 5:  8  0
## 6:  9  0
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">rbindlist</span>(<span style="color:#a6e22e">list</span>(x, y), idcol <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><pre><code>##    .id V1
## 1:   1  1
## 2:   1  2
## 3:   1  3
## 4:   2  4
## 5:   2  5
## 6:   2  6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">bind_rows</span>(<span style="color:#a6e22e">list</span>(x, y), .id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">id&#34;</span>)
</code></pre></div><pre><code>##    id V1
## 1:  1  1
## 2:  1  2
## 3:  1  3
## 4:  2  4
## 5:  2  5
## 6:  2  6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">base<span style="color:#f92672">::</span><span style="color:#a6e22e">cbind</span>(x, y)
</code></pre></div><pre><code>##    V1 V1
## 1:  1  4
## 2:  2  5
## 3:  3  6
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">bind_cols</span>(x, y)
</code></pre></div><pre><code>## New names:
## * V1 -&gt; V1...1
## * V1 -&gt; V1...2
</code></pre><pre><code>##    V1...1 V1...2
## 1:      1      4
## 2:      2      5
## 3:      3      6
</code></pre><!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h3 id="set-operations">Set operations</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.table</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>))
y <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.table</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">4</span>))
</code></pre></div><h4 id="intersection">Intersection</h4>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">fintersect</span>(x, y)
<span style="color:#a6e22e">fintersect</span>(x, y, all <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><pre><code>##    V1
## 1:  2
## 2:  3
##    V1
## 1:  2
## 2:  2
## 3:  3
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">intersect</span>(x, y)
<span style="color:#75715e"># no all option</span>
</code></pre></div><pre><code>##    V1
## 1:  2
## 2:  3
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">fsetdiff</span>(x, y)
<span style="color:#a6e22e">fsetdiff</span>(x, y, all <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><pre><code>##    V1
## 1:  1
##    V1
## 1:  1
## 2:  3
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">setdiff</span>(x, y)
<span style="color:#75715e"># no all option</span>
</code></pre></div><pre><code>##    V1
## 1:  1
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">funion</span>(x, y)
<span style="color:#a6e22e">funion</span>(x, y, all <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><pre><code>##    V1
## 1:  1
## 2:  2
## 3:  3
## 4:  4
##     V1
##  1:  1
##  2:  2
##  3:  2
##  4:  3
##  5:  3
##  6:  2
##  7:  2
##  8:  3
##  9:  4
## 10:  4
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">union</span>(x, y)
<span style="color:#a6e22e">union_all</span>(x, y)
</code></pre></div><pre><code>##    V1
## 1:  1
## 2:  2
## 3:  3
## 4:  4
##     V1
##  1:  1
##  2:  2
##  3:  2
##  4:  3
##  5:  3
##  6:  2
##  7:  2
##  8:  3
##  9:  4
## 10:  4
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">fsetequal</span>(x, x<span style="color:#a6e22e">[order</span>(<span style="color:#f92672">-</span>V1),])
<span style="color:#a6e22e">all.equal</span>(x, x) <span style="color:#75715e"># S3 method</span>
</code></pre></div><pre><code>## [1] TRUE
## [1] TRUE
</code></pre><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">setequal</span>(x, x<span style="color:#a6e22e">[order</span>(<span style="color:#f92672">-</span>V1),])
<span style="color:#a6e22e">all_equal</span>(x, x)
</code></pre></div><pre><code>## [1] TRUE
## [1] TRUE
</code></pre><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h1 id="summary">Summary</h1>
<p>This article presented the most important features of both data.table and dplyr, two packages that are now essential tools for data manipulation in R.   <br>
There are still a lot of features not covered in this document, in particular, data.table functions to deal with time-series or dplyr vectorized functions have not been discussed, but &lsquo;done is better than perfect&rsquo;&hellip;  <br>
Hopefully, this comparison is not too biased, but I must admit that my preference is for data.table. So, I hope this post will encourage some readers to give it a try! <br>
<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<pre><code>## R version 3.6.3 (2020-02-29)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 18.04.4 LTS
## 
## Matrix products: default
## BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.7.1
## LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.7.1
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=fr_FR.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=fr_FR.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=fr_FR.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=fr_FR.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] dplyr_1.0.0       data.table_1.13.0 knitr_1.26       
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.3       magrittr_1.5     hms_0.5.2        tidyselect_1.1.0
##  [5] R6_2.4.1         rlang_0.4.6      fansi_0.4.0      stringr_1.4.0   
##  [9] tools_3.6.3      xfun_0.11        utf8_1.1.4       cli_2.0.0       
## [13] ellipsis_0.3.0   htmltools_0.4.0  assertthat_0.2.1 yaml_2.2.0      
## [17] digest_0.6.23    tibble_2.1.3     lifecycle_0.2.0  crayon_1.3.4    
## [21] bookdown_0.16    readr_1.3.1      tidyr_1.0.0      purrr_0.3.3     
## [25] vctrs_0.3.1      glue_1.4.1       evaluate_0.14    rmarkdown_2.0   
## [29] blogdown_0.17    stringi_1.4.3    compiler_3.6.3   pillar_1.4.3    
## [33] generics_0.0.2   pkgconfig_2.0.3
</code></pre>

		
	</div>

	<div class="pagination">
		<a href="/post/2019-01-15-2018-learning/" class="left arrow">&#8592;</a>
		<a href="/post/2019-03-03-datatable-dplyr.knit/" class="right arrow">&#8594;</a>

		<a href="#" class="top">Top</a>
	</div>
</main>


        		<footer>
			<span>
			&copy; 2020. Made with <a href='https://gohugo.io'>Hugo</a> using the <a href='https://github.com/EmielH/tale-hugo/'>Tale</a> theme.
			</span>
		</footer>

    </body>
</html>
