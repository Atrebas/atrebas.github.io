<!DOCTYPE html>
<html lang="en-us">
    <head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title>A data.table and pandas small stroll &middot; Home</title>

		
  		<link rel="stylesheet" href="/css/style.css">
		<link rel="stylesheet" href="/css/fonts.css">
		
		<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
		<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

		
		<link href="" rel="alternate" type="application/rss+xml" title="Home" />

                
                <link rel="stylesheet" href="/css/github-gist.css" rel="stylesheet" id="theme-stylesheet">
                <script src="/js/highlight.pack.js"></script>
                <script>hljs.initHighlightingOnLoad();</script>
	</head>

    <body>
        		<nav class="nav">
			<div class="nav-container">
				<a href="/">
					<h2 class="nav-title">Home</h2>
				</a>
				<ul>
    
    
    <li><a href="/about">About</a></li>
    <li><a href="/">Posts</a></li>
</ul>
			</div>
		</nav>

        

<main>
	<div class="post">
		<div class="post-info">
    <span>Written by</span>
        Atrebas
        <br>
        <span>on&nbsp;</span><time datetime="2020-06-14 00:00:00 &#43;0000 UTC">June 14, 2020</time>
</div>
		<h1 class="post-title">A data.table and pandas small stroll</h1>
<div class="post-line"></div>

		

		

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#about">About</a></li>
<li><a href="#create-example-data">Create example data</a></li>
</ul></li>
<li><a href="#basic-operations">Basic operations</a><ul>
<li><a href="#filter-rows">Filter rows</a></li>
<li><a href="#sort-rows">Sort rows</a></li>
<li><a href="#select-columns">Select columns</a></li>
<li><a href="#summarise-data">Summarise data</a></li>
<li><a href="#addupdatedelete-columns">Add/update/delete columns</a></li>
<li><a href="#by">by</a></li>
</ul></li>
<li><a href="#going-further">Going further</a><ul>
<li><a href="#advanced-columns-manipulation">Advanced columns manipulation</a></li>
<li><a href="#chain-expressions">Chain expressions</a></li>
<li><a href="#indexing-and-keys">Indexing and Keys</a></li>
<li><a href="#set-modifications"><code>set*()</code> modifications</a></li>
<li><a href="#advanced-use-of-by">Advanced use of by</a></li>
</ul></li>
<li><a href="#miscellaneous">Miscellaneous</a><ul>
<li><a href="#read-write-data">Read / Write data</a></li>
<li><a href="#reshape-data">Reshape data</a></li>
<li><a href="#other">Other</a></li>
</ul></li>
<li><a href="#joinbind-data-sets">Join/Bind data sets</a><ul>
<li><a href="#join">Join</a></li>
<li><a href="#more-joins">More joins</a></li>
<li><a href="#bind">Bind</a></li>
<li><a href="#set-operations">Set operations</a></li>
</ul></li>
</ul>
</div>

<!----------------------------------------------------------------------------
<div id="contents" style="position:fixed;width: 200px;right:0;top:0">
------------------------------------------------------------------------------->
<script src="/js/jquery-3.3.1.min.js"></script>
<script src="/js/show-hide-console-outputs.js"></script>
<script src="/js/floating-toc.js"></script>
<style>
   table {
      width: 100%;
      border-top: none !important; 
      padding: 0px;
      border-spacing: 2px;
      margin-bottom: 0px;
    }
    td {
      width: 50%;
      text-align: left;
    }
    pre {
    padding: 5px;
    white-space: pre-wrap;
    }
    .hljs.shell{
    background: #ffffff;
    border-style: solid;
    border-width: 1px;
    border-color: #a7a7a71a;
    }
    pre:not(.r):not(.python) {
    display: none;
    }
    table {
    margin-bottom: 0px;
    table-layout: fixed; 
    }
    .table {
    margin-bottom: 0px;
    }
    h4 {
    text-align: center;
    font-size: 12px;
    font-weight: 600;
    margin-top: 0px;
    margin-bottom: 3px;
    }
    hr.hr2 {
    border: 2px solid #000000;
    }
    .hljs{
    background: #a7a7a71a;
    font-size: 80%;
    word-wrap: break-word;
    }
    #TOC {
    font-size: 12px;
    }
    #TOC.floating {
    position:fixed;
    width: 200px;
    left:0;
    top:0;
    margin-top: 60px;
    }
    pre:not(.r):not(.python) {
    background: #a7a7a71a;
    font-size: 80%;
    word-wrap: break-word;
    color: #333333;
    }


</style>
<!----------------------------------------------------------------------------
                INTRODUCTION
------------------------------------------------------------------------------->
<br>
<table class="table table-condensed">
<tbody>
<tr>
<td align="center">
<img src="/images/data.table.png" alt="data.table_logo" />
</td>
<td align="center">
<br><br>
<img src="/images/pandas.png" alt="pandas_logo" />
</td>
</tr>
</tbody>
</table>
<br>
<hr class = "hr2">
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<div id="about" class="section level3">
<h3>About</h3>
<ul>
<li>Last year, I published a <a href="https://atrebas.github.io/post/2019-03-03-datatable-dplyr/">post</a>
showing how to use the data.table and dplyr R packages to execute data munging tasks.<br />
</li>
<li>I have learned some Python lately and thought it would be a could exercice to “translate” the commands using pandas.<br />
</li>
<li>I am less familiar with Python and pandas than I am with R and data.table, and presenting the two librairies together in a logical way is a bit challenging. So, rather than going into convoluted explanations,
I choose the easy (and time-saving) solution: only the code is presented, no further explanation is given - hence the title.<br />
</li>
<li>That’s all it is. Just a programming exercice, not a A-vs-B post.
It is incomplete and not fully polished but I publish it in case it can be useful for someone and to better keep track of the files.<br />
</li>
<li>The same <a href="https://github.com/Atrebas/atrebas.github.io/blob/master/post/2019-03-03-datatable-dplyr.R">R code</a>
is used below and in my “data.table and dplyr tour”. The Python code, available
<a href="https://github.com/Atrebas/atrebas.github.io/blob/master/post/2020-06-14-datatable-pandas.R">here</a>, is structured and labeled in the same way.</li>
</ul>
<div style="text-align: center;">
<input type='button' id='hideshow' value='Show the outputs'>
</div>
<br>
<hr>
</div>
<div id="create-example-data" class="section level3">
<h3>Create example data</h3>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>library(data.table)
set.seed(1L)

## Create a data table
DT &lt;- data.table(V1 = rep(c(1L, 2L), 5)[-10],
                V2 = 1:9,
                V3 = c(0.5, 1.0, 1.5),
                V4 = rep(LETTERS[1:3], 3))

class(DT)
DT</code></pre>
<pre><code>## [1] &quot;data.table&quot; &quot;data.frame&quot;
##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  2  2 1.0  B
## 3:  1  3 1.5  C
## 4:  2  4 0.5  A
## 5:  1  5 1.0  B
## 6:  2  6 1.5  C
## 7:  1  7 0.5  A
## 8:  2  8 1.0  B
## 9:  1  9 1.5  C</code></pre>
</td>
<td align="left">
<pre class="python"><code>import pandas as pd
import numpy as np

## Create a pandas DataFrame
DF = pd.DataFrame(
  {&quot;V1&quot; : [1, 2, 1, 2, 1, 2, 1, 2, 1],
   &quot;V2&quot; : [1, 2, 3, 4, 5, 6, 7, 8, 9], 
   &quot;V3&quot; : [0.5, 1.0, 1.5] * 3, 
   &quot;V4&quot; : [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;] * 3}) 
type(DF)</code></pre>
<pre><code>## &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;</code></pre>
<pre class="python"><code>DF</code></pre>
<pre><code>##    V1  V2   V3 V4
## 0   1   1  0.5  A
## 1   2   2  1.0  B
## 2   1   3  1.5  C
## 3   2   4  0.5  A
## 4   1   5  1.0  B
## 5   2   6  1.5  C
## 6   1   7  0.5  A
## 7   2   8  1.0  B
## 8   1   9  1.5  C</code></pre>
</td>
</tr>
</tbody>
</table>
<p>Below, the data.table code uses <code>DT</code> and the pandas code uses <code>DF</code>.</p>
<!----------------------------------------------------------------------------
                             BASIC OPERATIONS
------------------------------------------------------------------------------->
<br><br>
<hr class = "hr2">
</div>
</div>
<div id="basic-operations" class="section level1">
<h1>Basic operations</h1>
<div id="filter-rows" class="section level3">
<h3>Filter rows</h3>
<div id="filter-rows-using-indices" class="section level4">
<h4>Filter rows using indices</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[3:4,]
DT[3:4] # same</code></pre>
<pre><code>##    V1 V2  V3 V4
## 1:  1  3 1.5  C
## 2:  2  4 0.5  A
##    V1 V2  V3 V4
## 1:  1  3 1.5  C
## 2:  2  4 0.5  A</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.iloc[2:4]</code></pre>
<pre><code>##    V1  V2   V3 V4
## 2   1   3  1.5  C
## 3   2   4  0.5  A</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="discard-rows-using-negative-indices" class="section level4">
<h4>Discard rows using negative indices</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[!3:7,]
DT[-(3:7)] # same</code></pre>
<pre><code>##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  2  2 1.0  B
## 3:  2  8 1.0  B
## 4:  1  9 1.5  C
##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  2  2 1.0  B
## 3:  2  8 1.0  B
## 4:  1  9 1.5  C</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF[~DF.index.isin(list(range(2, 7)))]</code></pre>
<pre><code>##    V1  V2   V3 V4
## 0   1   1  0.5  A
## 1   2   2  1.0  B
## 7   2   8  1.0  B
## 8   1   9  1.5  C</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="filter-rows-using-a-logical-expression" class="section level4">
<h4>Filter rows using a logical expression</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[V2 &gt; 5]
DT[V4 %chin% c(&quot;A&quot;, &quot;C&quot;)] # fast %in% for character</code></pre>
<pre><code>##    V1 V2  V3 V4
## 1:  2  6 1.5  C
## 2:  1  7 0.5  A
## 3:  2  8 1.0  B
## 4:  1  9 1.5  C
##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  1  3 1.5  C
## 3:  2  4 0.5  A
## 4:  2  6 1.5  C
## 5:  1  7 0.5  A
## 6:  1  9 1.5  C</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF[DF.V2 &gt; 5]</code></pre>
<pre><code>##    V1  V2   V3 V4
## 5   2   6  1.5  C
## 6   1   7  0.5  A
## 7   2   8  1.0  B
## 8   1   9  1.5  C</code></pre>
<pre class="python"><code>DF.query(&#39;V2&gt;5&#39;)</code></pre>
<pre><code>##    V1  V2   V3 V4
## 5   2   6  1.5  C
## 6   1   7  0.5  A
## 7   2   8  1.0  B
## 8   1   9  1.5  C</code></pre>
<pre class="python"><code>DF[DF.V4.isin([&#39;A&#39;, &#39;C&#39;])]</code></pre>
<pre><code>##    V1  V2   V3 V4
## 0   1   1  0.5  A
## 2   1   3  1.5  C
## 3   2   4  0.5  A
## 5   2   6  1.5  C
## 6   1   7  0.5  A
## 8   1   9  1.5  C</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="filter-rows-using-multiple-conditions" class="section level4">
<h4>Filter rows using multiple conditions</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[V1 == 1 &amp; V4 == &quot;A&quot;]
# any logical criteria can be used</code></pre>
<pre><code>##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  1  7 0.5  A</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF[DF.V1 == 1 &amp; DF.V4.isin([&#39;A&#39;])]
# any logical criteria can be used</code></pre>
<pre><code>##    V1  V2   V3 V4
## 0   1   1  0.5  A
## 6   1   7  0.5  A</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="filter-unique-rows" class="section level4">
<h4>Filter unique rows</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>unique(DT)
unique(DT, by = c(&quot;V1&quot;, &quot;V4&quot;)) # returns all cols</code></pre>
<pre><code>##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  2  2 1.0  B
## 3:  1  3 1.5  C
## 4:  2  4 0.5  A
## 5:  1  5 1.0  B
## 6:  2  6 1.5  C
## 7:  1  7 0.5  A
## 8:  2  8 1.0  B
## 9:  1  9 1.5  C
##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  2  2 1.0  B
## 3:  1  3 1.5  C
## 4:  2  4 0.5  A
## 5:  1  5 1.0  B
## 6:  2  6 1.5  C</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.drop_duplicates()</code></pre>
<pre><code>##    V1  V2   V3 V4
## 0   1   1  0.5  A
## 1   2   2  1.0  B
## 2   1   3  1.5  C
## 3   2   4  0.5  A
## 4   1   5  1.0  B
## 5   2   6  1.5  C
## 6   1   7  0.5  A
## 7   2   8  1.0  B
## 8   1   9  1.5  C</code></pre>
<pre class="python"><code>DF.drop_duplicates(subset =[&#39;V1&#39;, &#39;V4&#39;])</code></pre>
<pre><code>##    V1  V2   V3 V4
## 0   1   1  0.5  A
## 1   2   2  1.0  B
## 2   1   3  1.5  C
## 3   2   4  0.5  A
## 4   1   5  1.0  B
## 5   2   6  1.5  C</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="discard-rows-with-missing-values" class="section level4">
<h4>Discard rows with missing values</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>na.omit(DT, cols = 1:4)  # fast S3 method with cols argument</code></pre>
<pre><code>##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  2  2 1.0  B
## 3:  1  3 1.5  C
## 4:  2  4 0.5  A
## 5:  1  5 1.0  B
## 6:  2  6 1.5  C
## 7:  1  7 0.5  A
## 8:  2  8 1.0  B
## 9:  1  9 1.5  C</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.dropna(subset = DF.columns)
# dropna has more options</code></pre>
<pre><code>##    V1  V2   V3 V4
## 0   1   1  0.5  A
## 1   2   2  1.0  B
## 2   1   3  1.5  C
## 3   2   4  0.5  A
## 4   1   5  1.0  B
## 5   2   6  1.5  C
## 6   1   7  0.5  A
## 7   2   8  1.0  B
## 8   1   9  1.5  C</code></pre>
<pre class="python"><code>DF.dropna(axis = 0, how = &#39;any&#39;, thresh = None, subset = None, inplace = False)</code></pre>
<pre><code>##    V1  V2   V3 V4
## 0   1   1  0.5  A
## 1   2   2  1.0  B
## 2   1   3  1.5  C
## 3   2   4  0.5  A
## 4   1   5  1.0  B
## 5   2   6  1.5  C
## 6   1   7  0.5  A
## 7   2   8  1.0  B
## 8   1   9  1.5  C</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="other-filters" class="section level4">
<h4>Other filters</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[sample(.N, 3)] # .N = nb of rows in DT
DT[sample(.N, .N / 2)]
DT[frankv(-V1, ties.method = &quot;dense&quot;) &lt; 2]</code></pre>
<pre><code>##    V1 V2  V3 V4
## 1:  1  9 1.5  C
## 2:  2  4 0.5  A
## 3:  1  7 0.5  A
##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  2  2 1.0  B
## 3:  1  5 1.0  B
## 4:  1  3 1.5  C
##    V1 V2  V3 V4
## 1:  2  2 1.0  B
## 2:  2  4 0.5  A
## 3:  2  6 1.5  C
## 4:  2  8 1.0  B</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.sample(n = 3)</code></pre>
<pre><code>##    V1  V2   V3 V4
## 8   1   9  1.5  C
## 7   2   8  1.0  B
## 0   1   1  0.5  A</code></pre>
<pre class="python"><code>DF.sample(frac = 0.5)
# DF[DF[&#39;V1&#39;].nlargest(1)] # no keep = &#39;all&#39;</code></pre>
<pre><code>##    V1  V2   V3 V4
## 5   2   6  1.5  C
## 7   2   8  1.0  B
## 0   1   1  0.5  A
## 4   1   5  1.0  B</code></pre>
</td>
</tr>
</tbody>
</table>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[V4 %like% &quot;^B&quot;]
DT[V2 %between% c(3, 5)]
DT[data.table::between(V2, 3, 5, incbounds = FALSE)]
DT[V2 %inrange% list(-1:1, 1:3)] # see also ?inrange</code></pre>
<pre><code>##    V1 V2 V3 V4
## 1:  2  2  1  B
## 2:  1  5  1  B
## 3:  2  8  1  B
##    V1 V2  V3 V4
## 1:  1  3 1.5  C
## 2:  2  4 0.5  A
## 3:  1  5 1.0  B
##    V1 V2  V3 V4
## 1:  2  4 0.5  A
##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  2  2 1.0  B
## 3:  1  3 1.5  C</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF[DF.V4.str.startswith((&#39;B&#39;))]</code></pre>
<pre><code>##    V1  V2   V3 V4
## 1   2   2  1.0  B
## 4   1   5  1.0  B
## 7   2   8  1.0  B</code></pre>
<pre class="python"><code>DF[DF[&#39;V2&#39;].between(3, 5)]</code></pre>
<pre><code>##    V1  V2   V3 V4
## 2   1   3  1.5  C
## 3   2   4  0.5  A
## 4   1   5  1.0  B</code></pre>
<pre class="python"><code>DF[DF[&#39;V2&#39;].between(3, 5, inclusive = False)]
#DF[DF.V2 &gt;= list(range(-1, 2)) &amp; DF.V2 &lt;= list(range(1,4))]</code></pre>
<pre><code>##    V1  V2   V3 V4
## 3   2   4  0.5  A</code></pre>
</td>
</tr>
</tbody>
</table>
<br>
<hr>
</div>
</div>
<div id="sort-rows" class="section level3">
<h3>Sort rows</h3>
<div id="sort-rows-by-column" class="section level4">
<h4>Sort rows by column</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[order(V3)]  # see also setorder</code></pre>
<pre><code>##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  2  4 0.5  A
## 3:  1  7 0.5  A
## 4:  2  2 1.0  B
## 5:  1  5 1.0  B
## 6:  2  8 1.0  B
## 7:  1  3 1.5  C
## 8:  2  6 1.5  C
## 9:  1  9 1.5  C</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.sort_values(&#39;V3&#39;)</code></pre>
<pre><code>##    V1  V2   V3 V4
## 0   1   1  0.5  A
## 3   2   4  0.5  A
## 6   1   7  0.5  A
## 1   2   2  1.0  B
## 4   1   5  1.0  B
## 7   2   8  1.0  B
## 2   1   3  1.5  C
## 5   2   6  1.5  C
## 8   1   9  1.5  C</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="sort-rows-in-decreasing-order" class="section level4">
<h4>Sort rows in decreasing order</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[order(-V3)]</code></pre>
<pre><code>##    V1 V2  V3 V4
## 1:  1  3 1.5  C
## 2:  2  6 1.5  C
## 3:  1  9 1.5  C
## 4:  2  2 1.0  B
## 5:  1  5 1.0  B
## 6:  2  8 1.0  B
## 7:  1  1 0.5  A
## 8:  2  4 0.5  A
## 9:  1  7 0.5  A</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.sort_values(&#39;V3&#39;, ascending = False)</code></pre>
<pre><code>##    V1  V2   V3 V4
## 2   1   3  1.5  C
## 5   2   6  1.5  C
## 8   1   9  1.5  C
## 1   2   2  1.0  B
## 4   1   5  1.0  B
## 7   2   8  1.0  B
## 0   1   1  0.5  A
## 3   2   4  0.5  A
## 6   1   7  0.5  A</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="sort-rows-based-on-several-columns" class="section level4">
<h4>Sort rows based on several columns</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[order(V1, -V2)]</code></pre>
<pre><code>##    V1 V2  V3 V4
## 1:  1  9 1.5  C
## 2:  1  7 0.5  A
## 3:  1  5 1.0  B
## 4:  1  3 1.5  C
## 5:  1  1 0.5  A
## 6:  2  8 1.0  B
## 7:  2  6 1.5  C
## 8:  2  4 0.5  A
## 9:  2  2 1.0  B</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.sort_values([&#39;V1&#39;, &#39;V2&#39;], ascending = [True, False])</code></pre>
<pre><code>##    V1  V2   V3 V4
## 8   1   9  1.5  C
## 6   1   7  0.5  A
## 4   1   5  1.0  B
## 2   1   3  1.5  C
## 0   1   1  0.5  A
## 7   2   8  1.0  B
## 5   2   6  1.5  C
## 3   2   4  0.5  A
## 1   2   2  1.0  B</code></pre>
</td>
</tr>
</tbody>
</table>
<br>
<hr>
</div>
</div>
<div id="select-columns" class="section level3">
<h3>Select columns</h3>
<div id="select-one-column-using-an-index-not-recommended" class="section level4">
<h4>Select one column using an index (not recommended)</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[[3]] # returns a vector
DT[, 3]  # returns a data.table</code></pre>
<pre><code>## [1] 0.5 1.0 1.5 0.5 1.0 1.5 0.5 1.0 1.5
##     V3
## 1: 0.5
## 2: 1.0
## 3: 1.5
## 4: 0.5
## 5: 1.0
## 6: 1.5
## 7: 0.5
## 8: 1.0
## 9: 1.5</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.iloc[:, 2] # returns a pandas Series</code></pre>
<pre><code>## 0    0.5
## 1    1.0
## 2    1.5
## 3    0.5
## 4    1.0
## 5    1.5
## 6    0.5
## 7    1.0
## 8    1.5
## Name: V3, dtype: float64</code></pre>
<pre class="python"><code>DF.iloc[:, 2].to_frame() # convert to DataFrame</code></pre>
<pre><code>##     V3
## 0  0.5
## 1  1.0
## 2  1.5
## 3  0.5
## 4  1.0
## 5  1.5
## 6  0.5
## 7  1.0
## 8  1.5</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="select-one-column-using-column-name" class="section level4">
<h4>Select one column using column name</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, list(V2)] # returns a data.table
DT[, .(V2)]    # returns a data.table
# . is an alias for list
DT[, &quot;V2&quot;]     # returns a data.table
DT[, V2]       # returns a vector
DT[[&quot;V2&quot;]]     # returns a vector</code></pre>
<pre><code>##    V2
## 1:  1
## 2:  2
## 3:  3
## 4:  4
## 5:  5
## 6:  6
## 7:  7
## 8:  8
## 9:  9
##    V2
## 1:  1
## 2:  2
## 3:  3
## 4:  4
## 5:  5
## 6:  6
## 7:  7
## 8:  8
## 9:  9
##    V2
## 1:  1
## 2:  2
## 3:  3
## 4:  4
## 5:  5
## 6:  6
## 7:  7
## 8:  8
## 9:  9
## [1] 1 2 3 4 5 6 7 8 9
## [1] 1 2 3 4 5 6 7 8 9</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.V2           # returns a pandas Series</code></pre>
<pre><code>## 0    1
## 1    2
## 2    3
## 3    4
## 4    5
## 5    6
## 6    7
## 7    8
## 8    9
## Name: V2, dtype: int64</code></pre>
<pre class="python"><code>DF[&#39;V2&#39;]        # returns a pandas Series</code></pre>
<pre><code>## 0    1
## 1    2
## 2    3
## 3    4
## 4    5
## 5    6
## 6    7
## 7    8
## 8    9
## Name: V2, dtype: int64</code></pre>
<pre class="python"><code>DF.loc[:, &#39;V2&#39;] # returns a pandas Series</code></pre>
<pre><code>## 0    1
## 1    2
## 2    3
## 3    4
## 4    5
## 5    6
## 6    7
## 7    8
## 8    9
## Name: V2, dtype: int64</code></pre>
<pre class="python"><code>DF[[&#39;V2&#39;]]      # returns a DataFrame</code></pre>
<pre><code>##    V2
## 0   1
## 1   2
## 2   3
## 3   4
## 4   5
## 5   6
## 6   7
## 7   8
## 8   9</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="select-several-columns" class="section level4">
<h4>Select several columns</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, .(V2, V3, V4)]
DT[, list(V2, V3, V4)]
DT[, V2:V4] # select columns between V2 and V4</code></pre>
<pre><code>##    V2  V3 V4
## 1:  1 0.5  A
## 2:  2 1.0  B
## 3:  3 1.5  C
## 4:  4 0.5  A
## 5:  5 1.0  B
## 6:  6 1.5  C
## 7:  7 0.5  A
## 8:  8 1.0  B
## 9:  9 1.5  C
##    V2  V3 V4
## 1:  1 0.5  A
## 2:  2 1.0  B
## 3:  3 1.5  C
## 4:  4 0.5  A
## 5:  5 1.0  B
## 6:  6 1.5  C
## 7:  7 0.5  A
## 8:  8 1.0  B
## 9:  9 1.5  C
##    V2  V3 V4
## 1:  1 0.5  A
## 2:  2 1.0  B
## 3:  3 1.5  C
## 4:  4 0.5  A
## 5:  5 1.0  B
## 6:  6 1.5  C
## 7:  7 0.5  A
## 8:  8 1.0  B
## 9:  9 1.5  C</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF[[&#39;V2&#39;, &#39;V3&#39;, &#39;V4&#39;]]</code></pre>
<pre><code>##    V2   V3 V4
## 0   1  0.5  A
## 1   2  1.0  B
## 2   3  1.5  C
## 3   4  0.5  A
## 4   5  1.0  B
## 5   6  1.5  C
## 6   7  0.5  A
## 7   8  1.0  B
## 8   9  1.5  C</code></pre>
<pre class="python"><code>DF.loc[:, &#39;V2&#39;:&#39;V4&#39;] # select columns between V2 and V4</code></pre>
<pre><code>##    V2   V3 V4
## 0   1  0.5  A
## 1   2  1.0  B
## 2   3  1.5  C
## 3   4  0.5  A
## 4   5  1.0  B
## 5   6  1.5  C
## 6   7  0.5  A
## 7   8  1.0  B
## 8   9  1.5  C</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="exclude-columns" class="section level4">
<h4>Exclude columns</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, !c(&quot;V2&quot;, &quot;V3&quot;)]</code></pre>
<pre><code>##    V1 V4
## 1:  1  A
## 2:  2  B
## 3:  1  C
## 4:  2  A
## 5:  1  B
## 6:  2  C
## 7:  1  A
## 8:  2  B
## 9:  1  C</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.drop(columns = [&#39;V2&#39;, &#39;V3&#39;])</code></pre>
<pre><code>##    V1 V4
## 0   1  A
## 1   2  B
## 2   1  C
## 3   2  A
## 4   1  B
## 5   2  C
## 6   1  A
## 7   2  B
## 8   1  C</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="selectexclude-columns-using-a-character-vector" class="section level4">
<h4>Select/Exclude columns using a character vector</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>cols &lt;- c(&quot;V2&quot;, &quot;V3&quot;)
DT[, ..cols] # .. prefix means &#39;one-level up&#39;
DT[, !..cols] # or DT[, -..cols]</code></pre>
<pre><code>##    V2  V3
## 1:  1 0.5
## 2:  2 1.0
## 3:  3 1.5
## 4:  4 0.5
## 5:  5 1.0
## 6:  6 1.5
## 7:  7 0.5
## 8:  8 1.0
## 9:  9 1.5
##    V1 V4
## 1:  1  A
## 2:  2  B
## 3:  1  C
## 4:  2  A
## 5:  1  B
## 6:  2  C
## 7:  1  A
## 8:  2  B
## 9:  1  C</code></pre>
</td>
<td align="left">
<pre class="python"><code>cols = [&#39;V2&#39;, &#39;V3&#39;]
DF.loc[:, DF.columns.isin(cols)]</code></pre>
<pre><code>##    V2   V3
## 0   1  0.5
## 1   2  1.0
## 2   3  1.5
## 3   4  0.5
## 4   5  1.0
## 5   6  1.5
## 6   7  0.5
## 7   8  1.0
## 8   9  1.5</code></pre>
<pre class="python"><code>DF.loc[:, DF.columns.difference(cols)]</code></pre>
<pre><code>##    V1 V4
## 0   1  A
## 1   2  B
## 2   1  C
## 3   2  A
## 4   1  B
## 5   2  C
## 6   1  A
## 7   2  B
## 8   1  C</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="other-selections" class="section level4">
<h4>Other selections</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>cols &lt;- paste0(&quot;V&quot;, 1:2)
cols &lt;- union(&quot;V4&quot;, names(DT))
cols &lt;- grep(&quot;V&quot;,   names(DT))
cols &lt;- grep(&quot;3$&quot;,  names(DT))
cols &lt;- grep(&quot;.2&quot;,  names(DT))
cols &lt;- grep(&quot;^V1|X$&quot;,  names(DT))
cols &lt;- grep(&quot;^(?!V2)&quot;, names(DT), perl = TRUE)
DT[, ..cols]</code></pre>
<pre><code>##    V1  V3 V4
## 1:  1 0.5  A
## 2:  2 1.0  B
## 3:  1 1.5  C
## 4:  2 0.5  A
## 5:  1 1.0  B
## 6:  2 1.5  C
## 7:  1 0.5  A
## 8:  2 1.0  B
## 9:  1 1.5  C</code></pre>
</td>
<td align="left">
<pre class="python"><code>cols = [&#39;V&#39; + str(x) for x in [1, 2]] # and DF.loc
# ?
DF.filter(regex = &#39;V&#39;)</code></pre>
<pre><code>##    V1  V2   V3 V4
## 0   1   1  0.5  A
## 1   2   2  1.0  B
## 2   1   3  1.5  C
## 3   2   4  0.5  A
## 4   1   5  1.0  B
## 5   2   6  1.5  C
## 6   1   7  0.5  A
## 7   2   8  1.0  B
## 8   1   9  1.5  C</code></pre>
<pre class="python"><code>DF.filter(regex = &#39;3$&#39;)</code></pre>
<pre><code>##     V3
## 0  0.5
## 1  1.0
## 2  1.5
## 3  0.5
## 4  1.0
## 5  1.5
## 6  0.5
## 7  1.0
## 8  1.5</code></pre>
<pre class="python"><code>DF.filter(regex = &#39;.2&#39;)</code></pre>
<pre><code>##    V2
## 0   1
## 1   2
## 2   3
## 3   4
## 4   5
## 5   6
## 6   7
## 7   8
## 8   9</code></pre>
<pre class="python"><code>DF.filter(regex = &#39;^V1|X$&#39;)</code></pre>
<pre><code>##    V1
## 0   1
## 1   2
## 2   1
## 3   2
## 4   1
## 5   2
## 6   1
## 7   2
## 8   1</code></pre>
<pre class="python"><code>DF.filter(regex = &#39;^(?!V2)&#39;)</code></pre>
<pre><code>##    V1   V3 V4
## 0   1  0.5  A
## 1   2  1.0  B
## 2   1  1.5  C
## 3   2  0.5  A
## 4   1  1.0  B
## 5   2  1.5  C
## 6   1  0.5  A
## 7   2  1.0  B
## 8   1  1.5  C</code></pre>
</td>
</tr>
</tbody>
</table>
<br>
<hr>
</div>
</div>
<div id="summarise-data" class="section level3">
<h3>Summarise data</h3>
<div id="summarise-one-column" class="section level4">
<h4>Summarise one column</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, sum(V1)]    # returns a vector
DT[, .(sum(V1))] # returns a data.table
DT[, .(sumV1 = sum(V1))] # returns a data.table</code></pre>
<pre><code>## [1] 13
##    V1
## 1: 13
##    sumV1
## 1:    13</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.V1.sum()   # returns a numpy array</code></pre>
<pre><code>## 13</code></pre>
<pre class="python"><code>DF[[&#39;V1&#39;]].sum()   # returns a pandas series</code></pre>
<pre><code>## V1    13
## dtype: int64</code></pre>
<pre class="python"><code>DF[[&#39;V1&#39;]].sum().to_frame(name = &#39;sumV1&#39;)</code></pre>
<pre><code>##     sumV1
## V1     13</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="summarise-several-columns" class="section level4">
<h4>Summarise several columns</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, .(sum(V1), sd(V3))]</code></pre>
<pre><code>##    V1        V2
## 1: 13 0.4330127</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.agg({&#39;V1&#39;: &#39;sum&#39;, &#39;V3&#39;: &#39;std&#39;}) # series</code></pre>
<pre><code>## V1    13.000000
## V3     0.433013
## dtype: float64</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="summarise-several-columns-and-assign-column-names" class="section level4">
<h4>Summarise several columns and assign column names</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, .(sumv1 = sum(V1),
       sdv3  = sd(V3))]</code></pre>
<pre><code>##    sumv1      sdv3
## 1:    13 0.4330127</code></pre>
</td>
<td align="left">
<pre class="python"><code>res = list(DF.agg({&#39;V1&#39;: &#39;sum&#39;, &#39;V3&#39;: &#39;std&#39;}))
pd.DataFrame([res], columns=[&#39;sumV1&#39;,&#39;sdv3&#39;])</code></pre>
<pre><code>##    sumV1      sdv3
## 0   13.0  0.433013</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="summarise-a-subset-of-rows" class="section level4">
<h4>Summarise a subset of rows</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[1:4, sum(V1)]</code></pre>
<pre><code>## [1] 6</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.V1.iloc[0:4].sum()</code></pre>
<pre><code>## 6</code></pre>
</td>
</tr>
</tbody>
</table>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, data.table::first(V3)]
DT[, data.table::last(V3)]
DT[5, V3]
DT[, uniqueN(V4)]
uniqueN(DT)</code></pre>
<pre><code>## [1] 0.5
## [1] 1.5
## [1] 1
## [1] 3
## [1] 9</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.head(1).V3</code></pre>
<pre><code>## 0    0.5
## Name: V3, dtype: float64</code></pre>
<pre class="python"><code>DF.tail(1).V3</code></pre>
<pre><code>## 8    1.5
## Name: V3, dtype: float64</code></pre>
<pre class="python"><code>DF.ix[4, &#39;V3&#39;] # DF.V3.iloc[4]</code></pre>
<pre><code>## 1.0
## 
## /home/xu/anaconda3/bin/python:1: FutureWarning: 
## .ix is deprecated. Please use
## .loc for label based indexing or
## .iloc for positional indexing
## 
## See the documentation here:
## http://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#ix-indexer-is-deprecated</code></pre>
<pre class="python"><code>DF[&#39;V4&#39;].nunique()</code></pre>
<pre><code>## 3</code></pre>
<pre class="python"><code>len(DF.drop_duplicates())</code></pre>
<pre><code>## 9</code></pre>
</td>
</tr>
</tbody>
</table>
<br>
<hr>
</div>
</div>
<div id="addupdatedelete-columns" class="section level3">
<h3>Add/update/delete columns</h3>
<div id="modify-a-column" class="section level4">
<h4>Modify a column</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, V1 := V1^2]
DT</code></pre>
<pre><code>##    V1 V2  V3 V4
## 1:  1  1 0.5  A
## 2:  4  2 1.0  B
## 3:  1  3 1.5  C
## 4:  4  4 0.5  A
## 5:  1  5 1.0  B
## 6:  4  6 1.5  C
## 7:  1  7 0.5  A
## 8:  4  8 1.0  B
## 9:  1  9 1.5  C</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF[&#39;V1&#39;] = DF[&#39;V1&#39;]**2
DF.eval(&#39;V1 = V1**2&#39;, inplace = True)
DF</code></pre>
<pre><code>##    V1  V2   V3 V4
## 0   1   1  0.5  A
## 1  16   2  1.0  B
## 2   1   3  1.5  C
## 3  16   4  0.5  A
## 4   1   5  1.0  B
## 5  16   6  1.5  C
## 6   1   7  0.5  A
## 7  16   8  1.0  B
## 8   1   9  1.5  C</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="add-one-column" class="section level4">
<h4>Add one column</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, v5 := log(V1)][] # adding [] prints the result</code></pre>
<pre><code>##    V1 V2  V3 V4       v5
## 1:  1  1 0.5  A 0.000000
## 2:  4  2 1.0  B 1.386294
## 3:  1  3 1.5  C 0.000000
## 4:  4  4 0.5  A 1.386294
## 5:  1  5 1.0  B 0.000000
## 6:  4  6 1.5  C 1.386294
## 7:  1  7 0.5  A 0.000000
## 8:  4  8 1.0  B 1.386294
## 9:  1  9 1.5  C 0.000000</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF = DF.assign(v5 = np.log(DF.V1))</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="add-several-columns" class="section level4">
<h4>Add several columns</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, c(&quot;v6&quot;, &quot;v7&quot;) := .(sqrt(V1), &quot;X&quot;)]

DT[, &#39;:=&#39;(v6 = sqrt(V1),
          v7 = &quot;X&quot;)]     # same, functional form</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF = DF.assign(v6 = np.sqrt(DF.V1), v7 = &#39;X&#39;)</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="create-one-column-and-remove-the-others" class="section level4">
<h4>Create one column and remove the others</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, .(v8 = V3 + 1)]</code></pre>
<pre><code>##     v8
## 1: 1.5
## 2: 2.0
## 3: 2.5
## 4: 1.5
## 5: 2.0
## 6: 2.5
## 7: 1.5
## 8: 2.0
## 9: 2.5</code></pre>
</td>
<td align="left">
<pre class="python"><code>pd.DataFrame({&#39;v8&#39; : DF.V3 + 1})</code></pre>
<pre><code>##     v8
## 0  1.5
## 1  2.0
## 2  2.5
## 3  1.5
## 4  2.0
## 5  2.5
## 6  1.5
## 7  2.0
## 8  2.5</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="remove-one-column" class="section level4">
<h4>Remove one column</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, v5 := NULL]</code></pre>
</td>
<td align="left">
<pre class="python"><code>del DF[&#39;v5&#39;] # DF = DF.drop(&#39;v5&#39;, 1)</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="remove-several-columns" class="section level4">
<h4>Remove several columns</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, c(&quot;v6&quot;, &quot;v7&quot;) := NULL]</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF = DF.drop([&#39;v6&#39;, &#39;v7&#39;], 1)</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="remove-columns-using-a-vector-of-colnames" class="section level4">
<h4>Remove columns using a vector of colnames</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>cols &lt;- c(&quot;V3&quot;)
DT[, (cols) := NULL] # ! not DT[, cols := NULL]</code></pre>
</td>
<td align="left">
<pre class="python"><code>cols = &#39;V3&#39;
DF = DF.drop(cols, 1)</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="replace-values-for-rows-matching-a-condition" class="section level4">
<h4>Replace values for rows matching a condition</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[V2 &lt; 4, V2 := 0L]
DT</code></pre>
<pre><code>##    V1 V2 V4
## 1:  1  0  A
## 2:  4  0  B
## 3:  1  0  C
## 4:  4  4  A
## 5:  1  5  B
## 6:  4  6  C
## 7:  1  7  A
## 8:  4  8  B
## 9:  1  9  C</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.loc[DF[&#39;V2&#39;] &lt; 4, &#39;V2&#39;] = 0</code></pre>
</td>
</tr>
</tbody>
</table>
<br>
<hr>
</div>
</div>
<div id="by" class="section level3">
<h3>by</h3>
<div id="by-group" class="section level4">
<h4>By group</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code># one-liner:
DT[, .(sumV2 = sum(V2)), by = &quot;V4&quot;]
# reordered and indented:
DT[, by = V4,
     .(sumV2 = sum(V2))]
# </code></pre>
<pre><code>##    V4 sumV2
## 1:  A    11
## 2:  B    13
## 3:  C    15
##    V4 sumV2
## 1:  A    11
## 2:  B    13
## 3:  C    15</code></pre>
</td>
<td align="left">
<pre class="python"><code>(DF.groupby(&#39;V4&#39;)[&#39;V2&#39;]
   .agg(&#39;sum&#39;)
   .to_frame(name = &#39;sumV2&#39;)
   .reset_index())</code></pre>
<pre><code>##   V4  sumV2
## 0  A     11
## 1  B     13
## 2  C     15</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="by-several-groups" class="section level4">
<h4>By several groups</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, keyby = .(V4, V1),
     .(sumV2 = sum(V2))]</code></pre>
<pre><code>##    V4 V1 sumV2
## 1:  A  1     7
## 2:  A  4     4
## 3:  B  1     5
## 4:  B  4     8
## 5:  C  1     9
## 6:  C  4     6</code></pre>
</td>
<td align="left">
<pre class="python"><code>(DF.groupby([&#39;V4&#39;, &#39;V1&#39;])[&#39;V2&#39;]
   .agg(&#39;sum&#39;)
   .to_frame(name = &#39;sumV2&#39;)
   .reset_index())</code></pre>
<pre><code>##   V4  V1  sumV2
## 0  A   1      7
## 1  A  16      4
## 2  B   1      5
## 3  B  16      8
## 4  C   1      9
## 5  C  16      6</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="calling-function-in-by" class="section level4">
<h4>Calling function in by</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, by = tolower(V4),
     .(sumV1 = sum(V1))]</code></pre>
<pre><code>##    tolower sumV1
## 1:       a     6
## 2:       b     9
## 3:       c     6</code></pre>
</td>
<td align="left">
<pre class="python"><code>(DF.groupby(DF[&#39;V4&#39;].str.lower())[&#39;V1&#39;]
   .sum()
   .to_frame(name = &#39;sumV1&#39;)
   .reset_index())</code></pre>
<pre><code>##   V4  sumV1
## 0  a     18
## 1  b     33
## 2  c     18</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="assigning-column-name-in-by" class="section level4">
<h4>Assigning column name in by</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, keyby = .(abc = tolower(V4)),
     .(sumV1 = sum(V1))]</code></pre>
<pre><code>##    abc sumV1
## 1:   a     6
## 2:   b     9
## 3:   c     6</code></pre>
</td>
<td align="left">
<pre class="python"><code>(DF.groupby(DF[&#39;V4&#39;].str.lower())[&#39;V1&#39;]
   .sum()
   .to_frame(name = &#39;sumV1&#39;)
   .assign(abc = lambda x: x.index)
   .reset_index(drop = True))</code></pre>
<pre><code>##    sumV1 abc
## 0     18   a
## 1     33   b
## 2     18   c</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="using-a-condition-in-by" class="section level4">
<h4>Using a condition in by</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, keyby = V4 == &quot;A&quot;,
     sum(V1)]</code></pre>
<pre><code>##       V4 V1
## 1: FALSE 15
## 2:  TRUE  6</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.groupby(DF[&#39;V4&#39;] == &#39;A&#39;)[&#39;V1&#39;].sum()</code></pre>
<pre><code>## V4
## False    51
## True     18
## Name: V1, dtype: int64</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="by-on-a-subset-of-rows" class="section level4">
<h4>By on a subset of rows</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[1:5,                # i
   .(sumV1 = sum(V1)), # j
   by = V4]            # by
## complete DT[i, j, by] expression!</code></pre>
<pre><code>##    V4 sumV1
## 1:  A     5
## 2:  B     5
## 3:  C     1</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.iloc[0:5].groupby(&#39;V4&#39;)[&#39;V1&#39;].agg(&#39;sum&#39;)</code></pre>
<pre><code>## V4
## A    17
## B    17
## C     1
## Name: V1, dtype: int64</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="count-number-of-observations-for-each-group" class="section level4">
<h4>Count number of observations for each group</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, .N, by = V4]</code></pre>
<pre><code>##    V4 N
## 1:  A 3
## 2:  B 3
## 3:  C 3</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.groupby(&#39;V4&#39;).size()</code></pre>
<pre><code>## V4
## A    3
## B    3
## C    3
## dtype: int64</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="add-a-column-with-number-of-observations-for-each-group" class="section level4">
<h4>Add a column with number of observations for each group</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, n := .N, by = V1][]
DT[, n := NULL] # rm column for consistency</code></pre>
<pre><code>##    V1 V2 V4 n
## 1:  1  0  A 5
## 2:  4  0  B 4
## 3:  1  0  C 5
## 4:  4  4  A 4
## 5:  1  5  B 5
## 6:  4  6  C 4
## 7:  1  7  A 5
## 8:  4  8  B 4
## 9:  1  9  C 5</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="retrieve-the-firstlastnth-observation-for-each-group" class="section level4">
<h4>Retrieve the first/last/nth observation for each group</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, data.table::first(V2), by = V4]
DT[, data.table::last(V2), by = V4]
DT[, V2[2], by = V4]</code></pre>
<pre><code>##    V4 V1
## 1:  A  0
## 2:  B  0
## 3:  C  0
##    V4 V1
## 1:  A  7
## 2:  B  8
## 3:  C  9
##    V4 V1
## 1:  A  4
## 2:  B  5
## 3:  C  6</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.groupby(&#39;V4&#39;)[&#39;V2&#39;].first()</code></pre>
<pre><code>## V4
## A    0
## B    0
## C    0
## Name: V2, dtype: int64</code></pre>
<pre class="python"><code>DF.groupby(&#39;V4&#39;)[&#39;V2&#39;].last()</code></pre>
<pre><code>## V4
## A    7
## B    8
## C    9
## Name: V2, dtype: int64</code></pre>
<pre class="python"><code>DF.groupby(&#39;V4&#39;)[&#39;V2&#39;].nth(1) # 0-based</code></pre>
<pre><code>## V4
## A    4
## B    5
## C    6
## Name: V2, dtype: int64</code></pre>
</td>
</tr>
</tbody>
</table>
<!----------------------------------------------------------------------------
                           GOING FURTHER
------------------------------------------------------------------------------->
<br><br>
<hr class = "hr2">
</div>
</div>
</div>
<div id="going-further" class="section level1">
<h1>Going further</h1>
<div id="advanced-columns-manipulation" class="section level3">
<h3>Advanced columns manipulation</h3>
<div id="summarise-all-the-columns" class="section level4">
<h4>Summarise all the columns</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, lapply(.SD, max)]</code></pre>
<pre><code>##    V1 V2 V4
## 1:  4  9  C</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.apply(np.max, axis = 0)</code></pre>
<pre><code>## V1    16
## V2     9
## V4     C
## dtype: object</code></pre>
<pre class="python"><code>DF.apply(np.max, axis = 0).to_frame().T</code></pre>
<pre><code>##    V1 V2 V4
## 0  16  9  C</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="summarise-several-columns-1" class="section level4">
<h4>Summarise several columns</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, lapply(.SD, mean),
     .SDcols = c(&quot;V1&quot;, &quot;V2&quot;)]</code></pre>
<pre><code>##          V1       V2
## 1: 2.333333 4.333333</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF[[&#39;V1&#39;, &#39;V2&#39;]].apply(np.mean, axis = 0)</code></pre>
<pre><code>## V1    7.666667
## V2    4.333333
## dtype: float64</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="summarise-several-columns-by-group" class="section level4">
<h4>Summarise several columns by group</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, by = V4,
     lapply(.SD, mean),
     .SDcols = c(&quot;V1&quot;, &quot;V2&quot;)]
## using patterns (regex)
DT[, by = V4,
     lapply(.SD, mean),
     .SDcols = patterns(&quot;V1|V2|Z0&quot;)]</code></pre>
<pre><code>##    V4 V1       V2
## 1:  A  2 3.666667
## 2:  B  3 4.333333
## 3:  C  2 5.000000
##    V4 V1       V2
## 1:  A  2 3.666667
## 2:  B  3 4.333333
## 3:  C  2 5.000000</code></pre>
</td>
<td align="left">
<pre class="python"><code>(DF.groupby(&#39;V4&#39;)[[&#39;V1&#39;, &#39;V2&#39;]]
   .apply(np.mean, axis = 0)
   .reset_index())
## using regex</code></pre>
<pre><code>##   V4    V1        V2
## 0  A   6.0  3.666667
## 1  B  11.0  4.333333
## 2  C   6.0  5.000000</code></pre>
<pre class="python"><code>(DF.filter(regex=(&#39;V1|V2|V4&#39;))
   .groupby(&#39;V4&#39;)
   .apply(np.mean, axis = 0)
   .reset_index())</code></pre>
<pre><code>##   V4    V1        V2
## 0  A   6.0  3.666667
## 1  B  11.0  4.333333
## 2  C   6.0  5.000000</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="summarise-with-more-than-one-function-by-group" class="section level4">
<h4>Summarise with more than one function by group</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, by = V4,
     c(lapply(.SD, sum),
       lapply(.SD, mean))]</code></pre>
<pre><code>##    V4 V1 V2 V1       V2
## 1:  A  6 11  2 3.666667
## 2:  B  9 13  3 4.333333
## 3:  C  6 15  2 5.000000</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.groupby(&#39;V4&#39;).agg([&#39;sum&#39;, &#39;mean&#39;])</code></pre>
<pre><code>##     V1       V2          
##    sum mean sum      mean
## V4                       
## A   18    6  11  3.666667
## B   33   11  13  4.333333
## C   18    6  15  5.000000</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="summarise-using-a-condition" class="section level4">
<h4>Summarise using a condition</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, lapply(.SD, mean),
     .SDcols = is.numeric]
foo &lt;- function(x) {is.numeric(x) &amp;&amp; mean(x) &gt; 3}
DT[, lapply(.SD, mean),
   .SDcols = foo]</code></pre>
<pre><code>##          V1       V2
## 1: 2.333333 4.333333
##          V2
## 1: 4.333333</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.select_dtypes(include = [np.number]).apply(np.mean, axis = 0)</code></pre>
<pre><code>## V1    7.666667
## V2    4.333333
## dtype: float64</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="modify-all-the-columns" class="section level4">
<h4>Modify all the columns</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, lapply(.SD, rev)]</code></pre>
<pre><code>##    V1 V2 V4
## 1:  1  9  C
## 2:  4  8  B
## 3:  1  7  A
## 4:  4  6  C
## 5:  1  5  B
## 6:  4  4  A
## 7:  1  0  C
## 8:  4  0  B
## 9:  1  0  A</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.apply(lambda x: x[::-1], axis = 0)</code></pre>
<pre><code>##    V1  V2 V4
## 8   1   9  C
## 7  16   8  B
## 6   1   7  A
## 5  16   6  C
## 4   1   5  B
## 3  16   4  A
## 2   1   0  C
## 1  16   0  B
## 0   1   0  A</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="modify-several-columns-dropping-the-others" class="section level4">
<h4>Modify several columns (dropping the others)</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, lapply(.SD, sqrt),
     .SDcols = V1:V2]
DT[, lapply(.SD, exp),
     .SDcols = !&quot;V4&quot;]</code></pre>
<pre><code>##    V1       V2
## 1:  1 0.000000
## 2:  2 0.000000
## 3:  1 0.000000
## 4:  2 2.000000
## 5:  1 2.236068
## 6:  2 2.449490
## 7:  1 2.645751
## 8:  2 2.828427
## 9:  1 3.000000
##           V1         V2
## 1:  2.718282    1.00000
## 2: 54.598150    1.00000
## 3:  2.718282    1.00000
## 4: 54.598150   54.59815
## 5:  2.718282  148.41316
## 6: 54.598150  403.42879
## 7:  2.718282 1096.63316
## 8: 54.598150 2980.95799
## 9:  2.718282 8103.08393</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.filter(regex=(&#39;V1|V2&#39;)).apply(np.sqrt, axis = 0)</code></pre>
<pre><code>##     V1        V2
## 0  1.0  0.000000
## 1  4.0  0.000000
## 2  1.0  0.000000
## 3  4.0  2.000000
## 4  1.0  2.236068
## 5  4.0  2.449490
## 6  1.0  2.645751
## 7  4.0  2.828427
## 8  1.0  3.000000</code></pre>
<pre class="python"><code>DF.filter(regex=(&#39;^(?!V4)&#39;)).apply(np.exp, axis = 0)</code></pre>
<pre><code>##              V1           V2
## 0  2.718282e+00     1.000000
## 1  8.886111e+06     1.000000
## 2  2.718282e+00     1.000000
## 3  8.886111e+06    54.598150
## 4  2.718282e+00   148.413159
## 5  8.886111e+06   403.428793
## 6  2.718282e+00  1096.633158
## 7  8.886111e+06  2980.957987
## 8  2.718282e+00  8103.083928</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="modify-several-columns-keeping-the-others" class="section level4">
<h4>Modify several columns (keeping the others)</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, c(&quot;V1&quot;, &quot;V2&quot;) := lapply(.SD, sqrt),
     .SDcols = c(&quot;V1&quot;, &quot;V2&quot;)]

cols &lt;- setdiff(names(DT), &quot;V4&quot;)
DT[, (cols) := lapply(.SD, &quot;^&quot;, 2L),
     .SDcols = cols]</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF[[&#39;V1&#39;, &#39;V2&#39;]] = DF.filter(regex=(&#39;V1|V2&#39;)).apply(np.sqrt, axis = 0)
cols = DF.columns.difference([&#39;V4&#39;])
DF.loc[:, cols] = DF.loc[:, cols].apply(lambda x: np.power(x, 2), axis = 0)</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="modify-columns-using-a-condition-dropping-the-others" class="section level4">
<h4>Modify columns using a condition (dropping the others)</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, .SD - 1,
     .SDcols = is.numeric]</code></pre>
<pre><code>##    V1 V2
## 1:  0 -1
## 2:  3 -1
## 3:  0 -1
## 4:  3  3
## 5:  0  4
## 6:  3  5
## 7:  0  6
## 8:  3  7
## 9:  0  8</code></pre>
</td>
<td align="left">
<pre class="python"><code>cols = DF.select_dtypes(include = [np.number]).columns
DF.loc[:, cols].apply(lambda x: x - 1)
# DF.transform?</code></pre>
<pre><code>##      V1   V2
## 0   0.0 -1.0
## 1  15.0 -1.0
## 2   0.0 -1.0
## 3  15.0  3.0
## 4   0.0  4.0
## 5  15.0  5.0
## 6   0.0  6.0
## 7  15.0  7.0
## 8   0.0  8.0</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="modify-columns-using-a-condition-keeping-the-others" class="section level4">
<h4>Modify columns using a condition (keeping the others)</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, (cols) := lapply(.SD, as.integer),
     .SDcols = is.numeric]</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.loc[:, cols] = DF.loc[:, cols].astype(int)</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="use-a-complex-expression" class="section level4">
<h4>Use a complex expression</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, by = V4,
     .(V1[1:2], &quot;X&quot;)]</code></pre>
<pre><code>##    V4 V1 V2
## 1:  A  1  X
## 2:  A  4  X
## 3:  B  4  X
## 4:  B  1  X
## 5:  C  1  X
## 6:  C  4  X</code></pre>
</td>
<td align="left">
<pre class="python"><code>(DF.groupby(&#39;V4&#39;)
   .head(2)[[&#39;V4&#39;, &#39;V1&#39;]]
   .assign(V2 = &#39;X&#39;)
   .sort_values([&#39;V4&#39;]))</code></pre>
<pre><code>##   V4  V1 V2
## 0  A   1  X
## 3  A  16  X
## 1  B  16  X
## 4  B   1  X
## 2  C   1  X
## 5  C  16  X</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="use-multiple-expressions-with-dtj" class="section level4">
<h4>Use multiple expressions (with <code>DT[,{j}]</code>)</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, {print(V1) #  comments here!
      print(summary(V1))
      x &lt;- V1 + sum(V2)
     .(A = 1:.N, B = x) # last list returned as a data.table
     }]</code></pre>
<pre><code>## [1] 1 4 1 4 1 4 1 4 1
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   1.000   1.000   1.000   2.333   4.000   4.000 
##    A  B
## 1: 1 39
## 2: 2 42
## 3: 3 39
## 4: 4 42
## 5: 5 39
## 6: 6 42
## 7: 7 39
## 8: 8 42
## 9: 9 39</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
<br>
<hr>
</div>
</div>
<div id="chain-expressions" class="section level3">
<h3>Chain expressions</h3>
<div id="expression-chaining-using-dt-recommended" class="section level4">
<h4>Expression chaining using <code>DT[][]</code> (recommended)</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, by = V4, 
     .(V1sum = sum(V1)) ][
     V1sum &gt; 5]</code></pre>
<pre><code>##    V4 V1sum
## 1:  A     6
## 2:  B     9
## 3:  C     6</code></pre>
</td>
<td align="left">
<pre class="python"><code>(DF.groupby(&#39;V4&#39;)[&#39;V1&#39;]
   .agg({&#39;V1sum&#39; : np.sum})
   .query(&#39;V1sum&gt;4&#39;))</code></pre>
<pre><code>##     V1sum
## V4       
## A      18
## B      33
## C      18
## 
## /home/xu/anaconda3/bin/python:2: FutureWarning: using a dict on a Series for aggregation
## is deprecated and will be removed in a future version. Use                 named aggregation instead.
## 
##     &gt;&gt;&gt; grouper.agg(name_1=func_1, name_2=func_2)</code></pre>
</td>
</tr>
</tbody>
</table>
<br>
<hr>
</div>
</div>
<div id="indexing-and-keys" class="section level3">
<h3>Indexing and Keys</h3>
<div id="set-the-keyindex" class="section level4">
<h4>Set the key/index</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>setkey(DT, V4)
setindex(DT, V4)</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.set_index(&#39;V4&#39;, drop = False, inplace = True)
DF.sort_index(inplace = True)</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="select-the-matching-rows" class="section level4">
<h4>Select the matching rows</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[&quot;A&quot;, on = &quot;V4&quot;]
DT[c(&quot;A&quot;, &quot;C&quot;), on = .(V4)] # same as on = &quot;V4&quot;</code></pre>
<pre><code>##    V1 V2 V4
## 1:  1  0  A
## 2:  4  4  A
## 3:  1  7  A
##    V1 V2 V4
## 1:  1  0  A
## 2:  4  4  A
## 3:  1  7  A
## 4:  1  0  C
## 5:  4  5  C
## 6:  1  9  C</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.loc[&#39;A&#39;]</code></pre>
<pre><code>##     V1  V2 V4
## V4           
## A    1   0  A
## A   16   4  A
## A    1   7  A</code></pre>
<pre class="python"><code>DF.loc[[&#39;A&#39;, &#39;C&#39;]]</code></pre>
<pre><code>##     V1  V2 V4
## V4           
## A    1   0  A
## A   16   4  A
## A    1   7  A
## C    1   0  C
## C   16   5  C
## C    1   9  C</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="select-the-first-matching-row" class="section level4">
<h4>Select the first matching row</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[&quot;B&quot;, on = &quot;V4&quot;, mult = &quot;first&quot;]
DT[c(&quot;B&quot;, &quot;C&quot;), on = &quot;V4&quot;, mult = &quot;first&quot;]</code></pre>
<pre><code>##    V1 V2 V4
## 1:  4  0  B
##    V1 V2 V4
## 1:  4  0  B
## 2:  1  0  C</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.loc[&#39;B&#39;].head(1)
# ?</code></pre>
<pre><code>##     V1  V2 V4
## V4           
## B   16   0  B</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="select-the-last-matching-row" class="section level4">
<h4>Select the last matching row</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[&quot;A&quot;, on = &quot;V4&quot;, mult = &quot;last&quot;]</code></pre>
<pre><code>##    V1 V2 V4
## 1:  1  7  A</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.loc[&#39;A&#39;].tail(1)</code></pre>
<pre><code>##     V1  V2 V4
## V4           
## A    1   7  A</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="nomatch-argument" class="section level4">
<h4>Nomatch argument</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code># (default) returns a row with &quot;D&quot; even if not found
DT[c(&quot;A&quot;, &quot;D&quot;), on = &quot;V4&quot;, nomatch = NA]
# no rows for unmatched values
DT[c(&quot;A&quot;, &quot;D&quot;), on = &quot;V4&quot;, nomatch = 0]</code></pre>
<pre><code>##    V1 V2 V4
## 1:  1  0  A
## 2:  4  4  A
## 3:  1  7  A
## 4: NA NA  D
##    V1 V2 V4
## 1:  1  0  A
## 2:  4  4  A
## 3:  1  7  A</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.loc[[&#39;A&#39;, &#39;D&#39;]]</code></pre>
<pre><code>##       V1   V2   V4
## V4                
## A    1.0  0.0    A
## A   16.0  4.0    A
## A    1.0  7.0    A
## D    NaN  NaN  NaN
## 
## /home/xu/anaconda3/bin/python:1: FutureWarning: 
## Passing list-likes to .loc or [] with any missing label will raise
## KeyError in the future, you can use .reindex() as an alternative.
## 
## See the documentation here:
## https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#deprecate-loc-reindex-listlike</code></pre>
<pre class="python"><code>DF.loc[[&#39;A&#39;, &#39;D&#39;]].dropna()</code></pre>
<pre><code>##       V1   V2 V4
## V4              
## A    1.0  0.0  A
## A   16.0  4.0  A
## A    1.0  7.0  A</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="apply-a-function-on-the-matching-rows" class="section level4">
<h4>Apply a function on the matching rows</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[c(&quot;A&quot;, &quot;C&quot;), sum(V1), on = &quot;V4&quot;]</code></pre>
<pre><code>## [1] 12</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.loc[[&#39;A&#39;, &#39;C&#39;]].V1.sum()</code></pre>
<pre><code>## 36</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="modify-values-for-matching-rows" class="section level4">
<h4>Modify values for matching rows</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[&quot;A&quot;, V1 := 0, on = &quot;V4&quot;]
DT</code></pre>
<pre><code>##    V1 V2 V4
## 1:  0  0  A
## 2:  0  4  A
## 3:  0  7  A
## 4:  4  0  B
## 5:  1  5  B
## 6:  4  8  B
## 7:  1  0  C
## 8:  4  5  C
## 9:  1  9  C</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.loc[&#39;A&#39;, &#39;V1&#39;] = 0</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="use-keys-in-by" class="section level4">
<h4>Use keys in by</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[!&quot;B&quot;, sum(V1), on = &quot;V4&quot;, by = .EACHI]
DT[V4 != &quot;B&quot;,
   by = V4,
   sum(V1)]   # same</code></pre>
<pre><code>##    V4 V1
## 1:  A  0
## 2:  C  6
##    V4 V1
## 1:  A  0
## 2:  C  6</code></pre>
</td>
<td align="left">
<pre class="python"><code>(DF.loc[~DF.index.isin([&#39;B&#39;])]
   .groupby(level = 0)[[&#39;V1&#39;]]
   .agg(&#39;sum&#39;))</code></pre>
<pre><code>##     V1
## V4    
## A    0
## C   18</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="set-keysindices-for-multiple-columns" class="section level4">
<h4>Set keys/indices for multiple columns</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>setkey(DT, V4, V1) # or setkeyv(DT, c(&quot;V4&quot;, &quot;V1&quot;))
setindex(DT, V4, V1) # setindexv(DT, c(&quot;V4&quot;, &quot;V1&quot;))</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.set_index([&#39;V4&#39;, &#39;V1&#39;], drop = False, inplace = True)
DF.sort_index(inplace = True)</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="subset-using-multiple-keysindices" class="section level4">
<h4>Subset using multiple keys/indices</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[.(&quot;C&quot;, 1), on = .(V4, V1)]
DT[.(c(&quot;B&quot;, &quot;C&quot;), 1), on = .(V4, V1)]
# using which = TRUE only returns the matching rows indices
DT[.(c(&quot;B&quot;, &quot;C&quot;), 1), on = .(V4, V1), which = TRUE]</code></pre>
<pre><code>##    V1 V2 V4
## 1:  1  0  C
## 2:  1  9  C
##    V1 V2 V4
## 1:  1  5  B
## 2:  1  0  C
## 3:  1  9  C
## [1] 4 7 8</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.loc[&#39;C&#39;, 1]</code></pre>
<pre><code>##        V1  V2 V4
## V4 V1           
## C  1    1   0  C
##    1    1   9  C</code></pre>
<pre class="python"><code>DF.loc[([&#39;B&#39;, &#39;C&#39;], 1), :]</code></pre>
<pre><code>##        V1  V2 V4
## V4 V1           
## B  1    1   5  B
## C  1    1   0  C
##    1    1   9  C</code></pre>
<pre class="python"><code>list(np.where(DF.V4.isin([&#39;B&#39;, &#39;C&#39;]) &amp; DF.V1 == 1))</code></pre>
<pre><code>## [array([3, 6, 7])]</code></pre>
<pre class="python"><code>DF.index.isin({&#39;V4&#39;: [&#39;B&#39;, &#39;C&#39;], &#39;V1&#39;: [1]}) # wrong</code></pre>
<pre><code>## array([False, False, False, False, False, False, False, False, False])</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="remove-keysindices" class="section level4">
<h4>Remove keys/indices</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>setkey(DT, NULL)
setindex(DT, NULL)</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.reset_index(inplace = True, drop = True)</code></pre>
</td>
</tr>
</tbody>
</table>
<br>
<hr>
</div>
</div>
<div id="set-modifications" class="section level3">
<h3><code>set*()</code> modifications</h3>
<div id="replace-values" class="section level4">
<h4>Replace values</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>set(DT, i = 1L, j = 2L, value = 3L)</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.iloc[0, 1] = 3</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="reorder-rows" class="section level4">
<h4>Reorder rows</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>setorder(DT, V4, -V1)
setorderv(DT, c(&quot;V4&quot;, &quot;V1&quot;), c(1, -1))</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.sort_values([&#39;V4&#39;,&#39;V1&#39;], ascending = [True, False], inplace = True)</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="modify-colnames" class="section level4">
<h4>Modify colnames</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>setnames(DT, old = &quot;V2&quot;, new = &quot;v2&quot;)
setnames(DT, old = -(c(1, 3)), new = &quot;V2&quot;)</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.rename(columns = {&#39;V2&#39;:&#39;v2&#39;}, inplace = True)
cols = DF.columns.values; cols[1] = &#39;V2&#39;
DF.columns = cols</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="reorder-columns" class="section level4">
<h4>Reorder columns</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>setcolorder(DT, c(&quot;V4&quot;, &quot;V1&quot;, &quot;V2&quot;))</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF = DF[[&#39;V4&#39;, &#39;V1&#39;, &#39;V2&#39;]]</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="convert-data" class="section level4">
<h4>Convert data</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code># ?setDT # data.frame or list to data.table
# ?setDF # data.table to data.frame
# ?setattr # modify attributes</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
<br>
<hr>
</div>
</div>
<div id="advanced-use-of-by" class="section level3">
<h3>Advanced use of by</h3>
<div id="select-firstlast-row-by-group" class="section level4">
<h4>Select first/last/… row by group</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, .SD[1], by = V4]
DT[, .SD[c(1, .N)], by = V4]
DT[, tail(.SD, 2), by = V4]</code></pre>
<pre><code>##    V4 V1 V2
## 1:  A  0  3
## 2:  B  4  0
## 3:  C  4  5
##    V4 V1 V2
## 1:  A  0  3
## 2:  A  0  7
## 3:  B  4  0
## 4:  B  1  5
## 5:  C  4  5
## 6:  C  1  9
##    V4 V1 V2
## 1:  A  0  4
## 2:  A  0  7
## 3:  B  4  8
## 4:  B  1  5
## 5:  C  1  0
## 6:  C  1  9</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.groupby(&#39;V4&#39;).head(1)</code></pre>
<pre><code>##   V4  V1  V2
## 0  A   0   3
## 4  B  16   0
## 8  C  16   5</code></pre>
<pre class="python"><code>DF.groupby(&#39;V4&#39;).nth([0, -1])</code></pre>
<pre><code>##     V1  V2
## V4        
## A    0   3
## A    0   7
## B   16   0
## B    1   5
## C   16   5
## C    1   9</code></pre>
<pre class="python"><code>DF.groupby(&#39;V4&#39;).nth([-1, -2])</code></pre>
<pre><code>##     V1  V2
## V4        
## A    0   4
## A    0   7
## B   16   8
## B    1   5
## C    1   0
## C    1   9</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="select-rows-using-a-nested-query" class="section level4">
<h4>Select rows using a nested query</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, .SD[which.min(V2)], by = V4]</code></pre>
<pre><code>##    V4 V1 V2
## 1:  A  0  3
## 2:  B  4  0
## 3:  C  1  0</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.loc[DF.groupby(&#39;V4&#39;).V2.idxmin()]</code></pre>
<pre><code>##   V4  V1  V2
## 0  A   0   3
## 4  B  16   0
## 6  C   1   0</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="add-a-group-counter-column" class="section level4">
<h4>Add a group counter column</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, Grp := .GRP, by = .(V4, V1)][]
DT[, Grp := NULL] # delete for consistency</code></pre>
<pre><code>##    V4 V1 V2 Grp
## 1:  A  0  3   1
## 2:  A  0  4   1
## 3:  A  0  7   1
## 4:  B  4  0   2
## 5:  B  4  8   2
## 6:  B  1  5   3
## 7:  C  4  5   4
## 8:  C  1  0   5
## 9:  C  1  9   5</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF[&#39;Grp&#39;] = DF.groupby([&#39;V4&#39;, &#39;V1&#39;]).ngroup()
del DF[&#39;Grp&#39;]</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="get-row-number-of-first-and-last-observation-by-group" class="section level4">
<h4>Get row number of first (and last) observation by group</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, .I, by = V4] # returns a data.table
DT[, .I[1], by = V4]
DT[, .I[c(1, .N)], by = V4]</code></pre>
<pre><code>##    V4 I
## 1:  A 1
## 2:  A 2
## 3:  A 3
## 4:  B 4
## 5:  B 5
## 6:  B 6
## 7:  C 7
## 8:  C 8
## 9:  C 9
##    V4 V1
## 1:  A  1
## 2:  B  4
## 3:  C  7
##    V4 V1
## 1:  A  1
## 2:  A  3
## 3:  B  4
## 4:  B  6
## 5:  C  7
## 6:  C  9</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="handle-list-columns-by-group" class="section level4">
<h4>Handle list-columns by group</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>DT[, .(.(V1)),  by = V4]  # return V1 as a list
DT[, .(.(.SD)), by = V4] # subsets of the data</code></pre>
<pre><code>##    V4    V1
## 1:  A 0,0,0
## 2:  B 4,4,1
## 3:  C 4,1,1
##    V4                V1
## 1:  A &lt;data.table[3x2]&gt;
## 2:  B &lt;data.table[3x2]&gt;
## 3:  C &lt;data.table[3x2]&gt;</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.groupby(&#39;V4&#39;)[&#39;V1&#39;].apply(list)
# ?</code></pre>
<pre><code>## V4
## A      [0, 0, 0]
## B    [16, 16, 1]
## C     [16, 1, 1]
## Name: V1, dtype: object</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="grouping-sets-multiple-by-at-once" class="section level4">
<h4>Grouping sets (multiple by at once)</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>rollup(DT,
       .(SumV2 = sum(V2)),
       by = c(&quot;V1&quot;, &quot;V4&quot;))

rollup(DT,
       .(SumV2 = sum(V2), .N),
       by = c(&quot;V1&quot;, &quot;V4&quot;),
       id = TRUE)

cube(DT,
     .(SumV2 = sum(V2), .N),
     by = c(&quot;V1&quot;, &quot;V4&quot;),
     id = TRUE)

groupingsets(DT,
             .(SumV2 = sum(V2), .N),
             by   = c(&quot;V1&quot;, &quot;V4&quot;),
             sets = list(&quot;V1&quot;, c(&quot;V1&quot;, &quot;V4&quot;)),
             id   = TRUE)</code></pre>
<pre><code>##    V1   V4 SumV2
## 1:  0    A    14
## 2:  4    B     8
## 3:  1    B     5
## 4:  4    C     5
## 5:  1    C     9
## 6:  0 &lt;NA&gt;    14
## 7:  4 &lt;NA&gt;    13
## 8:  1 &lt;NA&gt;    14
## 9: NA &lt;NA&gt;    41
##    grouping V1   V4 SumV2 N
## 1:        0  0    A    14 3
## 2:        0  4    B     8 2
## 3:        0  1    B     5 1
## 4:        0  4    C     5 1
## 5:        0  1    C     9 2
## 6:        1  0 &lt;NA&gt;    14 3
## 7:        1  4 &lt;NA&gt;    13 3
## 8:        1  1 &lt;NA&gt;    14 3
## 9:        3 NA &lt;NA&gt;    41 9
##     grouping V1   V4 SumV2 N
##  1:        0  0    A    14 3
##  2:        0  4    B     8 2
##  3:        0  1    B     5 1
##  4:        0  4    C     5 1
##  5:        0  1    C     9 2
##  6:        1  0 &lt;NA&gt;    14 3
##  7:        1  4 &lt;NA&gt;    13 3
##  8:        1  1 &lt;NA&gt;    14 3
##  9:        2 NA    A    14 3
## 10:        2 NA    B    13 3
## 11:        2 NA    C    14 3
## 12:        3 NA &lt;NA&gt;    41 9
##    grouping V1   V4 SumV2 N
## 1:        1  0 &lt;NA&gt;    14 3
## 2:        1  4 &lt;NA&gt;    13 3
## 3:        1  1 &lt;NA&gt;    14 3
## 4:        0  0    A    14 3
## 5:        0  4    B     8 2
## 6:        0  1    B     5 1
## 7:        0  4    C     5 1
## 8:        0  1    C     9 2</code></pre>
</td>
<td align="left">
<pre class="python"><code>dd = pd.pivot_table(DF, values=[&#39;V2&#39;], \
        index =[&#39;V1&#39;], columns=[&#39;V4&#39;], aggfunc = np.sum, margins = True)
pd.melt(dd, col_level = 1)
# ?</code></pre>
<pre><code>##      V4  value
## 0     A   14.0
## 1     A    NaN
## 2     A    NaN
## 3     A   14.0
## 4     B    NaN
## 5     B    5.0
## 6     B    8.0
## 7     B   13.0
## 8     C    NaN
## 9     C    9.0
## 10    C    5.0
## 11    C   14.0
## 12  All   14.0
## 13  All   14.0
## 14  All   13.0
## 15  All   41.0</code></pre>
</td>
</tr>
</tbody>
</table>
<!----------------------------------------------------------------------------
                               MISCELLANEOUS
------------------------------------------------------------------------------->
<br><br>
<hr class = "hr2">
</div>
</div>
</div>
<div id="miscellaneous" class="section level1">
<h1>Miscellaneous</h1>
<div id="read-write-data" class="section level3">
<h3>Read / Write data</h3>
<div id="write-data-to-a-csv-file" class="section level4">
<h4>Write data to a csv file</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>fwrite(DT, &quot;DT.csv&quot;)</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.to_csv(&#39;DF.csv&#39;, index = False)</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="write-data-to-a-tab-delimited-file" class="section level4">
<h4>Write data to a tab-delimited file</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>fwrite(DT, &quot;DT.txt&quot;, sep = &quot;\t&quot;)</code></pre>
</td>
<td align="left">
<pre class="python"><code>DF.to_csv(&#39;DF.txt&#39;, sep=&#39;\t&#39;, index = False)</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="write-list-column-data-to-a-csv-file" class="section level4">
<h4>Write list-column data to a csv file</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>fwrite(setDT(list(0, list(1:5))), &quot;DT2.csv&quot;)</code></pre>
</td>
<td align="left">
<pre class="python"><code>pd.DataFrame({&#39;V1&#39;:0, &#39;V2&#39;:[[1,2,3,4,5]]}).to_csv(&#39;DF2.csv&#39;, index = False)</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="read-a-csv-tab-delimited-file" class="section level4">
<h4>Read a csv / tab-delimited file</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>fread(&quot;DT.csv&quot;)
# fread(&quot;DT.csv&quot;, verbose = TRUE) # full details
fread(&quot;DT.txt&quot;, sep = &quot;\t&quot;)</code></pre>
<pre><code>##    V4 V1 V2
## 1:  A  0  3
## 2:  A  0  4
## 3:  A  0  7
## 4:  B  4  0
## 5:  B  4  8
## 6:  B  1  5
## 7:  C  4  5
## 8:  C  1  0
## 9:  C  1  9
##    V4 V1 V2
## 1:  A  0  3
## 2:  A  0  4
## 3:  A  0  7
## 4:  B  4  0
## 5:  B  4  8
## 6:  B  1  5
## 7:  C  4  5
## 8:  C  1  0
## 9:  C  1  9</code></pre>
</td>
<td align="left">
<pre class="python"><code>pd.read_csv(&#39;DF.csv&#39;)</code></pre>
<pre><code>##   V4  V1  V2
## 0  A   0   3
## 1  A   0   4
## 2  A   0   7
## 3  B  16   0
## 4  B  16   8
## 5  B   1   5
## 6  C  16   5
## 7  C   1   0
## 8  C   1   9</code></pre>
<pre class="python"><code>pd.read_csv(&#39;DF.txt&#39;, sep = &#39;\t&#39;)</code></pre>
<pre><code>##   V4  V1  V2
## 0  A   0   3
## 1  A   0   4
## 2  A   0   7
## 3  B  16   0
## 4  B  16   8
## 5  B   1   5
## 6  C  16   5
## 7  C   1   0
## 8  C   1   9</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="read-a-csv-file-selecting-droping-columns" class="section level4">
<h4>Read a csv file selecting / droping columns</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>fread(&quot;DT.csv&quot;, select = c(&quot;V1&quot;, &quot;V4&quot;))
fread(&quot;DT.csv&quot;, drop = &quot;V4&quot;)</code></pre>
<pre><code>##    V1 V4
## 1:  0  A
## 2:  0  A
## 3:  0  A
## 4:  4  B
## 5:  4  B
## 6:  1  B
## 7:  4  C
## 8:  1  C
## 9:  1  C
##    V1 V2
## 1:  0  3
## 2:  0  4
## 3:  0  7
## 4:  4  0
## 5:  4  8
## 6:  1  5
## 7:  4  5
## 8:  1  0
## 9:  1  9</code></pre>
</td>
<td align="left">
<pre class="python"><code>pd.read_csv(&#39;DF.csv&#39;, usecols=[&#39;V1&#39;, &#39;V4&#39;])
# ?</code></pre>
<pre><code>##   V4  V1
## 0  A   0
## 1  A   0
## 2  A   0
## 3  B  16
## 4  B  16
## 5  B   1
## 6  C  16
## 7  C   1
## 8  C   1</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="read-and-rbind-several-files" class="section level4">
<h4>Read and rbind several files</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>rbindlist(lapply(c(&quot;DT.csv&quot;, &quot;DT.csv&quot;), fread))
# c(&quot;DT.csv&quot;, &quot;DT.csv&quot;) %&gt;% lapply(fread) %&gt;% rbindlist</code></pre>
<pre><code>##     V4 V1 V2
##  1:  A  0  3
##  2:  A  0  4
##  3:  A  0  7
##  4:  B  4  0
##  5:  B  4  8
##  6:  B  1  5
##  7:  C  4  5
##  8:  C  1  0
##  9:  C  1  9
## 10:  A  0  3
## 11:  A  0  4
## 12:  A  0  7
## 13:  B  4  0
## 14:  B  4  8
## 15:  B  1  5
## 16:  C  4  5
## 17:  C  1  0
## 18:  C  1  9</code></pre>
</td>
<td align="left">
<pre class="python"><code>li = [pd.read_csv(fi) for fi in [&#39;DF.csv&#39;, &#39;DF.csv&#39;]]
pd.concat(li, axis = 0, ignore_index = True)</code></pre>
<pre><code>##    V4  V1  V2
## 0   A   0   3
## 1   A   0   4
## 2   A   0   7
## 3   B  16   0
## 4   B  16   8
## 5   B   1   5
## 6   C  16   5
## 7   C   1   0
## 8   C   1   9
## 9   A   0   3
## 10  A   0   4
## 11  A   0   7
## 12  B  16   0
## 13  B  16   8
## 14  B   1   5
## 15  C  16   5
## 16  C   1   0
## 17  C   1   9</code></pre>
</td>
</tr>
</tbody>
</table>
<br>
<hr>
</div>
</div>
<div id="reshape-data" class="section level3">
<h3>Reshape data</h3>
<div id="melt-data-from-wide-to-long" class="section level4">
<h4>Melt data (from wide to long)</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>melt(DT, id.vars = &quot;V4&quot;)
mDT &lt;- melt(DT,
            id.vars       = &quot;V4&quot;,
            measure.vars  = c(&quot;V1&quot;, &quot;V2&quot;),
            variable.name = &quot;Variable&quot;,
            value.name    = &quot;Value&quot;)</code></pre>
<pre><code>##     V4 variable value
##  1:  A       V1     0
##  2:  A       V1     0
##  3:  A       V1     0
##  4:  B       V1     4
##  5:  B       V1     4
##  6:  B       V1     1
##  7:  C       V1     4
##  8:  C       V1     1
##  9:  C       V1     1
## 10:  A       V2     3
## 11:  A       V2     4
## 12:  A       V2     7
## 13:  B       V2     0
## 14:  B       V2     8
## 15:  B       V2     5
## 16:  C       V2     5
## 17:  C       V2     0
## 18:  C       V2     9</code></pre>
</td>
<td align="left">
<pre class="python"><code>pd.melt(DF, id_vars = [&#39;V4&#39;])</code></pre>
<pre><code>##    V4 variable  value
## 0   A       V1      0
## 1   A       V1      0
## 2   A       V1      0
## 3   B       V1     16
## 4   B       V1     16
## 5   B       V1      1
## 6   C       V1     16
## 7   C       V1      1
## 8   C       V1      1
## 9   A       V2      3
## 10  A       V2      4
## 11  A       V2      7
## 12  B       V2      0
## 13  B       V2      8
## 14  B       V2      5
## 15  C       V2      5
## 16  C       V2      0
## 17  C       V2      9</code></pre>
<pre class="python"><code>mDF = pd.melt(DF,
              id_vars    = [&#39;V4&#39;],
              value_vars = (&#39;V1&#39;, &#39;V2&#39;), 
              var_name   = &#39;Variable&#39;,
              value_name = &#39;Value&#39;)</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="cast-data-from-long-to-wide" class="section level4">
<h4>Cast data (from long to wide)</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>dcast(mDT, V4 ~ Variable) # aggregate by count</code></pre>
<pre><code>## Using &#39;Value&#39; as value column. Use &#39;value.var&#39; to override</code></pre>
<pre><code>## Aggregate function missing, defaulting to &#39;length&#39;</code></pre>
<pre class="r"><code>dcast(mDT, V4 ~ Variable, fun.aggregate = sum)</code></pre>
<pre><code>## Using &#39;Value&#39; as value column. Use &#39;value.var&#39; to override</code></pre>
<pre class="r"><code>dcast(mDT, V4 ~ Value &gt; 5)</code></pre>
<pre><code>## Using &#39;Value&#39; as value column. Use &#39;value.var&#39; to override
## Aggregate function missing, defaulting to &#39;length&#39;</code></pre>
<pre class="r"><code># see ?dcast: multiple values / fun.aggregate</code></pre>
<pre><code>##    V4 V1 V2
## 1:  A  3  3
## 2:  B  3  3
## 3:  C  3  3
##    V4 V1 V2
## 1:  A  0 14
## 2:  B  9 13
## 3:  C  6 14
##    V4 FALSE TRUE
## 1:  A     5    1
## 2:  B     5    1
## 3:  C     5    1</code></pre>
</td>
<td align="left">
<pre class="python"><code># mDF.pivot()
pass</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="split" class="section level4">
<h4>Split</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>split(DT, by = &quot;V4&quot;) # S3 method</code></pre>
<pre><code>## $A
##    V4 V1 V2
## 1:  A  0  3
## 2:  A  0  4
## 3:  A  0  7
## 
## $B
##    V4 V1 V2
## 1:  B  4  0
## 2:  B  4  8
## 3:  B  1  5
## 
## $C
##    V4 V1 V2
## 1:  C  4  5
## 2:  C  1  0
## 3:  C  1  9</code></pre>
</td>
<td align="left">
<pre class="python"><code>list(DF.groupby(&#39;V4&#39;))</code></pre>
<pre><code>## [(&#39;A&#39;,   V4  V1  V2
## 0  A   0   3
## 1  A   0   4
## 2  A   0   7), (&#39;B&#39;,   V4  V1  V2
## 4  B  16   0
## 5  B  16   8
## 3  B   1   5), (&#39;C&#39;,   V4  V1  V2
## 8  C  16   5
## 6  C   1   0
## 7  C   1   9)]</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="split-and-transpose-a-vectorcolumn" class="section level4">
<h4>Split and transpose a vector/column</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>vec &lt;- c(&quot;A:a&quot;, &quot;B:b&quot;, &quot;C:c&quot;)
tstrsplit(vec, split = &quot;:&quot;, keep = 2L) # works on vector
setDT(tstrsplit(vec, split = &quot;:&quot;))[]</code></pre>
<pre><code>## [[1]]
## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;
## 
##    V1 V2
## 1:  A  a
## 2:  B  b
## 3:  C  c</code></pre>
</td>
<td align="left">
<pre class="python"><code>vec = [&#39;A:a&#39;, &#39;B:b&#39;, &#39;C:c&#39;]
[i.split(&#39;:&#39;)[1] for i in vec]</code></pre>
<pre><code>## [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</code></pre>
<pre class="python"><code>pd.DataFrame([i.split(&#39;:&#39;) for i in vec])</code></pre>
<pre><code>##    0  1
## 0  A  a
## 1  B  b
## 2  C  c</code></pre>
</td>
</tr>
</tbody>
</table>
<br>
<hr>
</div>
</div>
<div id="other" class="section level3">
<h3>Other</h3>
<div id="check-package-installation" class="section level4">
<h4>Check package installation</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code># test.data.table()
# There&#39;s more lines of test code in data.table than there is code!</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="list-data.tablestibbles" class="section level4">
<h4>List data.tables/tibbles</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>tables()</code></pre>
<pre><code>##    NAME NROW NCOL MB              COLS KEY
## 1:   DT    9    3  0          V4,V1,V2    
## 2:  mDT   18    3  0 V4,Variable,Value    
## Total: 0MB</code></pre>
</td>
<td align="left">
<pre class="python"><code># %whos DataFrame # IPython
for i in dir():
    if type(globals()[i]) == pd.DataFrame:
        print(i)</code></pre>
<pre><code>## DF
## dd
## mDF</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="getset-number-of-threads-when-parallelized" class="section level4">
<h4>Get/Set number of threads when parallelized</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>getDTthreads() # setDTthreads()</code></pre>
<pre><code>## [1] 2</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="leadlag" class="section level4">
<h4>Lead/Lag</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>shift(1:10, n = 1,   fill = NA, type = &quot;lag&quot;)
shift(1:10, n = 1:2, fill = NA, type = &quot;lag&quot;) # multiple
shift(1:10, n = 1,   fill = NA, type = &quot;lead&quot;)</code></pre>
<pre><code>##  [1] NA  1  2  3  4  5  6  7  8  9
## [[1]]
##  [1] NA  1  2  3  4  5  6  7  8  9
## 
## [[2]]
##  [1] NA NA  1  2  3  4  5  6  7  8
## 
##  [1]  2  3  4  5  6  7  8  9 10 NA</code></pre>
</td>
<td align="left">
<pre class="python"><code>pd.Series(np.arange(1, 11)).shift(periods = 1)</code></pre>
<pre><code>## 0    NaN
## 1    1.0
## 2    2.0
## 3    3.0
## 4    4.0
## 5    5.0
## 6    6.0
## 7    7.0
## 8    8.0
## 9    9.0
## dtype: float64</code></pre>
<pre class="python"><code>[pd.Series(np.arange(1, 11)).shift(periods = i) for i in [1,2]]</code></pre>
<pre><code>## [0    NaN
## 1    1.0
## 2    2.0
## 3    3.0
## 4    4.0
## 5    5.0
## 6    6.0
## 7    7.0
## 8    8.0
## 9    9.0
## dtype: float64, 0    NaN
## 1    NaN
## 2    1.0
## 3    2.0
## 4    3.0
## 5    4.0
## 6    5.0
## 7    6.0
## 8    7.0
## 9    8.0
## dtype: float64]</code></pre>
<pre class="python"><code>pd.Series(np.arange(1, 11)).shift(periods = -1)</code></pre>
<pre><code>## 0     2.0
## 1     3.0
## 2     4.0
## 3     5.0
## 4     6.0
## 5     7.0
## 6     8.0
## 7     9.0
## 8    10.0
## 9     NaN
## dtype: float64</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="generate-run-length-ids" class="section level4">
<h4>Generate run-length ids</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>rleid(rep(c(&quot;a&quot;, &quot;b&quot;, &quot;a&quot;), each = 3)) # see also ?rleidv
rleid(rep(c(&quot;a&quot;, &quot;b&quot;, &quot;a&quot;), each = 3), prefix = &quot;G&quot;)</code></pre>
<pre><code>## [1] 1 1 1 2 2 2 3 3 3
## [1] &quot;G1&quot; &quot;G1&quot; &quot;G1&quot; &quot;G2&quot; &quot;G2&quot; &quot;G2&quot; &quot;G3&quot; &quot;G3&quot; &quot;G3&quot;</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="vectorised-ifelse-statements" class="section level4">
<h4>Vectorised <code>ifelse</code> statements</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>x &lt;- 1:10
fcase(
  x %% 6 == 0, &quot;fizz buzz&quot;,
  x %% 2 == 0, &quot;fizz&quot;,
  x %% 3 == 0, &quot;buzz&quot;,
  default = NA_character_
)</code></pre>
<pre><code>##  [1] NA          &quot;fizz&quot;      &quot;buzz&quot;      &quot;fizz&quot;      NA          &quot;fizz buzz&quot;
##  [7] NA          &quot;fizz&quot;      &quot;buzz&quot;      &quot;fizz&quot;</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="rolling-functions" class="section level4">
<h4>Rolling functions</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code># todo</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
<!----------------------------------------------------------------------------
                           JOIN/BIND DATA SETS
------------------------------------------------------------------------------->
<br><br>
<hr class = "hr2">
</div>
</div>
</div>
<div id="joinbind-data-sets" class="section level1">
<h1>Join/Bind data sets</h1>
<div id="join" class="section level3">
<h3>Join</h3>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>x &lt;- data.table(Id  = c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;C&quot;),
                X1  = c(1L, 3L, 5L, 7L),
                XY  = c(&quot;x2&quot;, &quot;x4&quot;, &quot;x6&quot;, &quot;x8&quot;),
                key = &quot;Id&quot;)

y &lt;- data.table(Id  = c(&quot;A&quot;, &quot;B&quot;, &quot;B&quot;, &quot;D&quot;),
                Y1  = c(1L, 3L, 5L, 7L),
                XY  = c(&quot;y1&quot;, &quot;y3&quot;, &quot;y5&quot;, &quot;y7&quot;),
                key = &quot;Id&quot;)</code></pre>
</td>
<td align="left">
<pre class="python"><code>x = pd.DataFrame(
  {&quot;Id&quot; : [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;C&#39;],
   &quot;X1&quot; : [1, 3, 5, 7],
   &quot;XY&quot; : [&#39;x2&#39;, &#39;x4&#39;, &#39;x6&#39;, &#39;x8&#39;]})
y = pd.DataFrame(
  {&quot;Id&quot; : [&#39;A&#39;, &#39;B&#39;, &#39;B&#39;, &#39;D&#39;],
   &quot;Y1&quot; : [1, 3, 5, 7],
   &quot;XY&quot; : [&#39;y1&#39;, &#39;y3&#39;, &#39;y5&#39;, &#39;y7&#39;]})</code></pre>
</td>
</tr>
</tbody>
</table>
<div id="join-matching-rows-from-y-to-x" class="section level4">
<h4>Join matching rows from y to x</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>y[x, on = &quot;Id&quot;]
merge(x, y, all.x = TRUE, by = &quot;Id&quot;)
y[x] # requires keys</code></pre>
<pre><code>##    Id Y1   XY X1 i.XY
## 1:  A  1   y1  1   x2
## 2:  B  3   y3  3   x4
## 3:  B  5   y5  3   x4
## 4:  C NA &lt;NA&gt;  5   x6
## 5:  C NA &lt;NA&gt;  7   x8
##    Id X1 XY.x Y1 XY.y
## 1:  A  1   x2  1   y1
## 2:  B  3   x4  3   y3
## 3:  B  3   x4  5   y5
## 4:  C  5   x6 NA &lt;NA&gt;
## 5:  C  7   x8 NA &lt;NA&gt;
##    Id Y1   XY X1 i.XY
## 1:  A  1   y1  1   x2
## 2:  B  3   y3  3   x4
## 3:  B  5   y5  3   x4
## 4:  C NA &lt;NA&gt;  5   x6
## 5:  C NA &lt;NA&gt;  7   x8</code></pre>
</td>
<td align="left">
<pre class="python"><code>pd.merge(x, y, how = &#39;left&#39;, on = &#39;Id&#39;)</code></pre>
<pre><code>##   Id  X1 XY_x   Y1 XY_y
## 0  A   1   x2  1.0   y1
## 1  B   3   x4  3.0   y3
## 2  B   3   x4  5.0   y5
## 3  C   5   x6  NaN  NaN
## 4  C   7   x8  NaN  NaN</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="join-matching-rows-from-x-to-y" class="section level4">
<h4>Join matching rows from x to y</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>x[y, on = &quot;Id&quot;]
merge(x, y, all.y = TRUE, by = &quot;Id&quot;)
x[y] # requires keys</code></pre>
<pre><code>##    Id X1   XY Y1 i.XY
## 1:  A  1   x2  1   y1
## 2:  B  3   x4  3   y3
## 3:  B  3   x4  5   y5
## 4:  D NA &lt;NA&gt;  7   y7
##    Id X1 XY.x Y1 XY.y
## 1:  A  1   x2  1   y1
## 2:  B  3   x4  3   y3
## 3:  B  3   x4  5   y5
## 4:  D NA &lt;NA&gt;  7   y7
##    Id X1   XY Y1 i.XY
## 1:  A  1   x2  1   y1
## 2:  B  3   x4  3   y3
## 3:  B  3   x4  5   y5
## 4:  D NA &lt;NA&gt;  7   y7</code></pre>
</td>
<td align="left">
<pre class="python"><code>pd.merge(x, y, how = &#39;right&#39;, on = &#39;Id&#39;)</code></pre>
<pre><code>##   Id   X1 XY_x  Y1 XY_y
## 0  A  1.0   x2   1   y1
## 1  B  3.0   x4   3   y3
## 2  B  3.0   x4   5   y5
## 3  D  NaN  NaN   7   y7</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="join-matching-rows-from-both-x-and-y" class="section level4">
<h4>Join matching rows from both x and y</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>x[y, on = &quot;Id&quot;, nomatch = 0]
merge(x, y)
x[y, nomatch = 0] # requires keys</code></pre>
<pre><code>##    Id X1 XY Y1 i.XY
## 1:  A  1 x2  1   y1
## 2:  B  3 x4  3   y3
## 3:  B  3 x4  5   y5
##    Id X1 XY.x Y1 XY.y
## 1:  A  1   x2  1   y1
## 2:  B  3   x4  3   y3
## 3:  B  3   x4  5   y5
##    Id X1 XY Y1 i.XY
## 1:  A  1 x2  1   y1
## 2:  B  3 x4  3   y3
## 3:  B  3 x4  5   y5</code></pre>
</td>
<td align="left">
<pre class="python"><code>pd.merge(x, y, how = &#39;inner&#39;, on = &#39;Id&#39;)</code></pre>
<pre><code>##   Id  X1 XY_x  Y1 XY_y
## 0  A   1   x2   1   y1
## 1  B   3   x4   3   y3
## 2  B   3   x4   5   y5</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="join-keeping-all-the-rows" class="section level4">
<h4>Join keeping all the rows</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>merge(x, y, all = TRUE, by = &quot;Id&quot;)</code></pre>
<pre><code>##    Id X1 XY.x Y1 XY.y
## 1:  A  1   x2  1   y1
## 2:  B  3   x4  3   y3
## 3:  B  3   x4  5   y5
## 4:  C  5   x6 NA &lt;NA&gt;
## 5:  C  7   x8 NA &lt;NA&gt;
## 6:  D NA &lt;NA&gt;  7   y7</code></pre>
</td>
<td align="left">
<pre class="python"><code>pd.merge(x, y, how = &#39;outer&#39;, on = &#39;Id&#39;)</code></pre>
<pre><code>##   Id   X1 XY_x   Y1 XY_y
## 0  A  1.0   x2  1.0   y1
## 1  B  3.0   x4  3.0   y3
## 2  B  3.0   x4  5.0   y5
## 3  C  5.0   x6  NaN  NaN
## 4  C  7.0   x8  NaN  NaN
## 5  D  NaN  NaN  7.0   y7</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="return-rows-from-x-matching-y" class="section level4">
<h4>Return rows from x matching y</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>unique(x[y$Id, on = &quot;Id&quot;, nomatch = 0])
unique(x[y$Id, nomatch = 0]) # requires keys</code></pre>
<pre><code>##    Id X1 XY
## 1:  A  1 x2
## 2:  B  3 x4
##    Id X1 XY
## 1:  A  1 x2
## 2:  B  3 x4</code></pre>
</td>
<td align="left">
<pre class="python"><code>x[x.Id.isin(y.Id)]</code></pre>
<pre><code>##   Id  X1  XY
## 0  A   1  x2
## 1  B   3  x4</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="return-rows-from-x-not-matching-y" class="section level4">
<h4>Return rows from x not matching y</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>x[!y, on = &quot;Id&quot;]
x[!y] # requires keys</code></pre>
<pre><code>##    Id X1 XY
## 1:  C  5 x6
## 2:  C  7 x8
##    Id X1 XY
## 1:  C  5 x6
## 2:  C  7 x8</code></pre>
</td>
<td align="left">
<pre class="python"><code>x[~x.Id.isin(y.Id)]</code></pre>
<pre><code>##   Id  X1  XY
## 2  C   5  x6
## 3  C   7  x8</code></pre>
</td>
</tr>
</tbody>
</table>
<br>
<hr>
</div>
</div>
<div id="more-joins" class="section level3">
<h3>More joins</h3>
<div id="select-columns-while-joining" class="section level4">
<h4>Select columns while joining</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>x[y, .(Id, X1, i.XY)]   # i. prefix refers to cols in y
x[y, .(Id, x.XY, i.XY)] # x. prefix refers to cols in x</code></pre>
<pre><code>##    Id X1 i.XY
## 1:  A  1   y1
## 2:  B  3   y3
## 3:  B  3   y5
## 4:  D NA   y7
##    Id x.XY i.XY
## 1:  A   x2   y1
## 2:  B   x4   y3
## 3:  B   x4   y5
## 4:  D &lt;NA&gt;   y7</code></pre>
</td>
<td align="left">
<pre class="python"><code>pd.merge(x[[&#39;Id&#39;,&#39;X1&#39;]],
         y[[&#39;Id&#39;,&#39;XY&#39;]],
         how = &#39;right&#39;,
         on  = &#39;Id&#39;)</code></pre>
<pre><code>##   Id   X1  XY
## 0  A  1.0  y1
## 1  B  3.0  y3
## 2  B  3.0  y5
## 3  D  NaN  y7</code></pre>
<pre class="python"><code>pd.merge(x[[&#39;Id&#39;,&#39;XY&#39;]],
         y[[&#39;Id&#39;,&#39;XY&#39;]],
         how = &#39;right&#39;,
         on  = &#39;Id&#39;)</code></pre>
<pre><code>##   Id XY_x XY_y
## 0  A   x2   y1
## 1  B   x4   y3
## 2  B   x4   y5
## 3  D  NaN   y7</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="aggregate-columns-while-joining" class="section level4">
<h4>Aggregate columns while joining</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>y[x, .(X1Y1 = sum(Y1) * X1), by = .EACHI]</code></pre>
<pre><code>##    Id X1Y1
## 1:  A    1
## 2:  B   24
## 3:  C   NA
## 4:  C   NA</code></pre>
</td>
<td align="left">
<pre class="python"><code>(y.groupby(&#39;Id&#39;)[&#39;Y1&#39;]
    .agg(&#39;sum&#39;)
    .to_frame()
    .rename(columns={&#39;Y1&#39;: &#39;SumY1&#39;})
    .merge(x, how = &#39;right&#39;, on = &#39;Id&#39;)
    .assign(X1Y1 = lambda df: df.SumY1 * df.X1)
    .loc[:, [&#39;Id&#39;, &#39;X1Y1&#39;]])</code></pre>
<pre><code>##   Id  X1Y1
## 0  A   1.0
## 1  B  24.0
## 2  C   NaN
## 3  C   NaN</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="update-columns-while-joining" class="section level4">
<h4>Update columns while joining</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>y[x, SqX1 := i.X1^2]
y[, SqX1 := x[.BY, X1^2, on = &quot;Id&quot;], by = Id] # more memory-efficient
y[, SqX1 := NULL] # rm column for consistency</code></pre>
</td>
<td align="left">
<pre class="python"><code>(x.loc[:, [&#39;Id&#39;, &#39;X1&#39;]]
    .assign(SqX1 = lambda df: df.X1**2)
    .merge(y, how = &#39;right&#39;, on = &#39;Id&#39;)
    .loc[:, list(y.columns) + [&#39;SqX1&#39;]])</code></pre>
<pre><code>##   Id  Y1  XY  SqX1
## 0  A   1  y1   1.0
## 1  B   3  y3   9.0
## 2  B   5  y5   9.0
## 3  D   7  y7   NaN</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="adds-a-list-column-with-rows-from-y-matching-x-nest-join" class="section level4">
<h4>Adds a list column with rows from y matching x (nest-join)</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>x[, y := .(.(y[.BY, on = &quot;Id&quot;])), by = Id]
x[, y := NULL] # rm column for consistency</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="update-columns-while-joining-using-vectors-of-colnames" class="section level4">
<h4>Update columns while joining (using vectors of colnames)</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>cols  &lt;- c(&quot;NewXY&quot;, &quot;NewX1&quot;)
icols &lt;- paste0(&quot;i.&quot;, c(&quot;XY&quot;, &quot;X1&quot;))

y[x, (cols) := mget(icols)]

y[, (cols) := NULL] # rm columns for consistency</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="join-passing-columns-to-match-in-the-on-argument" class="section level4">
<h4>Join passing columns to match in the <code>on</code> argument</h4>
<pre class="r"><code>z &lt;- data.table(ID = &quot;C&quot;, Z1 = 5:9, Z2 = paste0(&quot;z&quot;, 5:9))
x[, X2 := paste0(&quot;x&quot;, X1)] # used to track the results
z; x</code></pre>
<pre><code>##    ID Z1 Z2
## 1:  C  5 z5
## 2:  C  6 z6
## 3:  C  7 z7
## 4:  C  8 z8
## 5:  C  9 z9
##    Id X1 XY X2
## 1:  A  1 x2 x1
## 2:  B  3 x4 x3
## 3:  C  5 x6 x5
## 4:  C  7 x8 x7</code></pre>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>x[z, on = &quot;X1 == Z1&quot;]
x[z, on = .(X1 == Z1)] # same
x[z, on = .(Id == ID, X1 == Z1)] # using two columns</code></pre>
<pre><code>##      Id X1   XY   X2 ID Z2
## 1:    C  5   x6   x5  C z5
## 2: &lt;NA&gt;  6 &lt;NA&gt; &lt;NA&gt;  C z6
## 3:    C  7   x8   x7  C z7
## 4: &lt;NA&gt;  8 &lt;NA&gt; &lt;NA&gt;  C z8
## 5: &lt;NA&gt;  9 &lt;NA&gt; &lt;NA&gt;  C z9
##      Id X1   XY   X2 ID Z2
## 1:    C  5   x6   x5  C z5
## 2: &lt;NA&gt;  6 &lt;NA&gt; &lt;NA&gt;  C z6
## 3:    C  7   x8   x7  C z7
## 4: &lt;NA&gt;  8 &lt;NA&gt; &lt;NA&gt;  C z8
## 5: &lt;NA&gt;  9 &lt;NA&gt; &lt;NA&gt;  C z9
##    Id X1   XY   X2 Z2
## 1:  C  5   x6   x5 z5
## 2:  C  6 &lt;NA&gt; &lt;NA&gt; z6
## 3:  C  7   x8   x7 z7
## 4:  C  8 &lt;NA&gt; &lt;NA&gt; z8
## 5:  C  9 &lt;NA&gt; &lt;NA&gt; z9</code></pre>
</td>
<td align="left">
<pre class="python"><code>z = pd.DataFrame(
  {&quot;ID&quot; : [&#39;C&#39;, &#39;C&#39;, &#39;C&#39;, &#39;C&#39;, &#39;C&#39;],
   &quot;Z1&quot; : [5, 6, 7, 8, 9],
   &quot;Z2&quot; : [&#39;z5&#39;, &#39;z6&#39;, &#39;z7&#39;, &#39;z8&#39;, &#39;z9&#39;]})
x = x.assign(X2 = &#39;x&#39; + x.X1.astype(str))
#
pd.merge(x, z, how = &#39;right&#39;, left_on = &#39;X1&#39;, right_on = &#39;Z1&#39;)</code></pre>
<pre><code>##     Id   X1   XY   X2 ID  Z1  Z2
## 0    C  5.0   x6   x5  C   5  z5
## 1    C  7.0   x8   x7  C   7  z7
## 2  NaN  NaN  NaN  NaN  C   6  z6
## 3  NaN  NaN  NaN  NaN  C   8  z8
## 4  NaN  NaN  NaN  NaN  C   9  z9</code></pre>
<pre class="python"><code>pd.merge(x, z, how = &#39;right&#39;, left_on = [&#39;Id&#39;, &#39;X1&#39;], right_on = [&#39;ID&#39;, &#39;Z1&#39;])</code></pre>
<pre><code>##     Id   X1   XY   X2 ID  Z1  Z2
## 0    C  5.0   x6   x5  C   5  z5
## 1    C  7.0   x8   x7  C   7  z7
## 2  NaN  NaN  NaN  NaN  C   6  z6
## 3  NaN  NaN  NaN  NaN  C   8  z8
## 4  NaN  NaN  NaN  NaN  C   9  z9</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="non-equi-joins" class="section level4">
<h4>Non-equi joins</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>x[z, on = .(Id == ID, X1 &lt;= Z1)]
x[z, on = .(Id == ID, X1 &gt; Z1)]
x[z, on = .(X1 &lt; Z1), allow.cartesian = TRUE] # allows &#39;numerous&#39; matching values</code></pre>
<pre><code>##    Id X1 XY X2 Z2
## 1:  C  5 x6 x5 z5
## 2:  C  6 x6 x5 z6
## 3:  C  7 x6 x5 z7
## 4:  C  7 x8 x7 z7
## 5:  C  8 x6 x5 z8
## 6:  C  8 x8 x7 z8
## 7:  C  9 x6 x5 z9
## 8:  C  9 x8 x7 z9
##    Id X1   XY   X2 Z2
## 1:  C  5   x8   x7 z5
## 2:  C  6   x8   x7 z6
## 3:  C  7 &lt;NA&gt; &lt;NA&gt; z7
## 4:  C  8 &lt;NA&gt; &lt;NA&gt; z8
## 5:  C  9 &lt;NA&gt; &lt;NA&gt; z9
##     Id X1 XY X2 ID Z2
##  1:  A  5 x2 x1  C z5
##  2:  B  5 x4 x3  C z5
##  3:  A  6 x2 x1  C z6
##  4:  B  6 x4 x3  C z6
##  5:  C  6 x6 x5  C z6
##  6:  A  7 x2 x1  C z7
##  7:  B  7 x4 x3  C z7
##  8:  C  7 x6 x5  C z7
##  9:  A  8 x2 x1  C z8
## 10:  B  8 x4 x3  C z8
## 11:  C  8 x6 x5  C z8
## 12:  C  8 x8 x7  C z8
## 13:  A  9 x2 x1  C z9
## 14:  B  9 x4 x3  C z9
## 15:  C  9 x6 x5  C z9
## 16:  C  9 x8 x7  C z9</code></pre>
</td>
<td align="left">
<pre class="python"><code>(pd.merge(x, z, how = &#39;right&#39;, left_on = &#39;Id&#39;, right_on = &#39;ID&#39;)
    .query(&#39;X1 &lt;= Z1&#39;)
    .eval(&#39;X1 = Z1&#39;)
    .drop(columns = [&#39;ID&#39;, &#39;Z1&#39;]))
# ?
# ?</code></pre>
<pre><code>##   Id  X1  XY  X2  Z2
## 0  C   5  x6  x5  z5
## 2  C   6  x6  x5  z6
## 4  C   7  x6  x5  z7
## 5  C   7  x8  x7  z7
## 6  C   8  x6  x5  z8
## 7  C   8  x8  x7  z8
## 8  C   9  x6  x5  z9
## 9  C   9  x8  x7  z9</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="rolling-joinssubsets-performed-on-the-last-numeric-column" class="section level4">
<h4>Rolling joins/subsets (performed on the last numeric column)</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code># Nearest
x[z, on = .(Id == ID, X1 == Z1), roll = &quot;nearest&quot;]
## below, simplified examples with ad hoc subsets on a keyed data.table
setkey(x, Id, X1)
x[.(&quot;C&quot;, 5:9), roll = &quot;nearest&quot;]</code></pre>
<pre><code>##    Id X1 XY X2 Z2
## 1:  C  5 x6 x5 z5
## 2:  C  6 x6 x5 z6
## 3:  C  7 x8 x7 z7
## 4:  C  8 x8 x7 z8
## 5:  C  9 x8 x7 z9
##    Id X1 XY X2
## 1:  C  5 x6 x5
## 2:  C  6 x6 x5
## 3:  C  7 x8 x7
## 4:  C  8 x8 x7
## 5:  C  9 x8 x7</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code># Last Observation Carried Forward
x[.(&quot;C&quot;, 5:9), roll = Inf]
x[.(&quot;C&quot;, 5:9), roll = 0.5]  # bounded
x[.(&quot;C&quot;, 5:9), roll = Inf, rollends = c(FALSE, TRUE)]  # default
x[.(&quot;C&quot;, 5:9), roll = Inf, rollends = c(FALSE, FALSE)] # ends not rolled</code></pre>
<pre><code>##    Id X1 XY X2
## 1:  C  5 x6 x5
## 2:  C  6 x6 x5
## 3:  C  7 x8 x7
## 4:  C  8 x8 x7
## 5:  C  9 x8 x7
##    Id X1   XY   X2
## 1:  C  5   x6   x5
## 2:  C  6 &lt;NA&gt; &lt;NA&gt;
## 3:  C  7   x8   x7
## 4:  C  8 &lt;NA&gt; &lt;NA&gt;
## 5:  C  9 &lt;NA&gt; &lt;NA&gt;
##    Id X1 XY X2
## 1:  C  5 x6 x5
## 2:  C  6 x6 x5
## 3:  C  7 x8 x7
## 4:  C  8 x8 x7
## 5:  C  9 x8 x7
##    Id X1   XY   X2
## 1:  C  5   x6   x5
## 2:  C  6   x6   x5
## 3:  C  7   x8   x7
## 4:  C  8 &lt;NA&gt; &lt;NA&gt;
## 5:  C  9 &lt;NA&gt; &lt;NA&gt;</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code># Next Observation Carried Backward
x[.(&quot;C&quot;, 5:9), roll = -Inf]
x[.(&quot;C&quot;, 5:9), roll = -0.5] # bounded
x[.(&quot;C&quot;, 5:9), roll = -Inf, rollends = c(TRUE, FALSE)]
x[.(&quot;C&quot;, 5:9), roll = -Inf, rollends = c(TRUE, TRUE)]  # roll both ends</code></pre>
<pre><code>##    Id X1   XY   X2
## 1:  C  5   x6   x5
## 2:  C  6   x8   x7
## 3:  C  7   x8   x7
## 4:  C  8 &lt;NA&gt; &lt;NA&gt;
## 5:  C  9 &lt;NA&gt; &lt;NA&gt;
##    Id X1   XY   X2
## 1:  C  5   x6   x5
## 2:  C  6 &lt;NA&gt; &lt;NA&gt;
## 3:  C  7   x8   x7
## 4:  C  8 &lt;NA&gt; &lt;NA&gt;
## 5:  C  9 &lt;NA&gt; &lt;NA&gt;
##    Id X1   XY   X2
## 1:  C  5   x6   x5
## 2:  C  6   x8   x7
## 3:  C  7   x8   x7
## 4:  C  8 &lt;NA&gt; &lt;NA&gt;
## 5:  C  9 &lt;NA&gt; &lt;NA&gt;
##    Id X1 XY X2
## 1:  C  5 x6 x5
## 2:  C  6 x8 x7
## 3:  C  7 x8 x7
## 4:  C  8 x8 x7
## 5:  C  9 x8 x7</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="cross-join-cj-expand.grid" class="section level4">
<h4>Cross join (<code>CJ</code> ~ <code>expand.grid</code>)</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>CJ(c(2, 1, 1), 3:2)
CJ(c(2, 1, 1), 3:2, sorted = FALSE, unique = TRUE)</code></pre>
<pre><code>##    V1 V2
## 1:  1  2
## 2:  1  2
## 3:  1  3
## 4:  1  3
## 5:  2  2
## 6:  2  3
##    V1 V2
## 1:  2  3
## 2:  2  2
## 3:  1  3
## 4:  1  2</code></pre>
</td>
<td align="left">
<pre class="python"><code>(pd.DataFrame([(x, y) for x in [2, 1, 1] for y in [3, 2]],
              columns = [&#39;V1&#39;, &#39;V2&#39;])
   .sort_values([&#39;V1&#39;, &#39;V2&#39;]))</code></pre>
<pre><code>##    V1  V2
## 3   1   2
## 5   1   2
## 2   1   3
## 4   1   3
## 1   2   2
## 0   2   3</code></pre>
<pre class="python"><code>(pd.DataFrame([(x, y) for x in [2, 1, 1] for y in [3, 2]],
              columns = [&#39;V1&#39;, &#39;V2&#39;])
   .drop_duplicates())</code></pre>
<pre><code>##    V1  V2
## 0   2   3
## 1   2   2
## 2   1   3
## 3   1   2</code></pre>
</td>
</tr>
</tbody>
</table>
<br>
<hr>
</div>
</div>
<div id="bind" class="section level3">
<h3>Bind</h3>
<pre class="r"><code>x &lt;- data.table(1:3)
y &lt;- data.table(4:6)
z &lt;- data.table(7:9, 0L)</code></pre>
<div id="bind-rows" class="section level4">
<h4>Bind rows</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>rbind(x, y)
rbind(x, z, fill = TRUE)</code></pre>
<pre><code>##    V1
## 1:  1
## 2:  2
## 3:  3
## 4:  4
## 5:  5
## 6:  6
##    V1 V2
## 1:  1 NA
## 2:  2 NA
## 3:  3 NA
## 4:  7  0
## 5:  8  0
## 6:  9  0</code></pre>
</td>
<td align="left">
<pre class="python"><code>pd.concat([x, y])</code></pre>
<pre><code>##   Id   X1   X2  XY   Y1
## 0  A  1.0   x1  x2  NaN
## 1  B  3.0   x3  x4  NaN
## 2  C  5.0   x5  x6  NaN
## 3  C  7.0   x7  x8  NaN
## 0  A  NaN  NaN  y1  1.0
## 1  B  NaN  NaN  y3  3.0
## 2  B  NaN  NaN  y5  5.0
## 3  D  NaN  NaN  y7  7.0
## 
## /home/xu/anaconda3/bin/python:1: FutureWarning: Sorting because non-concatenation axis is not aligned. A future version
## of pandas will change to not sort by default.
## 
## To accept the future behavior, pass &#39;sort=False&#39;.
## 
## To retain the current behavior and silence the warning, pass &#39;sort=True&#39;.</code></pre>
<pre class="python"><code>pd.concat([x, z])</code></pre>
<pre><code>##     ID   Id   X1   X2   XY   Z1   Z2
## 0  NaN    A  1.0   x1   x2  NaN  NaN
## 1  NaN    B  3.0   x3   x4  NaN  NaN
## 2  NaN    C  5.0   x5   x6  NaN  NaN
## 3  NaN    C  7.0   x7   x8  NaN  NaN
## 0    C  NaN  NaN  NaN  NaN  5.0   z5
## 1    C  NaN  NaN  NaN  NaN  6.0   z6
## 2    C  NaN  NaN  NaN  NaN  7.0   z7
## 3    C  NaN  NaN  NaN  NaN  8.0   z8
## 4    C  NaN  NaN  NaN  NaN  9.0   z9</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="bind-rows-using-a-list" class="section level4">
<h4>Bind rows using a list</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>rbindlist(list(x, y), idcol = TRUE)</code></pre>
<pre><code>##    .id V1
## 1:   1  1
## 2:   1  2
## 3:   1  3
## 4:   2  4
## 5:   2  5
## 6:   2  6</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="bind-columns" class="section level4">
<h4>Bind columns</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>base::cbind(x, y)</code></pre>
<pre><code>##    V1 V1
## 1:  1  4
## 2:  2  5
## 3:  3  6</code></pre>
</td>
<td align="left">
<pre class="python"><code>pd.concat([x, y], axis = 1)</code></pre>
<pre><code>##   Id  X1  XY  X2 Id  Y1  XY
## 0  A   1  x2  x1  A   1  y1
## 1  B   3  x4  x3  B   3  y3
## 2  C   5  x6  x5  B   5  y5
## 3  C   7  x8  x7  D   7  y7</code></pre>
</td>
</tr>
</tbody>
</table>
<br>
<hr>
</div>
</div>
<div id="set-operations" class="section level3">
<h3>Set operations</h3>
<pre class="r"><code>x &lt;- data.table(c(1, 2, 2, 3, 3))
y &lt;- data.table(c(2, 2, 3, 4, 4))</code></pre>
<div id="intersection" class="section level4">
<h4>Intersection</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>fintersect(x, y)
fintersect(x, y, all = TRUE)</code></pre>
<pre><code>##    V1
## 1:  2
## 2:  3
##    V1
## 1:  2
## 2:  2
## 3:  3</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="difference" class="section level4">
<h4>Difference</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>fsetdiff(x, y)
fsetdiff(x, y, all = TRUE)</code></pre>
<pre><code>##    V1
## 1:  1
##    V1
## 1:  1
## 2:  3</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="union" class="section level4">
<h4>Union</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>funion(x, y)
funion(x, y, all = TRUE)</code></pre>
<pre><code>##    V1
## 1:  1
## 2:  2
## 3:  3
## 4:  4
##     V1
##  1:  1
##  2:  2
##  3:  2
##  4:  3
##  5:  3
##  6:  2
##  7:  2
##  8:  3
##  9:  4
## 10:  4</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
</div>
<div id="equality" class="section level4">
<h4>Equality</h4>
<table class="table table-condensed">
<tbody>
<tr>
<td align="left">
<pre class="r"><code>fsetequal(x, x[order(-V1),])
all.equal(x, x) # S3 method</code></pre>
<pre><code>## [1] TRUE
## [1] TRUE</code></pre>
</td>
<td align="left">
<pre class="python"><code>pass</code></pre>
</td>
</tr>
</tbody>
</table>
<!----------------------------------------------------------------------------
                                 SUMMARY
------------------------------------------------------------------------------->
<br><br>
<hr class = "hr2">
<p><br><br></p>
<pre><code>## R version 3.6.3 (2020-02-29)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 18.04.4 LTS
## 
## Matrix products: default
## BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.7.1
## LAPACK: /home/xu/anaconda3/lib/libmkl_rt.so
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=fr_FR.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=fr_FR.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=fr_FR.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=fr_FR.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] data.table_1.13.0 knitr_1.26       
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.3      bookdown_0.16   lattice_0.20-41 digest_0.6.23  
##  [5] rappdirs_0.3.1  grid_3.6.3      jsonlite_1.6    magrittr_1.5   
##  [9] evaluate_0.14   blogdown_0.17   rlang_0.4.6     stringi_1.4.3  
## [13] Matrix_1.2-18   reticulate_1.16 rmarkdown_2.0   tools_3.6.3    
## [17] stringr_1.4.0   xfun_0.11       yaml_2.2.0      compiler_3.6.3 
## [21] htmltools_0.4.0</code></pre>
</div>
</div>
</div>


		
	</div>

	<div class="pagination">
		<a href="/post/2019-06-16-learning-japanese/" class="left arrow">&#8592;</a>
		<a href="/post/2020-06-17-datatable-introduction/" class="right arrow">&#8594;</a>

		<a href="#" class="top">Top</a>
	</div>
</main>


        		<footer>
			<span>
			&copy; 2020. Made with <a href='https://gohugo.io'>Hugo</a> using the <a href='https://github.com/EmielH/tale-hugo/'>Tale</a> theme.
			</span>
		</footer>

    </body>
</html>
